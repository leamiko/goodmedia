window.Xwb||(Xwb={});
(function(p,k){var t=document,s=RegExp("(?:^\\s*)|(?:\\s*$)","g");window.__debug=!!window.__debug;var q=0,o=t.selection,c=p.util={templ:function(a,e,j,m){return a.replace(/\{([\w_$]+)\}/g,function(d,g){var l=e[g];if(m&&typeof l==="string")l=argument.callee(l,e,j,m);if(l===void 0||l===null)return"";return j?encodeURIComponent(l):l})},extendIf:function(a,e){a||(a={});if(e)for(var j in e)if(a[j]===void 0)a[j]=e[j];return a},extend:function(a,e,j){a||(a={});if(e)for(var m in e)if(a[m]===void 0||j)a[m]=
e[m];return a},trim:function(a){return a.replace(s,"")},queryString:function(a){if(!a)return"";var e=[],j;for(j in a){var m=a[j];j=encodeURIComponent(j);var d=typeof m;if(d==="undefined")e.push(j,"=&");else if(d!="function"&&d!="object")e.push(j,"=",encodeURIComponent(m),"&");else if(m instanceof Array)if(m.length){d=0;for(var g=m.length;d<g;d++)e.push(j,"=",encodeURIComponent(m[d]===void 0?"":m[d]),"&")}else e.push(j,"=&");else if(d==="object")for(var l in m)e.push(j,"[",l,"]","=",encodeURIComponent(m[l]),
"&")}e.pop();return e.join("")},bind:function(a,e){return function(){return a.apply(e,arguments)}},ajax:function(a){var e,j=a.url;if(window.XMLHttpRequest)e=new XMLHttpRequest;else if(window.ActiveXObject)try{e=new ActiveXObject("Msxml2.XMLHTTP")}catch(m){try{e=new ActiveXObject("Microsoft.XMLHTTP")}catch(d){}}if(e){a.method=a.method?a.method.toUpperCase():"GET";var g=a.data,l=!a.cache;if(g||l){var r=j.indexOf("?")>=0;if(l)j=r?j+"&_="+ +new Date:j+"?_="+ +new Date;if(g){if(typeof g==="object")g=c.queryString(g);
if(a.method==="GET"){if(!r&&!l)j+="?";j=j+"&"+g}}}e.open(a.method,j,true);if(a.method==="POST")e.setRequestHeader("Content-type","application/x-www-form-urlencoded; charset="+(a.encoding?a.encoding:""));e.onreadystatechange=function(){if(e.readyState===4){var u=e.status===200;if(u&&a.success){try{var w=!a.dt||a.dt==="json"?eval("("+e.responseText+");"):e.responseText}catch(v){__debug&&console.error("服务器返回JSON格式有误，请检查。\n",v,"\n",e.responseText);u=false}if(u)a.success.call(a.scope||this,w,e)}if(!u&&
a.failure)a.failure.call(a.scope||this,e.responseText,e)}};e.send("POST"===a.method?g:void 0);return e}},jsonp:function(a){function e(){if(!r){try{delete window[j];g.parentNode.removeChild(g);g=null}catch(u){}r=true}}var j="jsonp_"+ +new Date,m=a.doc||document,d=a.url,g=m.createElement("script");m=m.getElementsByTagName("head")[0];var l;if(typeof a=="function"){l=a;a={}}else l=a.success;g.type="text/javascript";a.charset&&(g.charset=a.charset);a.deffer&&(g.deffer=a.deffer);d+=d.indexOf("?")>=0?"&"+
(a.jsonp||"jsonp")+"="+j:"?"+(a.jsonp||"jsonp")+"="+j;if(a.data)d+="&"+c.queryString(a.data);if(a.script){c.extend(g,a.script);delete a.script}g.src=d;var r=false;window[j]=function(){e();if(l)l.apply(a.scope||this,arguments)};g.onreadystatechange=g.onload=function(){var u=this.readyState;if(!r&&(!u||u==="loaded"||u==="complete")){e();if(a.failure)a.failure.call(a.scope||this)}};m.appendChild(g);return g},arrayRemove:function(a,e){a.splice(e,1)},arrayIndexOf:function(a,e){for(var j=0,m=a.length;j<
m;j++)if(a[j]===e)return j;return-1},create:function(){var a=function(){this.init.apply(this,arguments)};if(arguments.length===0)return a;var e,j,m,d=k.makeArray(arguments);if(typeof d[0]==="string"){m=d[0];j=d[1];d.shift()}else j=d[0];d.shift();if(j)j=j.prototype;if(j){e=function(){};e.prototype=j;a.prototype=e=new e}if(m){e.type=m;c.ns(m,a)}m=0;for(var g=d.length;m<g;m++)e=k.extend(e,typeof d[m]==="function"?d[m](j):d[m]);return e.constructor=a},domUp:function(a,e,j){j=j||t.body;for(var m=typeof e===
"string";a;){if(m){if(k(a).is(e))break}else if(e(a))break;a=a.parentNode;if(a===j)return null}return a},ns:function(a,e){for(var j=a.split("."),m=window,d,g=0,l=j.length-1;g<l;g++){d=j[g];m[d]||(m[d]={});m=m[d]}m[j[g]]=e},calWbText:function(a,e){if(e===void 0)e=140;var j=a.match(/[^\x00-\xff]/g);return Math.floor((e*2-a.length-(j&&j.length||0))/2)},byteLen:function(a){var e=a.length;if(a=a.match(/[^\x00-\xff]/g))e+=a.length;return e},byteCut:function(a,e){if(c.byteLen(a)>e){var j=a.replace(/&/g," ").replace(/[^\x00-\xff]/g,
"&&");a=a.slice(0,j.slice(0,e).replace(/&&/g," ").replace(/&/g,"").length)}return a},stringReplace:function(a,e,j,m){return a.substring(0,j)+e+a.substring(m)},focusEnd:function(a,e){a.focus();if(e===void 0)e=a.value.length;if(t.selection){var j=a.createTextRange();j.collapse();j.moveStart("character",e);j.moveEnd("character",e);j.select()}else a.selectionStart=a.selectionEnd=e},selectionStart:function(a){if(!o)return a.selectionStart;var e=o.createRange(),j,m=t.body.createTextRange();m.moveToElementText(a);
try{for(j=0;m.compareEndPoints("StartToStart",e)<0;j++)m.moveStart("character",1)}catch(d){j=this.getCursorPos(a)}return j},selectionBefore:function(a){return a.value.slice(0,this.selectionStart(a))},selectText:function(a,e,j){a.focus();if(o){a=a.createTextRange();a.collapse(1);a.moveStart("character",e);a.moveEnd("character",j-e);a.select()}else a.setSelectionRange(e,j)},hasSelectionSupport:function(){return!k.browser.msie},getCursorPos:function(a){var e=0;if(this.hasSelectionSupport()){if(a.selectionStart||
a.selectionStart=="0")e=a.selectionStart}else try{a.focus();var j=null;j=o.createRange();var m=j.duplicate();m.moveToElementText(a);m.setEndPoint("EndToEnd",j);a.selectionStart=m.text.length-j.text.length;a.selectionEnd=a.selectionStart+j.text.length;e=a.selectionStart}catch(d){}return e},getSelectionText:function(a){var e="";return e=window.getSelection?a.selectionStart!=void 0&&a.selectionEnd!=void 0?a.value.substring(a.selectionStart,a.selectionEnd):"":o.createRange().text},setCursor:function(a,
e,j){e=e==null?a.value.length:e;j=j==null?0:j;a.focus();if(a.createTextRange){a=a.createTextRange();a.move("character",e);a.moveEnd("character",j);a.select()}else a.setSelectionRange(e,e+j)},replaceSelection:function(a,e){a.focus();var j=this.selectionStart(a),m=this.getSelectionText(a).length,d=a.value;m=m===0?j:j+m;a.value=c.stringReplace(d,e,j,m);this.setCursor(a,j+e.length);return j},escapeHtml:function(a){return a?a.replace(/</g,"&lt;").replace(/>/g,"&gt;"):""},disable:function(a,e,j){e?k(a).addClass(j||
"general-btn-disabled"):k(a).removeClass(j||"general-btn-disabled")},getBind:function(a,e){var j="_xwbbnd_"+e,m=a[j];m||(m=a[j]=c.bind(a[e],a));return m},uniqueId:function(){return++q},formQuery:function(a){var e="",j="";a=k(a)[0];for(var m=a.elements,d=m.length,g=0;g<d;g++){j=m[g];if(j.tagName==="INPUT")if(j.type==="radio"||j.type==="checkbox")if(!j.checked)continue;if(a=j.name||j.id){if(e!="")e+="&";e+=encodeURIComponent(j.name||j.id)+"="+encodeURIComponent(j.value)}}return e},appendParam:function(a,
e){var j=typeof e!=="string"?this.queryString(e):e;return a+(a.indexOf("?")!==-1?"&"+j:"?"+j)},dequery:function(a){var e={};if(a=a.substr(a.indexOf("?")+1)){a=a.split("&");for(var j=0,m=a.length;j<m;j++){var d=a[j].split("=");e[d[0]]=decodeURIComponent(d[1])}}return e},getFileName:function(a,e){if(a.indexOf("\\"))a=a.split("\\").pop();if(a.length>e)a=a.substr(0,e-4)+".."+a.substr(a.length-4);return a},split:function(a,e,j){var m,d=[],g=[];j||(j="\\");for(var l=0,r=a.length;l<r;l++){m=a.charAt(l);
if(m===e){d.push(g.join(""));g.length=0}else{if(m===j&&a.charAt(l+1)===e){m=e;l++}g[g.length]=m}}g.length&&d.push(g.join(""));return d},parseKnV:function(a){var e={},j,m=this.split(a||"",",");try{for(var d=0,g=m.length;d<g;d++)if(m[d].indexOf(":")===-1)e[m[d]]=true;else{j=c.split(m[d],":");e[j[0]]=j[1]}}catch(l){__debug&&console.trace();throw"Syntax Error:rel字符串格式出错。"+a;}return e},ancestorOf:function(a,e,j){if(a.contains&&!k.browser.webkit)return a.contains(e);else if(a.compareDocumentPosition)return!!(a.compareDocumentPosition(e)&
16);if(j===void 0)j=65535;e=e.parentNode;for(var m=t.body;e!=m&&j>0&&e!==null;){if(e==a)return true;e=e.parentNode;j--}return false},getClassByName:function(a,e){for(var j=function(v){for(var x=a.length,y=0;y<x;y++)if(v.toLowerCase()==a[y])return true;return false},m=function(v){if(typeof e=="string")return v.indexOf(e)<0?false:true;else{for(var x=0;x<e.length;x++)if(v.indexOf(e[x])>-1)return true;return false}},d={},g=0;g<document.styleSheets.length;g++){var l;if(e)if(!document.styleSheets[g].href||
!m(document.styleSheets[g].href))continue;l=document.styleSheets[g].cssRules?document.styleSheets[g].cssRules:document.styleSheets[g].rules;if(typeof a=="string")for(var r=0;r<l.length;r++){if(l[r].selectorText&&l[r].selectorText.toLowerCase()==a)d=l[r].style}else{r=0;for(var u=l.length;r<u;r++){var w=l[r].selectorText&&l[r].selectorText.toLowerCase()||"";if(w&&j(w))d[w]=l[r].style}}}return d},setClassAttr:function(a,e,j){a.slice(0);if(j=this.getClassByName(a,j))if(typeof a=="string")for(var m in e)j[m]=
e[m];else for(var d=0,g=a.length;d<g;d++)if(j[a[d]])for(m in e[d])j[a[d]][m]=e[d][m]},getCursorOffset:function(){function a(m){var d={"<":"&lt;",">":"&gt;",'"':"&quot;","\\":"&#92;","&":"&amp;","'":"&#039;","\r":"","\n":"<br>"," ":!j?"<span style='white-space:pre-wrap;'> </span>":"<pre style='overflow:hidden;display:inline;word-wrap:break-word;'> </pre>"};return m.replace(/<|>|\'|\"|&|\\|\r\n|\n| /gi,function(g){return d[g]})}function e(m){this.ele=m;this.init()}var j=false;if(k.browser.msie&&k.browser.version<
8)j=true;e.prototype={$p:null,$f:null,css:["overflowY","height","width","paddingTop","paddingLeft","paddingRight","paddingBottom","marginTop","marginLeft","marginRight","marginBottom","fontFamily","borderStyle","borderWidth","wordWrap","fontSize","lineHeight","overflowX"],init:function(){var m=this.$p=k("<div></div>"),d={opacity:0,position:"absolute",left:0,top:0,zIndex:2E4},g=this.ele;k.each(this.css,function(l,r){d[r]=g.css(r)});m.css(d);k("body").append(m)},setContent:function(m,d,g){var l=this.$p;
l.html("<span>"+a(m)+"</span>");this.$f=m=k("<span>"+a(d)+"</span>");l.append(m);l.append("<span>"+a(g)+"</span>")},getPos:function(){return this.$f.position()}};return function(m,d){var g=k(m);g.data("mirror")||g.data("mirror",new e(g));var l=g.data("mirror");if(!l)return{};var r=g.val();g=r.substring(0,d);var u=r.charAt(d);r=r.substring(d+1);l.setContent(g,u,r);return l.getPos()}}()};if(window.__debug){if(!window.console)window.console={};c.extendIf(console,{debug:k.noop,trace:k.noop,log:k.noop,
warn:k.noop,error:k.noop,group:k.noop,groupEnd:k.noop})}if(k.browser.msie&&k.trim(k.browser.version)=="6.0"){c.ie6=true;t.execCommand("BackgroundImageCache",false,true)}p.ax={};var i=/\[\?(!?)\.([\w_$]+?)\?([\S\s]*?)\?\]/g,b=/\{(\.?[\w_$]+)\}/g,h=p.ax.Tpl={tpls:{},parse:function(a,e){e||(e={});if(a.charAt(0)!=="<"){var j=h.tpls[a];if(j)a=j}a=a.replace(i,function(m,d,g,l){if(d==="!")return!e[g]?l:"";return e[g]===void 0?"":l});return a.replace(b,function(m,d){var g=d.charAt(0)==="."?e[d.substr(1)]:
h.tpls[d];if(g===void 0||g===null)return"";if(g.toString().charAt(0)==="<")return h.parse(g,e);if(h.tpls[g])return h.parse(h.tpls[g],e);return g})},forNode:function(a,e){if(e)a=this.parse(a,e);return k(a).get(0)},get:function(a){return this.tpls[a]},reg:function(a){k.extend(this.tpls,a)}};(p.ax.Cache={MAX_ITEM_SIZE:3,reg:function(a,e,j){if(this[a])this[a][1]=e;else this[a]=[null,e];j!==void 0&&this.sizeFor(a,j)},get:function(a){a=this[a];if(a===void 0)return null;var e=a[1];a=a[0];if(a===null)return e();
if(a.length>1)return a.pop();if(e)return e();return null},put:function(a,e){var j=this[a];if(j){var m=j[0];m||(j[0]=m=[this.MAX_ITEM_SIZE]);m.length-1>=m[0]||m.push(e)}else this[a]=[[this.MAX_ITEM_SIZE,e]]},remove:function(a){this[a]&&delete this[a]},sizeFor:function(a,e){var j=this[a];j||(this[a]=j=[[]]);j[0]||(j[0]=[]);j[0][0]=e}}).reg("div",function(){return t.createElement("DIV")});p.getCfg=function(a){return p.cfg&&p.cfg[a]};p.getSiteUid=function(){return parseInt(p.getCfg("siteUid"))};p.getUid=
function(){var a=p.getCfg("uid");return a!=="0"&&a};p.getWb=function(a){var e=p.getCfg("wbList");return a?e&&e[a]:e};p.setWb=function(a,e){p.cfg.wbList&&(p.cfg.wbList[a]=e)};k.extend(p,{_cls:{},reg:function(a,e,j){if(this._cls[a]!==void 0&&!j){__debug&&console.trace();throw"已定义类"+a;}return this._cls[a]=e},use:function(a,e){var j=this._cls[a];if(j){if(typeof j==="object")return j;if(typeof e==="function")return new j(e(j.prototype));return new j(e)}return null},isModule:function(a){return this.getModule()===
a},getModule:function(){if(this._mod===void 0)this._mod=this.getCfg("page")||"";return this._mod}});p.ax.Uploader=p.reg("Uploader",function(a){this.init(a)});p.ax.Uploader.prototype={init:function(a){k.extend(this,a);a=this.form;var e=this.formEl=k(a)[0],j="xwb_upload_frame_"+c.uniqueId();this.iframe=h.forNode('<iframe src="about:blank" style="display:none;" id="'+j+'" name="'+j+'"></iframe>');k('<input type="hidden" name="callback"/>').appendTo(a);k(this.iframe).appendTo(t.body);e.target=j;if(!this.action)this.action=
e.action||p.request.apiUrl("action","upload_pic")},setAction:function(a){this.action=a;return this},isLoading:function(){return!!this.jsonpFn},beforeUpload:k.noop,upload:function(a){if(this.beforeUpload(this.form)!==false){this.isLoading()&&this.abort();var e=this,j=this.jsonpFn="jsonp"+(new Date).getTime();window[j]=function(m){window[j]=null;delete e.jsonpFn;m=p.request.parseProtocol(m);(a||e.onload).call(e,m);delete e.jsonpFn};this.formEl.action=c.appendParam(this.action,{callback:"parent."+j,
_:c.uniqueId()});this.formEl.submit()}},onload:k.noop,abort:function(){if(this.isLoading()){var a=this.jsonpFn;window[a]=function(){window[a]=null}}}}})(Xwb,$);(function(p){window.__debug||(__debug=false);var k=location.hostname,t=/:\/\/(.[^\/]+)/,s={init:function(c){this.basePath=c;return this},direct:function(c){c||(c={});var i=c.success;c.success=function(h,a){var e=new (c.responseDefinition||s.DefaultResponseDefinition)(h,c,a);__debug&&console.log("req e:",e);c.scope?i.call(c.scope,e):i(e)};var b=c.url.match(t);return!b||b[1]==k?o.ajax(c):o.jsonp(c)},postReq:function(c,i,b,h){!h&&(h={});h.method="POST";return this.q(c,i,b,h)},q:function(c,i,b,h){!h&&
(h={});h.url=c;if(h.data)o.extend(h.data,i);else h.data=i;h.success=b;return this.direct(h)},basePath:"/",act:function(c,i,b,h){return this.postReq(this.apiUrl("action",c),i,function(){b&&b.apply(this,arguments);for(var a=["api."+c],e=0,j=arguments.length;e<j;e++)a.push(arguments[e]);p.fire.apply(p,a)},h)},mkUrl:function(c,i,b,h){c=(h||"")+"?m="+c;if(i)c+="."+i;if(b){c+="&";typeof b==="string"?c+=b:c+=o.queryString(b)}return this.basePath+c},apiUrl:function(c,i,b){return this.mkUrl("api/weibo/"+c,
i,b)},parseProtocol:function(c){return new s.DefaultResponseDefinition(c)},event:function(c,i,b,h){this.postReq(this.mkUrl("event",c),i,b,h)},post:function(c,i,b,h){c={text:c};if(b)c.pic=b;s.act("update",c,i,h)},postImgText:function(c,i,b,h){s.act("upload",{text:c,pic:i},b,h)},repost:function(c,i,b,h,a){s.act("repost",{id:c,text:i,rtids:b},h,a)},getEmotion:function(c){s.act("emotions",null,c)},del:function(c,i,b){s.act("destroy",{id:c},i,b)},comment:function(c,i,b,h,a,e){s.act("comment",{id:c,text:i,
forward:b,type:h},a,e)},delComment:function(c,i,b){s.act("comment_destroy",{id:c},i,b)},reply:function(c,i,b,h,a,e,j){s.act("reply",{id:c,cid:i,text:b,forward:h,type:a},e,j)},follow:function(c,i,b,h){s.act("createFriendship",{uid:c,type:i},b,h)},unfollow:function(c,i,b,h){s.act("deleteFriendship",{id:c,name:i,is_follower:0},b,h)},removeFans:function(c,i,b,h){s.act("deleteFriendship",{id:c,name:i,is_follower:1},b,h)},fav:function(c,i,b){s.act("createFavorite",{id:c},i,b)},delFav:function(c,i,b){s.act("deleteFavorite",
{id:c},i,b)},updateHeadPic:function(c,i,b){s.act("updateProfileImage",{image:c},i,b)},setProfile:function(c,i,b){s.act("saveProfile",c,i,b)},unread:function(c,i,b){s.act("unread",{id:c},i,b)},clearUnread:function(c,i,b){s.act("clearTip",{type:c},i,b)},getComments:function(c,i,b,h,a){s.act("getComments",{id:c,page:i,type:b||1},h,a)},msg:function(c,i,b,h,a){s.act("sendDirectMessage",{id:i?"":c,name:i?c:"",text:b},h,a)},delMsg:function(c,i,b){s.act("deleteDirectMessage",{id:c},i,b)},followed:function(c,
i,b,h,a,e){var j={};if(b)j.t_name=c;else j.t_id=c;if(h)if(a)j.s_name=h;else j.s_id=h;s.act("friendShip",j,i,e)},setting:function(c,i,b){s.act("setting",{type:c},i,b)},shieldBlog:function(c,i,b){s.postReq(s.mkUrl("show","disabled"),{id:c},i,b)},reportSpam:function(c,i,b,h){s.postReq(s.mkUrl("show","reportSpam"),{cid:c,content:i},b,h)},createTags:function(c,i,b){s.act("createTags",{tagName:c},i,b)},delTag:function(c,i,b){s.act("deleteTags",{tag_id:c},i,b)},updateShowProfile:function(c,i,b){s.act("saveShow",
c,i,b)},updateNoticeProfile:function(c,i,b){s.act("saveNotice",c,i,b)},notice:function(c,i,b,h,a,e){s.postReq(s.apiUrl("action","sendNotice"),{available_time:h,uid:c,title:i,content:b},a,e)},saveSkin:function(c,i,b){s.postReq(s.mkUrl("setting","setSkin"),c,i,b)},saveMgrSkin:function(c,i,b){s.postReq(s.mkUrl("mgr/setting","setSkin"),c,i,b)},counts:function(c,i,b){s.act("getCounts",{ids:c},i,b)},blacklistAdd:function(c,i,b,h){s.act("createBlocks",{id:c,name:i},b,h)},blacklistDel:function(c,i,b,h){s.act("deleteBlocks",
{id:c,name:i},b,h)},getProvinces:function(c){s.act("getProvinces",null,c)},feedback:function(c,i,b){this.postReq(this.mkUrl("feedback","save"),c,i,b)},sinaurl:function(c,i){s.act("sinaurl",{id:c},i)},eventSave:function(c,i){s.event("saveEvent",c,i)},eventJoin:function(c,i){c=$.extend({},c,{action:"join"});s.event("joinEvent",c,i)},eventClose:function(c,i){s.event("closeEvent",{eid:c},i)},eventDelete:function(c,i){s.event("deleteEvent",{eid:c},i)},eventExit:function(c,i,b){s.event("doAction",{action:"exit",
eid:c},i,b)}};s.DefaultResponseDefinition=function(c,i,b){this.raw=c;this.reqCfg=i;if(b)this.connector=b};s.DefaultResponseDefinition.prototype={getRequestCfg:function(){return this.reqCfg},getConnector:function(){return this.connector},getRaw:function(){return this.raw},getData:function(){return this.getRaw().rst},isOk:function(){return!this.getCode()},getCode:function(){return this.getRaw().errno},getError:function(){return this.getRaw().err},getMsg:function(c){if(__debug)q[this.getCode()]||console.warn("未定义错误码消息："+
this.getCode(),"@",this.getRaw());return q[this.getCode()]||c||"系统不给力，请稍后再试试吧。"},each:function(c,i){var b=0,h=this.getData(),a;for(a in h)if(!isNaN(a)){if(i){if(c.call(i,h[a],b)===false)break}else if(c(h[a],b)===false)break;b++}}};var q=s.ERRORMAP={"0":"发布失败。","5":"超过字数了！","1":"图片正在上传，请稍候。","2":"正在发布,请稍候。。","3":"请先输入内容。","4":"请写上你要说的话题。","1010005":"超出字数了哦！","1020002":"请不要重复发布相同的内容。","1010006":"不能采用sina域下的邮箱。","1010007":"已经提交，请耐心等待管理员审核，谢谢！","20011":"评论字数超过限制","20016":"他还没有关注你,不能发私信","30001":"皮肤保存失败，请重试。",
"20020":"上传图片为空","20021":"上传图片大小超过限制","20022":"上传图片类型不符合要求","20023":"上传图片失败，重新试试看？","20024":"非法的上传图片","1021200":"此昵称不存在","1020500":"此微博已被作者移除。","1020301":"此微博已被作者移除。","1020700":"此微博已被作者移除。","1020402":"此微博已被作者移除。","1020504":"此微博已被作者移除。","1020501":"此评论已被作者移除。","1020600":"此评论已被作者移除。","1040003":"您尚未登录，请先登录再操作","1040000":"您尚未登录，请先登录再操作","1050000":"系统繁忙，请稍候再试。","1040007":"发评论太多啦，休息一会儿吧。","1040006":"发微博太多啦，休息一会儿吧。","1040005":"你已经被禁止发言","1040004":"请不要发表违法和不良信息。","1021301":"该昵称已存在，请换一个昵称。","1020104":"不要太贪心哦，发一次就够啦。",
"1020808":"你不能关注自己。","1020801":"关注的用户不存在。","1020800":"关注失败","1020805":"已关注该用户","1050000":"操作失败，重新试试看？","1020404":"由于用户设置，你暂不能发表评论。","1020405":"根据对方的设置，你不能进行此操作。","1020806":"你使用的帐号或IP关注过于频繁，今日将无法再进行同类操作，请谅解！","2010009":"上传图片大小超过限制。","2010010":"上传图片大小超过限制。","2010011":"上传图片的数据不完整，重新试试看？","2010012":"图片上传失败，重新试试看？","2010013":"上传图片失败，重新试试看？","2010014":"上传图片失败，重新试试看？","1040016":"出错啦，该网站调用API次数已超过限制，请联系站长解决！"},o=p.util;if(!p.fire)p.fire=function(){};p.request=s})(window.Xwb);(function(p,k){var t=true,s=parseInt,q=!!(k.browser.msie&&k.browser.version=="6.0"),o=function(){this.cid="imageCtrler";this.canvas=null;this.maxWidth=440;this.curAngle=this.height=this.width=0};o.prototype={init:function(c){c=c.el;this.width=c.offsetWidth;this.height=c.offsetHeight;if(k.browser.msie){c.style.filter="progid:DXImageTransform.Microsoft.Matrix()";c.filters.item("DXImageTransform.Microsoft.Matrix").SizingMethod="auto expand";k(c).addClass("narrow-move")}else{this.canvas=k("<canvas></canvas>").attr({height:this.height,
width:this.width}).addClass("narrow-move").attr("rel","e:zo").insertBefore(c)[0];if(this.canvas.getContext){k(c).hide();this.canvas.getContext("2d")}}this.element=c},rotate:function(c){if(this.element){if(c==="right"){c=this.curAngle+90;this.curAngle=c>=360?0:c}else if(c==="left"){c=this.curAngle-90;this.curAngle=c<0?360+c:c}var i,b;c=this.width;var h=this.height;this.width=h;this.height=c;if(h>this.maxWidth){c=s(this.maxWidth*c/h);h=this.maxWidth}if(this.canvas){var a=this.canvas.getContext("2d"),
e=this.element,j=0,m=0;k(this.canvas).attr({width:h,height:c});a.clearRect(0,0,h,c);switch(this.curAngle){case 0:m=j=0;i=h;b=c;break;case 90:j=h;m=0;i=c;b=h;break;case 180:j=h;m=c;i=h;b=c;break;case 270:j=0;i=m=c;b=h}a.save();a.translate(j,m);a.rotate(this.curAngle*Math.PI/180);a.drawImage(e,0,0,i,b);a.restore()}else{e=this.curAngle*Math.PI/180;a=Math.cos(e);e=Math.sin(e);j=this.element;j.filters.item("DXImageTransform.Microsoft.Matrix").M11=a;j.filters.item("DXImageTransform.Microsoft.Matrix").M12=
-e;j.filters.item("DXImageTransform.Microsoft.Matrix").M21=e;j.filters.item("DXImageTransform.Microsoft.Matrix").M22=a;switch(this.curAngle){case 0:case 180:i=h;b=c;break;case 90:case 270:i=c;b=h}j.width=i;j.height=b;if(k.browser.version==8)j.parentNode.style.height=j.offsetHeight+18}}}};k.extend(k.fn,{zoomText:function(c,i){this.each(function(){var b,h=k(this),a=h.offset(),e=h.text();i=isNaN(i)?2:i;isNaN(+e)||(e=+e+(c||1));h.text(e);b=h.clone().attr("id","").css({position:"absolute",top:a.top,left:a.left,
font:h.css("font"),color:h.css("color")}).appendTo(k(document.body));e=i*parseInt(h.css("font-size"));b.animate({"font-size":e,top:a.top-h.height()/4,left:a.left-h.width()/2,opacity:0.1},{duration:300,complete:function(){b.remove()}})});return this},imgRotate:function(c){this.each(function(){if(this.tagName!=="IMG")return false;var i=k(this).data("img");if(!i){i=new o;i.init({el:this});i.maxWidth=k(this).parent().width();k(this).data("img",i)}i.rotate(c)});return this},focusText:function(c,i,b,h){this.each(function(){k(this).focus(function(){if(this.value===
c){var a=k(this).data("xwb_selholder");if(a)a.setText("");else this.value=""}if(i)h?k(b||this).removeClass(i):k(b||this).addClass(i)}).blur(function(){if(k.trim(this.value)===""){var a=k(this).data("xwb_selholder");if(a)a.setText(c);else this.value=c}if(i)h?k(b||this).addClass(i):k(b||this).removeClass(i)})})},cssDisplay:function(c){var i=this.length;if(i)if(i===1)if(c===undefined)return!this.hasClass("hidden");else c?this.removeClass("hidden"):this.addClass("hidden");else this.each(function(){c?
k(this).removeClass("hidden"):k(this).addClass("hidden")});return this},checkClass:function(c,i){c&&this.each(function(){var b=k(this),h=b.hasClass(c);if(i)h||b.addClass(c);else h&&b.removeClass(c)});return this},switchClass:function(c,i){this.each(function(){var b=k(this);b.removeClass(c);b.addClass(i)});return this},absolutePos:function(){var c=this.offset(),i=k(document),b=i.scrollTop();i=i.scrollLeft();c.left-=i;c.top-=b;return c},slideMenu:function(c,i){this.each(function(){(function(b){function h(){e.show().cssDisplay(true);
i&&b.addClass(i)}function a(){i&&b.removeClass(i);e.cssDisplay(false)}var e=b.find(c),j,m;b.hover(function(){if(m){clearTimeout(m);m=false}j=setTimeout(h,100)},function(){if(j){clearTimeout(j);j=false}m=setTimeout(a,80)})})(k(this))})},substrText:function(c,i){var b=RegExp("(?:<a.*?>.*?<\\/a>)|(?:<img.*?>)|.","gi");this.each(function(){var h=h||"...",a=this.innerHTML;a=a.match(b);c=c||10;if(a&&a.length>c){a=a.slice(0,c).join("");a=i?a:a.replace(/<img.*?title=\"(.*?)\".*?>/gi,"[$1]");k(this).html(a+
h)}});return this},fixPng:function(){if(q){var c=function(){if(this.tagName=="IMG"){var i=k("<span></span>").css({width:this.offsetWidth,height:this.offsetHeight,display:"inline-block"});i[0].style.filter='progid:DXImageTransform.Microsoft.AlphaImageLoader(src="'+this.src+'", sizingMethod="crop")';k(this).replaceWith(i)}};this.each(function(){if(this.Complete)c.call(this);else this.onload=c})}return this},makeScroll:function(c){function i(){if(c.ldisabledCs){var v=m.scrollWidth>m.offsetWidth;r.cssDisplay(v);
l.cssDisplay(v);r.checkClass(c.ldisabledCs,m.scrollLeft==0);l.checkClass(c.rdisabledCs,m.scrollLeft+m.offsetWidth===m.scrollWidth)}}function b(){var v=m.scrollLeft+c.pace*g;if(v<0)v=0;if(v>m.scrollWidth)v=m.scrollWidth;m.scrollLeft=v;i();d=setTimeout(arguments.callee,c.interval||20)}function h(){u=false;b()}function a(){u=true;g=-1;mid=setTimeout(h,200);return false}function e(){u=true;g=1;mid=setTimeout(h,200);return false}function j(){if(u){var v=m.scrollLeft+c.pace*g*4;if(v<0)v=0;if(v>m.scrollWidth)v=
m.scrollWidth;k(m).animate({scrollLeft:v},"fast",function(){i()})}clearTimeout(d);clearTimeout(mid)}var m=this[0],d,g=1,l=k(c.nextBtn),r=k(c.prevBtn);c.pace=c.pace||25;var u;c.nextBtn&&k(c.nextBtn).mousedown(e).mouseup(j).click(function(){return false});c.prevBtn&&k(c.prevBtn).mousedown(a).mouseup(j).click(function(){return false});var w=0;if(c.items){k(m).find(c.items).each(function(){w+=this.offsetWidth});k(m).find(c.ct||":first-child").css("width",w)}i();return c}});(function(){function c(){a=
/INPUT|IMG|SCRIPT|STYLE|HEAD|MAP|AREA|TEXTAREA|SELECT|META|OBJECT|IFRAME/i;e=/^\s+$/;j=/(\.|\\|\/|\*|\?|\+|\[|\(|\)|\]|\{|\}|\^|\$|\|)/g;m=/</g;d=/>/g;g=t}function i(l,r){g||c();if(typeof l==="string")l=k.trim(l).split(e);for(var u=[],w=0,v=l.length;w<v;w++)if(l[w]&&!e.test(l[w]))u[u.length]=l[w].replace(m,"&lt;").replace(d,"&gt;").replace(j,"\\$1");var x=RegExp("("+u.join("|")+")","gi"),y='<span class="'+(r||i.cls)+'">$1</span>',A=document.createElement("DIV");this.each(function(){b(this,x,y,A)});
return this}function b(l,r,u,w){var v=l.childNodes,x=[],y,A;y=0;for(A=v.length;y<A;y++)a.test(v[y].tagName)||x.push(v[y]);y=0;for(A=x.length;y<A;y++){v=x[y];if(v.nodeType===3)try{v=v;var z=r,B=u,C=w,D=v.data;if(!e.test(D)){D=D.replace(m,"&lt;").replace(d,"&gt;");if(z.test(D)){C||(C=document.createElement("DIV"));C.innerHTML=D.replace(z,B);var E=C.childNodes;z=[];var F=document.createDocumentFragment();B=0;for(var G=E.length;B<G;B++)z[B]=E[B];for(B=0;B<G;B++)F.appendChild(z[B]);v.parentNode.replaceChild(F,
v)}}}catch(H){}else arguments.callee(v,r,u,w)}}function h(l,r){var u=l.childNodes,w=[],v,x,y;v=0;for(x=u.length;v<x;v++)a.test(u[v].tagName)||w.push(u[v]);v=0;for(x=w.length;v<x;v++){u=w[v];y=u.nodeType;if(y!==3)if(y===1&&u.tagName==="SPAN"&&u.className===r){y=u.childNodes[0];var A=u.parentNode,z=u.previousSibling,B=u.nextSibling;if(z&&z.nodeType===3){A.removeChild(z);y.data=z.data+y.data}if(B&&B.nodeType===3){A.removeChild(B);y.data+=B.data}A.replaceChild(y,u)}else arguments.callee(u,r)}}var a,e,
j,m,d,g;k.fn.highlight=i;k.fn.clearHighlight=function(l){g||c();l=l||i.cls;this.each(function(){h(this,l)})};i.cls="search-txt"})();k.cookie=function(c,i,b){if(typeof i!="undefined"){b=b||{};if(i===null){i="";b.expires=-1}var h="";if(b.expires&&(typeof b.expires=="number"||b.expires.toUTCString)){if(typeof b.expires=="number"){h=new Date;h.setTime(h.getTime()+b.expires*24*60*60*1E3)}else h=b.expires;h="; expires="+h.toUTCString()}var a=b.path?"; path="+b.path:"",e=b.domain?"; domain="+b.domain:"";
b=b.secure?"; secure":"";document.cookie=[c,"=",encodeURIComponent(i),h,a,e,b].join("")}else{i=null;if(document.cookie&&document.cookie!=""){b=document.cookie.split(";");for(h=0;h<b.length;h++){a=jQuery.trim(b[h]);if(a.substring(0,c.length+1)==c+"="){i=decodeURIComponent(a.substring(c.length+1));break}}}return i}}})(Xwb,jQuery);Xwb.ax.Tpl.reg({Box:'<div class="win-pop {.cs}"><div class="win-t"><div></div></div><div class="win-con"><div class="win-con-in">[?.title?{BoxTitlebar}?]<div class="win-box" id="xwb_dlg_ct">{.contentHtml}</div></div><div class="win-con-bg"></div></div><div class="win-b"><div></div></div>[?.closeable?<a href="#" class="icon-close-btn icon-bg" id="xwb_cls" title="关闭"></a>?]{.boxOutterHtml}</div>',DialogContent:'{.dlgContentHtml}<div class="btn-area" id="xwb_dlg_btns">{.buttonHtml}</div>',BoxTitlebar:'<h4 class="win-tit x-bg"><span id="xwb_title">{.title}</span></h4>',
Mask:'<div class="shade-div"></div>',ForwardDlgContentHtml:'<p id="xwb_forward_text"></p><div class="forward-tool"><span id="xwb_warn_tip">还可以输入140字</span><a href="#" class="icon-face-choose all-bg" id="xwb_face_trig"></a></div><textarea id="xwb_fw_input" class="style-normal"></textarea><div id="xwb_fw_lbl"></div>',ForwardDlgLabel:'<label><input type="checkbox" value="{.uid}">同时作为{.nick}的评论发布</label>',MsgDlgContent:'<div class="tips-c"><div class="icon-alert all-bg" id="xwb_msgdlg_icon"></div><p id="xwb_msgdlg_ct"></p></div>',
Button:'<a href="#" class="general-btn {.cs}" id="xwb_btn_{.id}"><span>{.title}</span></a>',EmotionHotList:'<div class="hot-e-list" id="hotEm">{.hotList}</div>',EmotionBoxContent:'<div class="win-tab bottom-line" id="cate">\t{.category} </div><div class="emotion-box" id="box">{EmotionHotList}<div class="e-list" id="flist0">{.faces}</div></div>',ArrowBoxBottom:'<div class="arrow all-bg"></div>',EmotionIcon:'<a href="javascript:;" title="{.title}" rel="e:em"><img src="{.src}"></a>',Loading:'<div id="xweibo_loading" class="loading"></div>',
CommentArea:'<div class="feed-comment box-style hidden"><div class="box-t skin-bg"><span class="skin-bg"></span></div><div class="box-content">{.cmtBoxHtml}<ul id="cmtCt" class="hidden"></ul><div class="more-comment" id="more">后面还有<span id="lefCnt"></span>条评论，<a href="{.cmtUrl}">点击查看</a></div></div><div class="box-b skin-bg"><span class="skin-bg"></span></div><span class="box-arrow skin-bg"></span></div>',CmtBox:'<div class="post-comment" id="cmtBox"><div class="post-comment-main"><a href="javascript:;" class="icon-face-choose all-bg" rel="e:ic"></a><a class="general-btn" href="javascript:;" rel="e:sd"><span>评论</span></a><div class="comment-keyin style-normal"><div><textarea class="comment-textarea" id="inputor"></textarea></div></div></div><div><span class="keyin-tips" id="warn">还可以输入70个字</span><label><input type="checkbox" id="sync"/>同时发一条微博</label></div></div>',
atwho:'<div class="atwho">    [?!.noAt?<h4 id="title">想用@提到谁？</h4>?]\t<ul id="mainUL">\t</ul></div>',MBCmtBox:'<div class="feed-comment box-style" id="cmtBox"><div class="box-t skin-bg"><span class="skin-bg"></span></div><div class="box-content"><div class="post-comment"><div class="post-comment-main"><a class="icon-face-choose all-bg" href="#" rel="e:ic"></a><a href="javascript:;" class="general-btn" rel="e:sd"><span>评论</span></a><div class="comment-keyin style-normal"><div><textarea id="inputor" class="comment-textarea style-normal"></textarea></div></div></div><div><span class="keyin-tips" id="warn">还可以输入70个字</span><label><input type="checkbox" id="sync">同时发一条微博</label></div></div></div><div class="box-b skin-bg"><span class="skin-bg"></span></div><span class="box-arrow skin-bg"></span></div>',
Comment:'<li rel="c:{.id},n:{.nick}"><div class="user-pic"><a href="{.usrUrl}"><img src="{.profileImg}" title="{.nick}" alt="{.nick}的头像" width="{.picSz}" height="{.picSz}" /></a></div><div class="comment-content"><p><a href="{.usrUrl}">{.nick}{.verifiedHtml}</a>：{.text}<span>({.time})</span></p><div>[?.canDel?<a class="icon-del icon-bg" href="javascript:;" rel="e:dl">删除</a>?]<a class="icon-reply icon-bg" href="javascript:;" rel="e:rp">回复</a></div></div></li>',MBlogCmt:'<li rel="c:{.id},n:{.nick}"><div class="user-pic"><a href="{.usrUrl}"><img alt="" src="{.profileImg}" /></a></div><div class="comment-c"><p class="c-info"><a href="{.usrUrl}">{.nick}{.verifiedHtml}</a> {.text}({.time}) </p><div class="c-for" id="trigs"><a href="javascript:;" class="icon-reply icon-bg" rel="e:rp">回复</a>[?.canDel?<a href="javascript:;" class="icon-del icon-bg" rel="e:dl">删除</a>?]</div>{.cmtBoxHtml}</div></li>',
Followed:'<span class="followed-icon {.cs}">已关注</span>',MediaBoxContentHtml:'<div class="insert-box"><p>请输入<a href="http://video.sina.com.cn" target="_blank">新浪播客</a>、<a href="http://www.youku.com" target="_blank">优酷网</a>、<a href="http://www.tudou.com" target="_blank">土豆网</a>、<a href="http://www.ku6.com/" target="_blank">酷6网</a>等视频网站的视频播放页链接</p><input type="text" id="xwb_inputor" class="style-normal"><a href="#" class="general-btn" rel="e:ok"><span>确定</span></a><p class="error-tips hidden" id="xwb_err_tip">你输入的链接地址无法识别<span><a href="#" rel="e:cc">取消操作</a>或者<a href="#" rel="e:nm">作为普通的链接</a>发布。</span></p></div>',
PictureBox:'<div class="box-style" style="display:none">\t<div class="box-t skin-bg"><span class="skin-bg"></span></div>\t<div class="box-content">   <div class="show-img"><p><a href="#" rel="e:zo" class="icon-piup icon-bg">收起</a>   <a href="{.org}" target="_blank" class="icon-src icon-bg">查看原图</a>   <a href="#" class="icon-trunleft icon-bg" rel="e:tl">向左转</a>   <a href="#" class="icon-trunright icon-bg" rel="e:tr">向右转</a></p>   <div name="img"></div></div>   </div>\t<div class="box-b skin-bg"><span class="skin-bg"></span></div>\t<span class="box-arrow skin-bg"></span></div>',
PictureBoxForward:'<div class="show-img cutline" style="display:none"><p><a class="icon-piup icon-bg" rel="e:zo" href="#">收起</a><a class="icon-src icon-bg" target="_blank" href="{.org}">查看原图</a><a rel="e:tl" class="icon-trunleft icon-bg" href="#">向左转</a><a rel="e:tr" class="icon-trunright icon-bg" href="#">向右转</a></p><div name="img"></div></div>',PreviewBox:'<div class="preview-img"></div>',VideoThumbHtml:'<div class="feed-img"><img width="120px" height="90px" src="{.img}" alt=""><div class="video-view all-bg" rel="e:pv,i:{.id}"></div></div>',
VideoBox:'<div class="box-style showbox" style="display:none">\t<div class="box-t skin-bg"><span class="skin-bg"></span></div>\t<div class="show-video box-content">   <p><a rel="e:cv" href="#" class="icon-piup icon-bg">收起</a><span>|</span><a title="{.title}" target="_blank" href="{.href}">{.title}</a></p>   <div>{.flash}</div></div>\t<div class="box-b skin-bg"><span class="skin-bg"></span></div>\t<span class="box-arrow skin-bg"></span></div>',VideoBoxForward:'<div class="cutline show-video"><p><a rel="e:cv" href="#" class="icon-piup icon-bg">收起</a><span>|</span><a title="{.title}" target="_blank" href="{.href}">{.title}</a></p><div>{.flash}</div></div>',
MusicBoxContentHtml:'<div class="insert-box music-box"><p>请输入<a href="http://music.sina.com.cn/yueku/" target="_blank">新浪乐库</a>等音乐站点的音乐播放页链接</p><input type="text" id="xwb_inputor" class="style-normal"><a href="#" class="general-btn" rel="e:ok"><span>确定</span></a><p class="error-tips hidden" id="xwb_err_tip">你输入的链接地址无法识别<span><a href="#" rel="e:cc">取消操作</a>或者<a href="#" rel="e:nm">作为普通的链接</a>发布。</span></p></div>',UploadImgBtn:'<a href="#" rel="e:dlp" class="icon-close-btn icon-bg" title="删除"></a>',
SearchDropdownList:'<ul class="head-searchlist"><li class="mouseover">含<span></span>的微博</li><li>名<span></span>的人</li></ul>',PrivateMsgContent:'<div class="field"><label>发私信给:</label><input class="style-normal" type="text" id="sender" /><em class="warn warn-pos hidden" id="warnPos">她还没有关注你,暂时不能发私信</em></div><div class="field"><label>私信内容:</label><textarea class="style-normal" id="content"></textarea></div><input type="hidden" id="uid" value=""><div class="field pad"><div class="icon-face-choose all-bg fl" rel="e:ic"></div><div class="fr"><span class="tips fl" id="word">您还可以输入140个字</span><a class="general-btn highlight fl" href="javascript:;" rel="e:sd"><span>发送</span></a></div></div>',
NoticeLayer:'<div class="new-tips-fixed hidden"><h4 id="xwb_title">提示</h4><p id="wbs" class="hidden"><span id="c">0</span>条新微博，<a href="{.wbsUrl}">点击查看</a></p><p id="fans" class="hidden"><span id="c">0</span>个新粉丝，<a href="{.fansUrl}">点击查看</a></p><p id="cmts" class="hidden"><span id="c">0</span>条新评论，<a href="{.cmtsUrl}">点击查看</a></p><p id="msgs" class="hidden"><span id="c">0</span>封新私信，<a href="{.msgsUrl}">点击查看</a></p><p id="refer" class="hidden"><span id="c">0</span>条微博提到了你，<a href="{.referUrl}">点击查看</a></p><p id="notify" class="hidden"><span id="c">0</span>条通知，<a href="{.notifyUrl}">点击查看</a></p><a href="#" class="icon-close-btn icon-bg" id="xwb_cls" ></a></div>',
NoticeLayer2:'<div class="new-tips"><a id="wbs" class="hidden" href="{.wbsUrl}"><span id="c">0</span>条新微博</a><a id="fans" class="hidden" href="{.fansUrl}"><span id="c">0</span>个新粉丝</a><a id="cmts" class="hidden" href="{.cmtsUrl}"><span id="c">0</span>条新评论</a><a id="msgs" class="hidden" href="{.msgsUrl}"><span id="c">0</span>封新私信</a><a id="refer" class="hidden" href="{.referUrl}"><span id="c">0</span>条微博提到了你</a><a id="notify" class="hidden" href="{.notifyUrl}"><span id="c">0</span>条通知</a><a href="javascript:;" class="icon-close-btn icon-bg" id="xwb_cls"></a></div>',
Login:'<div class="login-area">\t<span><a href="{.regUrl}">注册帐号</a></span><a class="btn-web-account bind-btn-bg" href="{.siteLoginUrl}">{.siteName}登录</a>\t<span><a href="{.sinaRegUrl}" target="_blank">开通微博</a></span><a class="btn-sina-account bind-btn-bg" href="#" id="oauth">新浪微博帐号登录</a></div><div class="bind-tips">提示：您可以使用{.siteName}帐号或新浪微博帐号登录本网站</div>',PostBoxContent:'<div class="post-box"><div class="post-title">有什么新鲜事告诉大家？</div><div class="key-tips" id="xwb_word_cal">您还可以输入<span>140</span>字</div><div class="post-textarea" id="focusEl"><div class="inner"><textarea id="xwb_inputor"></textarea></div></div><div class="add-area"><a class="icon-face icon-bg" href="#" rel="e:ic">表情</a><span class="pic_uploading hidden" id="xwb_upload_tip">正在上传..</span><span class="pic-name hidden" id="xwb_photo_name"><a class="icon-close-btn icon-bg" href="#" ></a></span><div class="share-upload-pic" id="uploadBtn"><form class="upload-pic"  method="post"  enctype="multipart/form-data" id="xwb_post_form" action="" target=""><input type="file" name="pic" id="xwb_img_file" value="" /></form><a class="icon-pic icon-bg" href="#" id="xwb_btn_img">图片</a></div><a class="icon-video icon-bg" href="#" id="xwb_btn_vd" rel="e:vd">视频</a><a class="icon-music icon-bg" href="#" id="xwb_btn_ms" rel="e:ms">音乐</a><a class="icon-topic icon-bg" href="#" id="xwb_btn_tp" rel="e:tp">话题</a></div><div class="share-btn" rel="e:sd"></div><div class="post-success all-bg hidden" id="xwb_succ_mask"></div></div>',
AnchorTipContent:'<div class="tips-c"><div class="icon-correct icon-bg"></div><p id="xwb_title"></p></div>',AnchorDlgContent:'<div class="tips-c"><div class="icon-warn icon-bg"></div><p id="xwb_title"></p></div>',SpanBoxContent:'<div class="win-box-inner"><p class="desc">不良信息是指含有色情、暴力、广告或其他骚扰你正常微博生活的内容。</p><p>你要举报的是“{.nick}”发的微博：</p><div class="report-box"><div>{.text}</div><img src="{.img}" class="user" width="30px" height="30px" ></div><p>你可以填写更多举报说明：（选填）</p><p><textarea rows="" cols="" id="content"></textarea></p><div class="foot-con"><p>请放心，你的隐私将会得到保护。<br>举报电话：400 690 0000</p><div class="btn-area"><a href="#" class="general-btn highlight" rel="e:ok"><span>确认举报</span></a><a href="#" class="general-btn" rel="e:cancel"><span>取消</span></a></div></div></div>',
addFollowContent:'<input type="text" id="Content"/><a class="general-btn" href="javascript:;" rel="e:submit" ><span>保存</span></a><p>请添加想关注的话题</p><p class="warn hidden">添加关注话题失败</p>',evevtApplicants:'<div class="field"><label>联系方式:</label><input type="text" name="contact" id="contact"/></div>        <div class="field"><label>备注:</label><textarea name="note" id="note"></textarea></div>        <div class="field pad">          <div class="fr">            <span class="tips fl">说明:长度不能超过100个字</span>            <em class="warn fl hidden">这里是提示信息</em>            <a href="javascript:;" class="general-btn highlight fl" rel="e:sd"><span>发送</span></a>          </div>        </div>',
colorBox:'<ul><li class="cur" rel="e:getCls,c:#000,w:bg1"><span style="background:#000"></span></li><li rel="e:getCls,c:#808080,w:bg2"><span style="background:#808080"></span></li><li rel="e:getCls,c:#f66,w:bg3"><span style="background:#f66"></span></li><li rel="e:getCls,c:#90c,w:bg4"><span style="background:#90c"></span></li><li rel="e:getCls,c:#e7f2fb,w:bg5"><span style="background:#e7f2fb"></span></li><li rel="e:getCls,c:#fff,w:bg6"><span style="background:#fff"></span></li><li rel="e:getCls,c:#f00,w:bg7"><span style="background:#f00"></span></li><li rel="e:getCls,c:#f60,w:bg8"><span style="background:#f60"></span></li><li rel="e:getCls,c:#fc0,w:bg9"><span style="background:#fc0"></span></li><li rel="e:getCls,c:#090,w:bg10"><span style="background:#090"></span></li></ul><div class="btn-area"><a href="#" class="general-btn" rel="e:comf"><span>确定</span></a></div>',
colorpicker:'<div class="colorpicker"><div class="colorpicker_color"><div><div></div></div></div><div class="colorpicker_hue"><div></div></div><div class="colorpicker_new_color"></div><div class="colorpicker_current_color"></div><div class="colorpicker_hex"><input type="text" maxlength="6" size="6" /></div><div class="colorpicker_rgb_r colorpicker_field"><input type="text" maxlength="3" size="3" /><span></span></div><div class="colorpicker_rgb_g colorpicker_field"><input type="text" maxlength="3" size="3" /><span></span></div><div class="colorpicker_rgb_b colorpicker_field"><input type="text" maxlength="3" size="3" /><span></span></div><div class="colorpicker_hsb_h colorpicker_field"><input type="text" maxlength="3" size="3" /><span></span></div><div class="colorpicker_hsb_s colorpicker_field"><input type="text" maxlength="3" size="3" /><span></span></div><div class="colorpicker_hsb_b colorpicker_field"><input type="text" maxlength="3" size="3" /><span></span></div><div class="colorpicker_submit"></div><div class="cp-oper"><span class="txt" id="cltitle">主链接色</span><span class="c-view" id="cRealColor"><span style="background:#0082cb;"></span></span><label>#<input value="" class="input-txt" id="colorshow" /></label></div><a href="#" class="btn-close" rel="e:closeCls"></a></div>'});(function(p,k){var t=p.util.arrayRemove,s=p.ax.Eventable=function(q){q&&k.extend(this,q);k.extend(this,s.prototype)};s.prototype={fire:function(q){__debug&&console.log("发送:%o",arguments);if(this.events){var o=this.events[q];if(o){var c=k.makeArray(arguments),i,b,h,a,e;c.shift();i=c.length;o._evtLocked=true;h=0;for(a=o.length;h<a;h++){e=o[h];if(!e.removed){if(e.args)c[i]=e.args;b=e.ds?e.cb.apply(e.ds,c):e.cb.apply(this,c);if(b===false)break}}o._evtLocked=false}}return b},on:function(q,o,c,i){if(!q||
!o){__debug&&console.trace();throw"eid or callback can not be null";}if(!this.events)this.events={};var b=this.events[q];b||(b=this.events[q]=[]);b[b.length]={cb:o,ds:c,args:i};return this},un:function(q,o){if(!this.events)return this;if(o===undefined){delete this.events[q];return this}var c=this.events[q];if(c){if(c._evtLocked)c=this.events[q]=c.slice(0);for(var i=0;i<c.length;i++){var b=c[i];if(b.cb==o){t(c,i);b.removed=true;break}}}return this},fireOnce:function(q){var o=this.fire.apply(this,arguments);
this.un(q);return o}}})(Xwb,$);(function(p,k,t){p.ax.SelectionHolder=function(s){t.extend(this,s);k.hasSelectionSupport()||this.initEvent(this.elem)};p.ax.SelectionHolder.prototype={pos:-1,length:0,initEvent:function(){var s=this,q=function(){try{s.saveSpot()}catch(o){}};t(this.elem).mouseup(q).keyup(q).data("xwb_selholder",this)},saveSpot:function(){var s=this.elem;this.pos=k.getCursorPos(s);this.length=k.getSelectionText(s).length},insertText:function(s){var q=this.elem,o=q.value;if(k.hasSelectionSupport())k.replaceSelection(q,
s);else if(this.pos===-1){q.value=o+s;k.focusEnd(q)}else{q.value=k.stringReplace(o,s,this.pos,this.pos+this.length);k.setCursor(q,this.pos+s.length)}this.saveSpot()},setText:function(s){this.elem.value=s;try{this.focusEnd()}catch(q){}},clearSpot:function(){this.length=0;this.pos=-1},focusEnd:function(){k.focusEnd(this.elem);this.saveSpot()},focusStart:function(){k.setCursor(this.elem,0);this.saveSpot()},replaceString:function(s,q,o){this.elem.value=k.stringReplace(this.elem.value,s,q,o);k.setCursor(this.elem,
q+s.length);this.saveSpot()}};p.reg("SelectionHolder",p.ax.SelectionHolder)})(Xwb,Xwb.util,$);(function(p,k,t){function s(o){this.q=o;this.idx=-1;this.end=this.q.length-1}s.prototype={prevented:void 0,stopPropagationed:void 0,get:function(o){var c=this.getRel(o);return c&&c.data&&c.data[o]},escape:function(o){o=this.get(o);if(o!==void 0)return escape(o)},getEl:function(o){return(o=this.getRel(o))&&o.src},clear:function(o){o=o?this.getRel(o):this;o=t(o.src);o.data("xwb_rel",null);o.attr("rel","")},save:function(o,c,i){var b=i?this.getRel(i):this;i=t(b.src);var h=i.data("xwb_rel");if(h)h=h[o]=
c;else{h=p.ax.ActionMgr.parseRel(i.attr("rel"));h[o]=c}b.data=h;i.data("xwb_rel",h);o=[];for(var a in h)o.push(a+":"+(h[a]||"").replace(":","\\:").replace(",","\\,"));o=o.join(",");i.attr("rel",o)},jq:function(o,c){var i=t(this.getEl(o));if(c)i=i.find(c);return i},getRel:function(o){for(var c=this.q,i=this.idx,b=this.end;i<=b;i++)if(c[i].data[o]!==void 0)return c[i]},_next:function(){var o=this.q[++this.idx];if(o===void 0)this.idx=0;return o},clone:function(){var o=new s(this.q);o.idx=0;return o},
preventDefault:function(o){this.prevented=o},stopPropagation:function(o){this.stopPropagationed=o},lock:function(o,c){var i="xwb_e_"+this.data.e;if(c)i+="_"+c;if(o===void 0)return t(this.src).data(i);t(this.src).data(i,o)}};p.ax.ActionMgr=p.reg("ActionMgr",function(o){o&&t.extend(this,o);if(!this.actions)this.actions={};if(!this.filters)this.filters=[];if(this.target){this.bind(this.target);delete this.target}});var q=[];p.ax.ActionMgr.parseRel=function(o){if(typeof o==="string")return k.parseKnV(o);
return k.parseKnV(t(o).attr("rel"))};p.ax.ActionMgr.collectRels=function(o,c,i){var b,h,a=this;if(i===void 0)i=true;k.domUp(o,function(e){var j=t(e);if(i){h=j.data("xwb_rel");if(!h)if(h=j.attr("rel")){h={src:e,data:a.parseRel(h)};j.data("xwb_rel",h)}}else if(h=j.attr("rel"))h={src:e,data:a.parseRel(h)};if(h){b||(b=[]);b[b.length]=h}},c);return b};p.ax.ActionMgr.wrapRel=function(o,c,i){o=this.collectRels(o,c,i);o=new s(o);o._next();return o};p.ax.ActionMgr.getRel=function(o,c,i){return this.wrapRel(o,
i).get(c)};p.ax.ActionMgr.prototype={trigEvent:"click",cacheNodeData:true,reg:function(o,c,i){c={n:o,h:c};i&&t.extend(c,i);this.actions[o]=c;return this},get:function(o){return this.actions[o]},addFilter:function(o,c){c?q.push(o):this.filters.push(o);return this},bind:function(o,c){var i=this;t(o).bind(c||this.trigEvent,function(b){var h=p.ax.ActionMgr.collectRels(b.target,this,this.cacheNodeData);h&&i.fireRels(h,b)});return this},doAct:function(o,c,i){o=p.ax.ActionMgr.collectRels(o,c,i);return!(o&&
this.fireRels(o))},fireRels:function(o,c){var i=new s(o);i.evt=c;__debug&&console.log("act e:",i);for(var b,h,a=q.length,e=this.filters.length,j,m,d;b=i._next();){h=b.data;if(h.e){i.src=b.src;i.data=h;if(i.lock()){__debug&&console.warn("action e:"+i.data.e+" has been locked for resubmiting");m=d=j=true;break}else{b=this.actions[h.e];if(a){j=true;if(this._fireArray(q,i,b)===false){d=i.stopPropagationed;m=i.prevented;break}}if(e){j=true;if(this._fireArray(this.filters,i,b)===false)break}d=i.stopPropagationed;
m=i.prevented;if(b){var g=i.clone();g.src=i.src;g.data=h;g.evt=c;__debug&&console.log("act e:",g);j||(j=true);if(b.h.call(this,g)===false){if(g.stopPropagationed!==void 0)d=g.stopPropagationed;if(g.prevented!==void 0)m=g.prevented;break}if(g.stopPropagationed!==void 0)d=g.stopPropagationed;if(g.prevented!==void 0)m=g.prevented}}}}if(c&&j){if(m===void 0)m=true;if(d===void 0)d=true;m&&c.preventDefault();d&&c.stopPropagation()}},_fireArray:function(o,c,i){for(var b=0,h=o.length;b<h;b++)if(o[b].call(this,
c,i)===false)return false}};p.reg("action",p.use("ActionMgr"))})(Xwb,Xwb.util,$);(function(){function p(q,o){this.elem=o;this.context=q;this.nextChain=t.bind(this._doNextChain,this)}var k=Xwb,t=k.util;p.prototype={validate:function(q){if(this.validating)throw"Concurrent validation exception.";this.setValue(this._getRawValue(this.elem));this._finalChain=q;this.idx=-1;this.error=0;this.msgs=[];this._doNextChain()},_getRawValue:function(q){q=q.value;if(typeof q==="string")q=$.trim(q);return q},getValue:function(){return this.value},setValue:function(q){this.value=q},getErrors:function(){return this.msgs},
addError:function(q){this.msgs.push(q)},doPrehandling:function(){for(var q=this.context,o=0,c;(c=q.nextValidatorData(o++,this.elem))&&c.isPreCmd;)if(typeof c[0]==="string"){var i=q.getValidator(c[0]);if(!i)throw"ValidationException:Undefined validator '"+c[0]+"' in element "+this.elem.name;i.call(this,this.elem,c[1])}else c[0].call(this,this.elem,c[1])},_doNextChain:function(){this.idx++;var q=this.context.nextValidatorData(this.idx,this.elem);if(q)if(q.isPreCmd)this.nextChain();else if(typeof q===
"function"){q[1]={};q.call(this,this.elem,this.getValue(),q[1],this.nextChain)}else if(typeof q[0]==="string"){var o=this.context.getValidator(q[0]);if(!o)throw"ValidationException:Undefined validator ["+q[0]+"] in element "+this.elem.name;o.call(this,this.elem,this.getValue(),q[1],this.nextChain)}else q[0].call(this,this.elem,this.getValue(),q[1],this.nextChain);else{if(!this.error){__debug&&console.log("onpass",this.elem,this);this.context.onpass(this.elem,this)}this._finalChain&&this._finalChain();
this._finalChain=null}},report:function(q,o){q||this.error++;var c=this.elem;this.context.report(q,o,c,this);if(!q){__debug&&console.log("onerror",c,o);this.context.onerror(c,o,this)}}};var s;k.ax.ValidationMgr=function(q){$.extend(this,q);this.init()};k.ax.ValidationMgr.prototype={nextValidatorData:function(q,o){var c=this._getBindingValidators(o);return c&&c[q]},getValidator:function(q){var o=this.validators,c;if(o)c=o[q];if(!c&&s)c=s[q];return c},report:function(q,o,c,i){if(!q)if(i.multival){this.error++;
if(this.error===1&&this.autoFocus)try{c.focus()}catch(b){}}},getMgr:function(){return this},trigOnSubmit:true,onfinal:$.noop,autoFocus:true,init:function(){s||(s={});this.nextChain=t.getBind(this,"_doNextChain");this.form=$(this.form)[0];var q=this;$.each(this._getElements(),function(){(new p(q,this)).doPrehandling()});var o=function(){q.validate();return false};if(this.trigOnSubmit)this.form.onsubmit=o;if(this.trigger){this.trigger=$(this.trigger)[0];$(this.trigger).click(function(){return o()})}},
validateElement:function(q){this.isGlobalVal||this._validateElem(q)},validate:function(){if(!this.isGlobalVal){this.elems=this._getElements();this.currElIdx=-1;this.error=0;this.isGlobalVal=true;this.data={};this.param&&$.extend(this.data,this.param);this.uniqueId=t.uniqueId();this.decorateTrigger&&this.trigger&&t.disable(this.trigger,true);this._doNextChain()}return false},reg:function(q,o){s||(s={});if($.isArray(q))for(var c=0,i=q.length;c<i;c++)this.reg.apply(this,q[c]);else s[q]=o;return this},
onsuccess:function(q,o){o()},_getElements:function(){return this.elements||this.form.elements},_doNextChain:function(){var q=this.elems.length;this.currElIdx>=0&&this.currElIdx<q&&!this.error&&this._collectValue(this.elems[this.currElIdx]);this.currElIdx++;if(this.currElIdx===q)if(this.error)this._finalChain();else{__debug&&console.log("onsuccess",this.data);this.onsuccess(this.data,this.nextChain)!==false&&this.form.submit()}else if(this.currElIdx>q)this._finalChain();else{q=this.elems[this.currElIdx];
q.disabled?this._doNextChain():this._validateElem(q,this.nextChain,true)}},_validateElem:function(q,o,c){if($(q).attr("vrel")){q=new p(this,q);if(c){q.multival=true;this.currentChain=q}q.validate(o)}else o&&o()},_finalChain:function(){this.onfinal();this.isGlobalVal=false;this.data&&delete this.data;delete this.currentChain;this.decorateTrigger&&this.trigger&&t.disable(this.trigger,false)},_collectValue:function(q){if(this.currentChain&&this.currentChain.elem===q)this.data[q.name]=this.currentChain.getValue();
else{if(q.tagName==="INPUT")if(q.type==="radio"||q.type==="checkbox"){if(!q.checked)return}else if(q.type==="submit")return;this.data[q.name]=q.value}},_getBindingValidators:function(q){var o,c=$(q);if(this.useCache)if(c.data("xwb_vd_cmds"))o=c.data("xwb_vd_cmds");else{o=this.parseCmd(c.attr("vrel"));this._mergeExtraValidators(o,q);c.data("xwb_vd_cmds",o)}else{o=this.parseCmd(c.attr("vrel"));c.data("xwb_vd_cmds",o);this._mergeExtraValidators(o,q)}return o},_mergeExtraValidators:function(q,o){var c=
this.extraValidators;if(c&&c[o.name||o.id])$.merge(q,c[o.name||o.id])},parseCmd:function(q){if(!q)return[];var o=[];q=t.split(q,"|");for(var c,i=0,b=q.length;i<b;i++){if(q[i].indexOf("=")===-1)c=[q[i],{}];else{c=t.split(q[i],"=");c[1]=t.parseKnV(c[1])}if(c[0].charAt(0)==="_"){c.isPreCmd=true;c[0]=c[0].substr(1)}o[o.length]=c}return o},errTipName:"warntip",tipTextNode:"#tle",warnType:1,tipTextType:"",comForm:false,focusCss:"style-focus",disableCss:"style-disabled",errCss:"style-wrong",okTip:"oktip",
onerror:function(q,o,c){var i=true;c.addError(o.m);if(o=$(q).attr(this.errTipName)){o=this.getWarnTip(q,o);if(this.isGlobalVal&&c.error==1){var b=o.data("vrel_previd"),h=o.data("vrel_errors")||0;if(this.uniqueId!=b){o.data("vrel_previd",this.uniqueId);o.data("vrel_errors",0);h=0}else i=h==0;o.data("vrel_errors",++h)}}if(i){c=c.getErrors();if(this.warnType===1){if(c.length==1)c=c[0]}else c=c.join("，");this.tipWarn(q,c)}},getWarnTip:function(q,o){var c=$(q).find(o);c.length||(c=$(o));return c},onpass:function(q){var o=
$(q).attr(this.errTipName),c=true;if(o){o=this.getWarnTip(q,o);if(this.isGlobalVal){var i=o.data("vrel_previd"),b=o.data("vrel_errors")||0;if(this.uniqueId!=i){o.data("vrel_previd",this.uniqueId);o.data("vrel_errors",0)}else c=b==0}}c&&this.tipPass(q)},tipWarn:function(q,o){var c=$(q).attr(this.errTipName);if(c){c=this.getWarnTip(q,c);var i=c.cssDisplay(true).find(this.tipTextNode);i.length||(i=c);this.tipTextType==="text"?i.text(o):i.html(o);return c}(c=$(q).attr(this.okTip))&&$(c).css("visibility",
"hidden")},tipPass:function(q){var o=$(q).attr(this.errTipName);o&&$(o).cssDisplay(false);(q=$(q).attr(this.okTip))&&$(q).css("visibility","")}};k.reg("Validator",k.ax.ValidationMgr)})();(function(p,k,t){p.ax.Shortlink=function(s){t.extend(this,s);this._c={}};p.ax.Shortlink.prototype={EXTERNAL_URL:"http://t\\.cn|http://sinaurl\\.cn",local:"",_getReg:function(s){var q=this.slReg;if(!q){q=this.local;q=this.slReg=[q?RegExp("(?:"+q.replace(".","\\.")+"|"+this.EXTERNAL_URL+")/([0-9a-z]+)","gi"):RegExp("(?:"+this.EXTERNAL_URL+")/([0-9a-z]+)","gi"),q?RegExp("(?:"+q.replace(".","\\.")+"|"+this.EXTERNAL_URL+")/([0-9a-z]+)","i"):RegExp("(?:"+this.EXTERNAL_URL+")/([0-9a-z]+)","i")]}return q[s]},
getUrls:function(){return this._c},search:function(s){var q=[];if(s)for(var o=this._getReg(0);o.exec(s)!=null;)q.push(RegExp.$1);return q},is:function(s){return this._getReg(1).test(s)&&RegExp.$1},from:function(s,q){var o={},c=[],i,b,h,a,e,j;for(j in s){e=s[j].shortlinks=[];i=this.search(s[j].tx);b=0;for(h=i.length;b<h;b++){a=i[b];if(!o[a]){o[a]=true;c.push(a)}e.push([a])}if(s[j].rt){i=this.search(s[j].rt.tx);b=0;for(h=i.length;b<h;b++){a=i[b];if(!o[a]){o[a]=true;c.push(a)}e.push([a,true])}}if(s[j].s){i=
this.search(s[j].s);b=0;for(h=i.length;b<h;b++){a=i[b];if(!o[a]){o[a]=true;c.push(a)}e.push([a])}}}this.info(c,function(m){for(var d in s)for(var g=s[d].shortlinks,l,r=0,u=g.length;r<u;r++){l=g[r][0];if(m[l]){g[r][0]=m[l];m[l].id=l}else g[r][0]=null;g[l]=g[r]}q(s)})},info:function(s,q){for(var o=this._c,c=s.length-1;c>=0;c--)o[s[c]]&&k.arrayRemove(s,c);s.length?p.request.sinaurl(s.join(","),function(i){if(i.isOk()){t.each(i.raw.data,function(b,h){o[b]||(o[b]=h)});q(o)}}):q(o)},render:function(s,q){var o=
this,c=[],i=[];t(s).find("a").each(function(){if(sl=o.is(this.href)){c.push([sl,this]);i.push(sl)}});this.info(i,function(b){for(var h=0,a=c.length;h<a;h++)q(b[c[h][0]],c[h][1])})}}})(Xwb,Xwb.util,$);(function(p,k){function t(){return this.view}var s=p.util,q=p.ax.Tpl,o=document,c=k(window),i=k(o),b=p.ui={Base:s.create()},h=b.Base;b.Base.prototype={autoRender:false,titleNode:"#xwb_title",init:function(a){this.cacheId="c"+s.uniqueId();a&&k.extend(this,a);this.initUI();this.autoRender&&this.getView()},initUI:k.noop,clsNode:"#xwb_cls",initClsBehave:function(a){this.jq(this.clsNode).click(s.bind(this.onClsBtnClick,this));this.setCloseable(a)},setCloseable:function(a){k(this.clsNode).cssDisplay(a);
this.closeable=a},onClsBtnClick:function(){this.close(true);return false},close:function(){if(!this.onclose||this.onclose()!==false)this.destroyOnClose?this.destroy():this.display(false)},tplData:false,createView:function(){var a=this.view;if(typeof a==="string")a=this.view=q.forNode(q.get(a)||a,this.tplData||this,true);else this.view=a=o.createElement("DIV");return k(a)[0]},innerViewReady:k.noop,setTitle:function(a){this.jq(this.titleNode).html(a);return this},getView:function(){var a=this.view;
if(!a||!a.tagName)a=this.createView();this.getView=t;if(this.appendTo){k(this.appendTo).append(a);delete this.appendTo}this.closeable!==void 0&&this.initClsBehave(this.closeable);if(this.actionMgr){this.actionMgr=p.use("ActionMgr",this.actionMgr);this.actionMgr.bind(a);if(this.onactiontrig){var e=this;this.actionMgr.addFilter(function(m){return e.onactiontrig(m)})}}this.innerViewReady(a);this.onViewReady&&this.onViewReady(a);if(this.hidden!==void 0){var j=this.hidden;this.hidden=void 0;this.display(!j)}return a},
fly:function(a){this.view=a&&a[0]||a;return this},beforeShow:k.noop,afterShow:k.noop,beforeHide:k.noop,afterHide:k.noop,jqExtra:function(){for(var a=arguments,e=0,j=a.length;e<j;e++){var m=a[e],d=this.jq("#"+m);if(d){m=m.charAt(0).toUpperCase()+m.substring(1);this["jq"+m]=d}}return this},display:function(a){var e=this.jq();if(a===void 0)return!e.hasClass("hidden");a=!a;if(this.hidden!==a)if(a){if(this.beforeHide()!==false){this.hidden=a;e.addClass("hidden");this.afterHide&&this.afterHide();this.contexted&&
this.setContexted(false)}}else{this.hidden=a;e.css("visibility","hidden").removeClass("hidden");this.beforeShow();e.css("visibility","");this.contextable&&!this.contexted&&this.setContexted(true);this.afterShow()}return this},onContextRelease:function(){this.display(false)},appendAt:function(a){k(a).append(this.getView());return this},ancestorOf:function(a,e){a=a.view||a;return s.ancestorOf(this.view,a,e)},jq:function(a){return a===void 0?k(this.getView()):k(this.getView()).find(a)},destroy:function(){this.display(false);
this.jq().remove()},domEvent:function(a,e,j){if(a==="mousedown"){var m=this,d=function(g){m.contexted||p.use("contextMgr").releaseAll(g);return e.apply(m,arguments)};if(!this._mousedownFns)this._mousedownFns={};this._mousedownFns[e]=d;this.jq(j).bind(a,d)}else this.jq(j).bind(a,e)},unDomEvent:function(a,e,j){if(a==="mousedown"){var m=this._mousedownFns[e];this.jq(j).unbind(a,m);delete this._mousedownFns[e]}else this.jq(j).unbind(a,e)},setContexted:function(a){if(this.contexted!==a)a?p.use("contextMgr").context(this):
p.use("contextMgr").release(this);return this},templ:function(a){for(var e in a)this.jq(e).html(a[e]);return this},offset:function(){if(arguments.length){this.jq().css(arguments[0]);return this}return this.jq().offset()},offsetsTo:function(a){a=a[0]||a;a=a==window?{left:i.scrollLeft(),top:i.scrollTop()}:k(a).offset();var e=this.jq().offset();return[e.left-a.left,e.top-a.top]},scrollIntoView:function(a,e){var j=a?a.view||a[0]||a:o.body,m=this.getHiddenAreaOffsetVeti(j);if(m!==false)j.scrollTop=m;if(e){m=
this.getHiddenAreaOffsetHori(a);if(m!==false)j.scrollLeft=m}return this},getHiddenAreaOffsetVeti:function(a){var e=a.view||a[0]||a,j=this.view,m=this.offsetsTo(e);a=parseInt(e.scrollTop,10);m=m[1]+a;j=j.offsetHeight;var d=m+j;e=e.clientHeight;var g=a+e;if(j>e||m<a)return m;else if(d>g){d-=e;if(a!=d)return d}return false},getHiddenAreaOffsetHori:function(a){var e=a.view||a[0]||a,j=this.view;a=parseInt(e.scrollLeft,10);var m=this.offsetsTo(e)[0]+a;j=j.offsetWidth;e=e.clientWidth;var d=m+j,g=a+e;if(j>
e||m<a)return m;else if(d>g){d-=e;if(d!=a)return d}return false},anchor:function(a,e,j,m){var d=k(a);a=this.jq();var g=d.offset(),l=d.width(),r=d.height();d=a.width();var u=a.height(),w=e.charAt(0),v=e.charAt(1);e=g.left;g=g.top;switch(w){case "t":g-=u;break;case "b":g+=r;break;case "c":g+=Math.floor((r-u)/2)}switch(v){case "c":e+=Math.floor((l-d)/2);break;case "r":e+=l-d}if(j){l=l=[e,g];j(l,d,u);e=l[0];g=l[1]}if(m){if(g<0)g=0;else{j=c.height();if(g+u-i.scrollTop()>j)g=j-u+i.scrollTop()}if(e<0)e=
0;else{j=c.width();if(e+d-i.scrollLeft()>j)e=j-d+i.scrollLeft()}}a.css("left",e+"px").css("top",g+"px")},center:function(){var a=this.jq(),e=[c.width(),c.height()];a=[a.width(),a.height()];var j=(e[1]-a[1])*0.8;this.view.style.left=Math.max((e[0]-a[0])/2|0,0)+i.scrollLeft()+"px";this.view.style.top=Math.max(j-j/2|0,0)+i.scrollTop()+"px";return this},clip:function(){if(!h.CLIP_WRAPPER_CSS){h.CLIP_WRAPPER_CSS={position:"absolute",clear:"both",overflow:"hidden"};h.CLIPPER_CSS={position:"absolute",left:0,
top:0}}if(!this.jqClipWrapper){var a=k(p.ax.Cache.get("div")),e=this.getView(),j=this.jq(),m=e.parentNode,d=j.offset();a.css(h.CLIP_WRAPPER_CSS).css(d).css("width",j.width()+"px").css("height",j.height()+"px").css("z-index",j.css("z-index")).append(e);d=this._tmpClipedCss={};for(var g in h.CLIPPER_CSS)d[g]=e.style[g];j.css(h.CLIPPER_CSS);m&&a.appendTo(m);this.jqClipWrapper=a}return this.jqClipWrapper},unclip:function(){if(this.jqClipWrapper){var a=this.jqClipWrapper[0],e=a.style,j=this.jq(),m=j[0].style,
d;for(d in h.CLIP_WRAPPER_CSS)e[d]="";this.jqClipWrapper.css("overflow","").css("width","").css("height","");e=this._tmpClipedCss;for(d in e)m[d]=e[d];delete this._tmpClipedCss;a.removeChild(j[0]);a.parentNode&&this.jqClipWrapper.replaceWith(j);p.ax.Cache.put("div",a);delete this.jqClipWrapper}},slide:function(a,e,j,m,d,g){var l=this.jq(),r=l.width(),u=l.height(),w=0,v=0,x=0,y=0;this.clip();var A=a.charAt(0);a=a.charAt(1);switch(A){case "l":w=0-r;break;case "r":w=0+r;break;case "t":v=0-u;break;case "b":v=
0+u}switch(a){case "l":x=0-r;break;case "r":x=0+r;break;case "t":y=0-u;break;case "b":y=0+u}l.css("left",w).css("top",v);m||(m={});if(x!=w)m.left=m.left===void 0?x:m.left+x;if(y!=v)m.top=m.top===void 0?y:m.top+y;e&&l.css("visibility","");var z=this;l.animate(m,d||"fast",g,function(){if(!e){z.display(false);l.css("visibility","")}setTimeout(function(){z.unclip();j&&j(z)},0)})}};p.reg("base",h)})(Xwb,$);Xwb.reg("contextMgr",function(){var p=Xwb,k=p.util,t=document,s={context:function(q){q.contexted&&this.release(q);var o=this.q;if(!o)this.q=o=[];o.length||$(t).mousedown(this._getDocEvtHandler());o[o.length]=q;this._setCompEvtHandler(q,true);q.contexted=true;__debug&&console.log("contexted",q)},release:function(q,o){q.contexted=false;if(q.onContextRelease(o)!==false){this._setCompEvtHandler(q,false);k.arrayRemove(this.q,q);this.q.length||$(t).unbind("mousedown",this._getDocEvtHandler())}else q.contexted=
true;__debug&&console.log("release context",q)},releaseAll:function(q){var o=this.q;if(o){if(q)var c=q.target;for(var i=o.length-1;i>=0;i--)if(!c||!o[i].ancestorOf(c))this.release(o[i],q)}},_setCompEvtHandler:function(q,o){o?q.domEvent("mousedown",this._compEvtStopHandler):q.unDomEvent("mousedown",this._compEvtHandler)},_getDocEvtHandler:function(){var q=this.docEvtHd;if(!q)q=this.docEvtHd=k.bind(this._docHandler,this);return q},_releaseFollower:function(q,o){var c=this.q;if(c){var i=c.length-1;if(i!==
-1&&c[i]!==q)for(;i>=0;i--){if(c[i]===q)break;this.release(c[i],o)}}},_compEvtStopHandler:function(q){if(q.target.nodeName=="SELECT"||q.target.nodeName=="INPUT")return true;s._releaseFollower(this,q);return false},_compEvtHandler:function(q){s._releaseFollower(this,q)},_docHandler:function(q){this.releaseAll(q)}};p.ax.contextMgr=s;p.reg("contextMgr",s,true);return s});(function(p,k){var t=p.util,s=p.ax.Tpl,q=document,o=p.ui.Base,c=p.ui,i=10001,b=k(window),h={layers:[],hash:{},keyListeners:0,add:function(e){var j=e.cacheId;if(!this.hash[j]){this.layers.push(e);if(e.keyEvent){if(this.keyListeners===0){__debug&&console.log("bind key listener");k(q).bind("keydown",this.getEvtHandler())}this.keyListeners++}this.hash[j]=true}},remove:function(e){var j=e.cacheId;if(this.hash[j]){var m=this.layers;m[m.length-1]===e?m.pop():t.arrayRemove(m,e);this.keyListeners--;if(this.keyListeners===
0){__debug&&console.log("remove key listener");k(q).unbind("keydown",this.getEvtHandler())}delete this.hash[j]}},getEvtHandler:function(){var e=this._onDocKeydown;if(!e)e=this._onDocKeydown=t.bind(this.onDocKeydown,this);return e},onDocKeydown:function(e){var j=this.layers[this.layers.length-1];if(j&&j.keyEvent)return j.onKeydown(e)}},a=c.Layer=t.create(o,{hidden:true,onViewReady:k.noop,frameMask:t.ie6,trackZIndex:function(){if(this.z!==i){i+=3;this.mask&&k(this.mask).css("z-index",i-1);this.frameMask&&
k(this.getFrameMask()).css("z-index",i-2);this.jq().css("z-index",i);this.z=i}},keyEvent:true,onKeydown:function(e){if(e.keyCode===27&&!this.cancelEscKeyEvent){this.close();return false}},beforeShow:function(){this.mask&&this._applyMask(true);var e=this.jq().css("position");if(e==="absolute"||e==="fixed")this.trackZIndex();h.add(this);this.autoCenter&&this.center()},afterHide:function(){this.mask&&this._applyMask(false);h.remove(this)},getFrameMask:function(){if(this.frameMaskEl)return this.frameMaskEl;
return this.frameMaskEl=s.forNode('<iframe class="shade-div shade-iframe" frameborder="0"></iframe>')},_applyMask:function(e){var j=this.mask;if(!j||j===true)j=this.mask=s.forNode(s.get("Mask"));var m=b.height();if(e){k(j).height(m).appendTo(q.body);this.frameMask&&k(this.getFrameMask()).height(m).appendTo(q.body);b.bind("resize",t.getBind(this,"onMaskWinResize"))}else{k(j).remove();this.frameMask&&k(this.getFrameMask()).remove();b.unbind("resize",t.getBind(this,"onMaskWinResize"))}},onMaskWinResize:function(){var e=
this.mask,j=b.height();e&&k(e).height(j);this.frameMask&&k(this.getFrameMask()).height(j);this.autoCenter&&this.center()}});a.setCurrentZ=function(e){i=e};p.reg("Layer",a);c.Switcher=function(e){e&&k.extend(this,e);this.initUI()};p.reg("Switcher",c.Switcher);c.Switcher.prototype={trigMode:"click",initUI:function(){this.items&&this.add(this.items,this.contents)},select:function(e){var j=this.selectedItem;this.autoRecover&&this.clearTimer(1);if(this.selectedCS){j&&k(j).removeClass(this.selectedCS);
k(e).addClass(this.selectedCS)}this.onselect&&this.onselect(e);this.selectedItem=e;if(e.contentEl){var m=e.contentEl;setTimeout(function(){j&&j.contentEl&&k(j.contentEl).cssDisplay(false);k(m).cssDisplay(true)},0)}},unselect:function(e){this.selectedCS&&k(e).removeClass(this.selectedCS);e.contentEl&&k(e.contentEl).cssDisplay(false);this.mouseoutTimer&&this.clearTimer(1);this.selectedItem=NULL},clearTimer:function(e){if(e!==0){if(this.mouseoutTimer){clearTimeout(this.mouseoutTimer);this.mouseoutTimerFn=
this.mouseoutTimer=false}}else if(this.mouseoverTimer){clearTimeout(this.mouseoverTimer);this.mouseoverTimerFn=this.mouseoverTimer=false}},add:function(e,j){if(e.length)if(j)for(var m=0,d=e.length;m<d;m++)this.add(e[m],j[m]);else{m=0;for(d=e.length;m<d;m++)this.add(e[m])}else{m=k(e);var g=this;if(m.hasClass(this.selectedCS)){this.selectedItem&&this.unselect();this.selectedItem=e}if(j)e.contentEl=j;if(this.trigMode==="hover"||this.autoRecover)m.hover(function(){g.autoRecover&&g.mouseoutTimer&&g.clearTimeout(1);
if(g.trigMode==="hover")if(this!==g.selectedItem)if(g.delaySelect){g.mouseoverTimer&&g.clearTimeout(0);g.mouseoverTimer=setTimeout(function(){g.select(e)},g.delaySelect)}else g.select(this);return!g.enableBubble},function(l){g.mouseoverTimer&&g.clearTimeout(0);if(g.trigMode==="hover"){if(this!==g.selectedItem&&g.mouseoutTimerFn){g.mouseoutTimerFn();g.mouseoutTimerFn=NULL}l=l.target;if(g.autoRecover&&(l===this||t.ancestorOf(this,l)))if(!g.mouseoutTimer){var r=this;g.mouseoutTimerFn=function(){g.unselect(r)};
g.mouseoutTimer=setTimeout(g.mouseoutTimerFn,g.delayHide||500)}}return!g.enableBubble});if(this.trigMode==="click")m.bind(this.clickEvent||"mousedown",function(){g.select(this);return false})}}};c.Box=p.reg("Box",t.create(c.Layer,{view:"Box"}));c.Tip=p.reg("Tip",t.create(c.Box,{cs:"win-fixed",autoHide:true,timeoutHide:1E3,timeoutShow:200,stayHover:false,offX:25,offY:-10,innerViewReady:function(){var e=this.jq();this.stayHover&&e.hover(t.bind(this.onMouseover,this),t.bind(this.onMouseout,this))},onMouseover:function(){this.clearHideTimer()},
onMouseout:function(){this.setHideTimer()},clearHideTimer:function(){if(this.hideTimerId){clearTimeout(this.hideTimerId);this.hideTimerId=false}},beforeShow:function(){if(a.prototype.beforeShow.apply(this,arguments)===false)return false;this.autoHide&&this.setHideTimer()},setShowTimer:function(e){if(e)this.showTimerId=setTimeout(t.getBind(this,"onTimerShow"),this.timeoutShow);else if(this.showTimerId){clearTimeout(this.showTimerId);this.showTimerId=false}},setHideTimer:function(){this.clearHideTimer();
this.hideTimerId=setTimeout(t.getBind(this,"onTimerHide"),this.timeoutHide)},onTimerHide:function(){this.display(false);this.clearHideTimer()},onTimerShow:function(){this.display(true);this.setShowTimer(false)}}))})(Xwb,$);(function(p,k){var t=p.util,s=document,q=p.ax.Tpl,o=p.ui;o.Dialog=p.reg("Dlg",t.create(o.Box,function(c){return{cs:"win-tips win-fixed",contentHtml:"DialogContent",focusBtnCs:"highlight",mask:true,closeable:true,initUI:function(){if(this.buttons&&!this.buttonHtml){for(var i=[],b=0,h=this.buttons,a=h.length;b<a;b++)i.push(q.parse(this.buttonTpl||"Button",h[b]));this.buttonHtml=i.join("")}c.initUI.call(this)},onClsBtnClick:function(){this.onbuttonclick("cancel")!==false&&this.close();return false},
setFocus:function(i){if(i||this.defBtn)this.jq("#xwb_btn_"+(i||this.defBtn)).focus().addClass(this.focusBtnCs)},afterShow:function(){c.afterShow.call(this);this.defBtn&&this.setFocus()},onbuttonclick:function(i){__debug&&console.log(i+" clicked")},setHandler:function(i){this.onbuttonclick=i;return this},getButton:function(i){return this.jq("#xwb_btn_"+i)},innerViewReady:function(i){c.innerViewReady.call(this,i);var b=this;k(i).find("#xwb_dlg_btns").click(function(h){if(h=t.domUp(h.target,function(e){return e.id&&
e.id.indexOf("xwb_btn_")===0},this)){var a=h.id.substr(8);b.buttons&&k.each(b.buttons,function(){if(this.id===a){var e;if(this.onclick)e=this.onclick(b);if(e!==false&&b["on"+a])e=b["on"+a]();e!==false&&b.onbuttonclick(a)!==false&&b.close()}});return false}})}}}));o.MsgBox=p.reg("msgbox",{getSysBox:function(){var c=this.sysBox;if(!c)c=this.sysBox=p.use("Dlg",{appendTo:s.body,title:"提示",dlgContentHtml:"MsgDlgContent",mask:true,buttons:[{title:"确&nbsp;定",id:"ok"},{title:"取&nbsp;消",id:"cancel"},{title:"&nbsp;是&nbsp;",
id:"yes"},{title:"&nbsp;否&nbsp;",id:"no"},{title:"关&nbsp;闭",id:"close"}],setContent:function(i){this.jq("#xwb_msgdlg_ct").html(i)},setIcon:function(i){var b=c.jq("#xwb_msgdlg_icon");b.attr("className",b.attr("className").replace(/icon\-\S+/i,"icon-"+i))},afterHide:function(){o.Dialog.prototype.afterHide.call(this);this.onbuttonclick=o.Dialog.prototype.onbuttonclick}});return c},getTipBox:function(){var c=this.tipBox;if(!c)c=this.tipBox=p.use("Tip",{cs:"win-tips win-fixed",contentHtml:"DialogContent",
appendTo:s.body,title:"提示",timeoutHide:1200,dlgContentHtml:"MsgDlgContent",setContent:function(i){this.jq("#xwb_msgdlg_ct").html(i)},setIcon:function(i){var b=c.jq("#xwb_msgdlg_icon");b.attr("className",b.attr("className").replace(/icon\-\S+/i,"icon-"+i))},afterHide:function(){o.Tip.prototype.afterHide.call(this);if(this.onhide){this.onhide();this.onhide=false}}});return c},getAnchorDlg:function(){var c=this._anchorDlg;if(!c)c=this._anchorDlg=p.use("Dlg",{cs:"win-tips-ask",mask:false,dlgContentHtml:"AnchorDlgContent",
appendTo:s.body,defBtn:"ok",buttons:[{title:"确&nbsp;定",id:"ok"},{title:"取&nbsp;消",id:"cancel"}],setAnchor:function(i){this.anchorEl=i;return this},beforeShow:function(){o.Dialog.prototype.beforeShow.call(this);if(this.anchorEl){this.anchor(this.anchorEl,"tc",function(b){b[1]-=2});var i=this;this.slide("bc",true,function(){o.Dialog.prototype.afterShow.call(i)})}},afterShow:k.noop,beforeHide:function(){if(this.anchorEl){this.slide("cb",false);delete this.anchorEl;return false}else o.Dialog.prototype.beforeHide.call(this)},
afterHide:function(){o.Dialog.prototype.afterHide.call(this);this.onbuttonclick=o.Dialog.prototype.onbuttonclick}});return c},getAnchorTip:function(){var c=this._anchorTip;if(!c)c=this._anchorTip=p.use("Tip",{view:"Box",cs:"operate-success",contentHtml:"AnchorTipContent",appendTo:s.body,timeoutHide:1800,setAnchor:function(i){this.anchorEl=i;return this},beforeShow:function(){if(this.anchorEl){this.anchor(this.anchorEl,"tc",function(i){i[1]-=8});this.slide("bc",true)}o.Tip.prototype.beforeShow.call(this)},
beforeHide:function(){if(this.anchorEl){this.slide("cb",false);delete this.anchorEl;return false}else o.Tip.prototype.beforeHide.call(this)},afterHide:function(){o.Tip.prototype.afterHide.call(this);if(this.onhide){this.onhide();this.onhide=false}}});return c},tipError:function(c,i){this.tip(c,"error",i)},tipOk:function(c,i){this.tip(c,"success",i)},tipWarn:function(c,i){this.tip(c,"alert",i)},anchorTipOk:function(c,i,b){this.anchorTip(c,i,"",b)},anchorConfirm:function(c,i,b){this.getAnchorDlg().setTitle(i).setHandler(b||
k.noop).setAnchor(c).display(true)},tip:function(c,i,b){var h=this.getTipBox();h.setIcon(i||"alert");h.setContent(c||"");h.display(true);b&&(h.onhide=b)},anchorTip:function(c,i,b,h){b=this.getAnchorTip();b.setTitle(i).setAnchor(c).display(true);h&&(b.onhide=h)},alert:function(c,i,b,h,a,e){var j=this.getSysBox(),m=j.buttons;h||(e=h="ok");a||(a="alert");for(var d=0,g=m.length;d<g;d++)j.jq("#xwb_btn_"+m[d].id).cssDisplay(h.indexOf(m[d].id)>=0);j.defBtn=e;c&&j.setTitle(c);i&&j.setContent(i);a&&j.setIcon(a);
b&&(j.onbuttonclick=b);j.display(true);return j},confirm:function(c,i,b,h){this.alert(c||"提示",i,b,"ok|cancel","ask",h||"ok")},success:function(c,i,b,h,a){this.alert(c,i,b,h||"ok","success",a||"ok")},error:function(c,i,b,h,a){this.alert(c,i,b,h||"ok","error",a||"ok")}})})(Xwb,$);(function(p){p.ax.Eventable.apply(p);p.ax.PipeMgr={pages:{},instances:{},reg:function(t,s,q){if(!q&&this.pages[t])throw"Object existed exception.["+t+"]";this.pages[t]=s;return this},start:function(t){p.cfg=t;p.fireOnce("pipe.start",t,this)},load:function(t){p.fire("page.before",t,this);var s=this.pages[t.pagelet]||this.pages[t.data&&t.data.cls];s||(s=k);s=typeof s==="function"?new s:new (s.pipe||k)(s);this.instances[t.id]=s;s.load(t);p.fire("page.after",s,this)},end:function(){p.fireOnce("pipe.end",
this)},getPage:function(t){return this.instances[t]}};p.reg("pipeMgr",Xwb.ax.PipeMgr);var k=p.ax.Pagelet=p.util.create();k.prototype={htmlMode:1,init:function(t){t&&$.extend(this,t)},load:function(t){this.id=t.id;this.type=t.pagelet;if(t.data&&t.data.cls)this.cls=t.data&&t.data.cls;if(t.perch){this.applyHtml(this.createContent(t));this.ui&&this.getUI();this.onViewReady(t)}},createContent:function(t){return t.html||""},applyHtml:function(t){var s=this._getPlaceholder();if(this.htmlMode===1){t=$(t);
if(t.length>1){var q=p.ax.Cache.get("div");t.appendTo(q);t=$(q)}$(s).replaceWith(t);this.contentView=t[0]}else if(this.htmlMode===2){$(s).html(t).cssDisplay(true);this.contentView=s}},getUI:function(){var t=this.ui;if(!t||!t.cacheId){this.ui=t=new (t?t.cls||p.ui.Base:p.ui.Base)($.extend({view:this.contentView},t));t.getView()}return t},jq:function(){var t=this.getUI();return t.jq.apply(t,arguments)},_getPlaceholder:function(){return document.getElementById(this.id)},onViewReady:$.noop};if(__debug)k.prototype.toString=
function(){return"#"+this.id+"["+this.type+"]"}})(Xwb);(function(p,k){var t=p.ui,s=p.util,q=document,o=t.Base,c=p.ax.Tpl,i=p.request,b=p.use("msgbox"),h=p.getCfg,a=p.getUid,e=p.getWb,j=p.setWb;if(!p.mod)p.mod={};var m=p.mod;p.reg("emotion",function(){var d=p.use("Box",{contentHtml:"Loading",boxOutterHtml:"ArrowBoxBottom",cs:"win-emotion",appendTo:q.body,closeable:true,actName:"em",contextable:true,actionMgr:true,emotions:null,$categorySelected:null,$categoryShowed:null,cateMaps:{},onactiontrig:function(g){switch(g.data.e){case "em":if(this.onselect)if(this.onselect(this.findEmotionText(g),
g)===false)break;this.display(false);break;case "sc":this.emSwitch(g.data.idx,g.src)}},setHandler:function(g){this.onselect=g;return this},setSelectionHolder:function(g,l,r){this.setHandler(function(u){g.insertText(u);l&&l.call(r||this,g,u)});return this},showAt:function(g){g=k(g).offset();g.left-=24;g.top+=20;this.offset(g).display(true)},initEmotion:function(g){if(g.isOk()){g=g.getData();var l={},r=[],u=[],w=0,v={};k.each(g,function(A,z){if(z.type=="face"){var B=z.category?z.category:"默认";if(l[B])l[B].push(z);
else{l[B]=[z];v[w]=l[B];u.push(['<a href="#" rel="e:sc,idx:',w,'">',B,"</a>"].join(""));w++}z.is_hot&&r.push(['<a href="#" rel="e:em" title="',z.phrase,'"><img width="22px" height="22px" src="',z.url,'" /></a>'].join(""))}});var x=[],y=0;k.each(l["默认"],function(A,z){z.is_hot&&y++;if(!z.is_hot||y>15)x.push(['<a href="#" rel="e:em" title="',z.phrase,'"><img width="22px" height="22px" src="',z.url,'" /></a>'].join(""))});if(r.length>15)r=r.slice(0,15);g={category:u.join(""),faces:x.join(""),hotList:r.join("")};
g=k(c.parse("EmotionBoxContent",g));this.jq("#xweibo_loading").hide();this.jq("#xwb_dlg_ct").append(g);this.$categorySelected=this.jq("#cate>a:first").addClass("current");this.$categoryShowed=this.jq("#flist0");this.emotions=l;this.cateMaps=v}},createEmArea:function(g){var l=['<div class="e-list" id="flist'+g+'">'];k.each(this.cateMaps[g],function(r,u){l.push(['<a href="#" rel="e:em" title="',u.phrase,'"><img width="22px" height="22px" src="',u.url,'" /></a>'].join(""))});l.push("</div>");return k(l.join(""))},
emSwitch:function(g,l){var r=k(l);if(!r.hasClass("current")){this.$categorySelected.removeClass("current");this.$categorySelected=r.addClass("current");this.$categoryShowed.addClass("hidden");g>0?this.jq("#hotEm").addClass("hidden"):this.jq("#hotEm").removeClass("hidden");r=this.jq("#flist"+g);r.length||(r=this.createEmArea(g).appendTo(this.jq("#box")));this.$categoryShowed=r.removeClass("hidden")}},loadEmotion:function(){var g=this;i.getEmotion(function(l){g.initEmotion(l)})},onViewReady:function(){this.loadEmotion()},
findEmotionText:function(g){return g.src.title}});p.reg("emotion",d,true);return d});p.reg("forwardBox",function(){var d=p.use("Dlg",{cs:"win-forward",appendTo:q.body,autoCenter:true,dlgContentHtml:"ForwardDlgContentHtml",title:"转发到我的微博",defBtn:"forward",buttons:[{title:"转 发",id:"forward"},{title:"取 消",id:"cancel"}],checkText:function(){var g=k.trim(this.jqInputor.val()),l=s.calWbText(g);l>=0?this.jqWarn.html("您还可以输入"+l+"字"):this.jqWarn.html("已超出"+Math.abs(l)+"字");this.jqWarn.checkClass("out140",
l<0);return l>=0&&g},onViewReady:function(){this.jq("#xwb_face_trig").click(s.bind(this.onFaceTrig,this));this.jqInputor=this.jq("#xwb_fw_input");this.jqWarn=this.jq("#xwb_warn_tip");this.jqContent=this.jq("#xwb_forward_text");this.jqLabelCt=this.jq("#xwb_fw_lbl");this.jqInputor.bind("keyup",s.bind(this.onInputorKeyup,this));this.selectionHolder=p.use("SelectionHolder",{elem:this.jqInputor[0]});this.atWho=p.use("atWho",{appendTo:q.body,Inputor:this.jqInputor,autoRender:true})},onInputorKeyup:function(g){if(this.checkText())if(g.ctrlKey&&
(g.which==13||g.which==10))this.submit()},onFaceTrig:function(g){p.use("emotion").setSelectionHolder(this.selectionHolder,this.checkText,this).showAt(g.target);return false},setContent:function(g,l,r){this._predCfg={id:g,data:l,uid:r};this.jq();var u=[];r!==l.u.id&&u.push(c.parse("ForwardDlgLabel",{uid:g,nick:l.u.sn}));if(r=l.rt){g=r.tx;l="//@"+l.u.sn+":"+l.tx;u.push(c.parse("ForwardDlgLabel",{uid:r.id,nick:r.u.sn}))}else{g=l.tx;l=""}this.jqContent.text(s.escapeHtml(g));this.selectionHolder.setText(l);
this.checkText();this.jqLabelCt.html(u.join(""));return this},submit:function(){if(this.isLoading)return false;this.isLoading=true;var g=this.checkText();if(g==="")g="转发微博";else if(!g){this.jqInputor.focus();return this.isLoading=false}var l=[];this.jq('input[type="checkbox"]:checked').each(function(){l[l.length]=k(this).val()});var r=this._predCfg;s.disable(this.getButton("forward"),true);i.repost(r.id,g,l.join(","),s.getBind(this,"onSubmitLoad"),{data:{_route:p.getModule()}})},onSubmitLoad:function(g){s.disable(this.getButton("forward"),
false);this.close();g.isOk()?b.tipOk("转发成功"):b.tipWarn(g.getCode()=="1040016"?"抱歉，目前微博转发功能暂不可用，请联系网站管理员！":g.getMsg());this.isLoading=false},onbuttonclick:function(g){if(g==="forward"){this.submit();return false}}});p.reg("forwardBox",d,true);return d});t.getFlash=function(d,g){var l=k.browser.msie;d=d||{};var r='<object width="'+d.width+'" height="'+d.height+(d.id?'" id="'+d.id:"")+(d.name?'" name="'+d.name:"")+'"';if(d.nocache)d.src+=(d.src.indexOf("?")!=-1?"&":"?")+Math.random();r+=d.w3c||l?' data="'+
d.src+'" type="application/x-shockwave-flash"':' classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000"';r+=">";if(d.w3c||l)r+='<param name="movie" value="'+d.src+'" />';d.width=d.height=d.id=d.w3c=d.src=null;d.onFail=d.version=d.expressInstall=null;for(var u in d)if(d[u])r+='<param name="'+u+'" value="'+d[u]+'" />';l="";if(g){for(var w in g)if(g[w]){u=g[w];l+=w+"="+(/function|object/.test(typeof u)?f.asString(u):u)+"&"}l=l.slice(0,-1);r+='<param name="flashvars" value=\''+l+"' />"}r+="</object>";return r};
t.WbElement=p.reg("WbElement",s.create(o,{init:function(){o.prototype.init.apply(this,arguments);this.picLoadState=0;this.isFw=this.wbData.rt?1:0;this.$preview=this.$wb.find("div.preview-img")},playVideo:function(d){d.get("w");d=d.get("i");d=p.mod.shortlink.getUrls()[d];var g=this.$wb.find("div.feed-content").width()-35,l=parseInt(g/1.25);l=t.getFlash({src:d.flash,width:g,height:l,w3c:1,id:"sinaVideo_"+ +new Date,quality:"high",allowScriptAccess:"always",wmode:"transparent",allowFullscreen:"true",
flashvars:"playMovie=true&auto=1"});this.$video&&this.$video.remove();var r;if(this.isFw){g="div.forward>p";r="VideoBoxForward"}else{g="p.feed-main";r="VideoBox"}d=c.parse(r,{href:d.url,title:d.title,flash:l});this.$video=k(d).insertAfter(this.$wb.find(g));this.switchView("video",1)},closeVideo:function(){this.switchView("video",0)},loadPic:function(){this.picLoadState=1;var d=this,g=this.wbData;g=this.isFw?{org:g.rt.op,img:g.rt.mp}:{org:g.op,img:g.mp};var l=this.$thumbImg=this.$wb.find("img.zoom-move");
this.$loadEl=k('<div class="loading-img"></div>').appendTo(l.parent());this.$picBox=k(c.parse(this.isFw?"PictureBoxForward":"PictureBox",g));l=this.img=new Image;k(l).bind("load",function(){d.onPicLoaded()}).addClass("narrow-move").attr("rel","e:zo").attr("src",g.img)},onPicLoaded:function(){var d=this.$wb.find(this.isFw?"div.forward":"div.feed-content:first"),g=this.img,l=this.$picBox;d.css("visibility","hidden");var r=this.$wb.find("div.feed-content").width()-35;k(g).appendTo(l.find("div[name=img]"));
d.children("div.preview-img").after(l);this.switchView("pic",1);if(g.width>r){if(k.browser.msie)g.height*=r/g.width;g.width=r}d.css("visibility","");this.$loadEl.remove();this.picLoadState=2},zoomIn:function(){if(this.picLoadState==0)this.loadPic();else this.picLoadState==2&&this.switchView("pic",1)},zoomOut:function(){this.switchView("pic",0)},trun:function(d){k(this.img).imgRotate(d)},switchView:function(d,g){if(g){if(d=="pic"){this.$picBox.show();this.$video&&this.$video.remove();this.$video=null}else if(d==
"video"){this.$video.show();this.$picBox&&this.$picBox.hide()}this.$preview.hide()}else{if(d=="pic")this.$picBox&&this.$picBox.hide();else if(d=="video"){this.$video&&this.$video.remove();this.$video=null}this.$preview.show()}}}));m.CmtBox=p.reg("CmtBox",s.create(o,{actionMgr:true,view:"CmtBox",exceedCS:"over-limit",autoH:true,wbUid:null,headPicType:1,innerViewReady:function(d){this.wbUid=p.getUid();o.prototype.innerViewReady.call(this,d);this.jqExtra("inputor","warn","sync");this.selectionHolder=
p.use("SelectionHolder",{elem:this.jqInputor[0]});var g=this;this.jqInputor.bind("keyup",function(l){g.onInputorKeyup(l)});this.atWho=p.use("atWho",{appendTo:q.body,Inputor:this.jqInputor,autoRender:true})},reset:function(){this.getView();this.selectionHolder.setText("");this.jqSync.attr("checked",false);this.checkText()},checkText:function(){var d=this.jqInputor,g=k.trim(d.val()),l=s.calWbText(g,70),r=this.jqWarn;l>=0?r.html("还可以输入"+l+"个字"):r.html("已超出"+Math.abs(l)+"个字");r.checkClass(this.exceedCS,
l<0);this.autoH&&d.height()!==d[0].scrollHeight&&d.height(d[0].scrollHeight);return l>=0&&g},send:function(){if(!this.sending){var d=this.checkText();if(d){this.sndBtn&&s.disable(this.sndBtn,true);this.sending=true;var g=this.jqInputor.data("xwb_reply_cid");g&&/^回复@.*?:/.test(d)?i.reply(this.wbId,g,d,this.jqSync.attr("checked")?1:0,this.headPicType,s.getBind(this,"onSendLoad"),{data:{_route:p.getModule()}}):i.comment(this.wbId,d,this.jqSync.attr("checked")?1:0,this.headPicType,s.getBind(this,"onSendLoad"),
{data:{_route:p.getModule()}})}else setTimeout(s.bind(function(){this.jqInputor.focus()},this),0)}},onSendLoad:function(d){if(d.isOk()){this.pCt.afterSend(d);this.reset();d=d.getData();d.html&&this.pCt.postWeibo(d.wb,d.html)}else b.tipWarn(d.getCode()==1040016?"抱歉，目前评论功能不可用，请联系网站管理员！":d.getMsg());this.pCt.afterNofocus||this.jqInputor.focus();this.sndBtn&&s.disable(this.sndBtn,false);this.sending=false},reply:function(d,g){var l=this.selectionHolder,r=this.jqInputor;this.reset();l.setText("回复@"+g+
":"+r.val().replace(/^回复@.*?:/,""));r.data("xwb_reply_cid",d);this.checkText();setTimeout(function(){l.focusEnd()},0)},onFaceTrig:function(d){p.use("emotion").setSelectionHolder(this.selectionHolder,this.checkText,this).showAt(d.src);return false},onInputorKeyup:function(d){if(this.checkText())if(d.ctrlKey&&(d.which==13||d.which==10))this.send()},onactiontrig:function(d){switch(d.data.e){case "ic":this.onFaceTrig(d);break;case "sd":if(!this.sndBtn)this.sndBtn=d.src;this.send()}}}));m.CommentArea=
p.reg("CmtArea",s.create(o,{view:"CommentArea",readSize:10,cmtType:1,hdPicSz:30,cmtCount:0,page:1,cmtPageSz:20,cmtBoxHtml:"CmtBox",commentHtml:"Comment",actionMgr:true,cmtBox:"CmtBox",initUI:function(){this.cmtUrl=i.mkUrl("show","","id="+this.wbId);this.jqExtra("pre","first","next");o.prototype.initUI.call(this)},getFromUser:function(){if(!this.wbUid){var d=e(this.wbId);this.wbUid=d&&d.u.id}return this.wbUid},innerViewReady:function(d){o.prototype.innerViewReady.call(this,d);this.jqExtra("cmtCt",
"more","lefCnt");this.initCmtBox()},decorateLoading:function(){this.isLoading?k(c.get("Loading")).appendTo(this.getView().parentNode):k(this.getView().parentNode).find("#xweibo_loading").remove();this.display(!this.isLoading)},initCmtBox:function(){this.cmtBox=p.use("CmtBox",{view:this.jq("#cmtBox")[0],wbId:this.wbId,pCt:this,headPicType:this.hdPicSz==30?1:2});this.cmtBox.getView()},load:function(d){this.getView();if(!this.isLoading){this.isLoading=true;this.decorateLoading();d&&(this.onload=d);i.getComments(this.wbId,
this.page,this.cmtType,s.getBind(this,"onCmtsLoad"))}},postWeibo:function(){},afterSend:function(d){d=k(this.createCmtUI(d.getData().comment));this.jqCmtCt.prepend(d);this.jqCmtCt.cssDisplay(true);this.updateCmtCountUI(1,true);p.mod.shortlink.render(d,function(g,l){l.title=g&&g.url||"无效链接"})},onCmtsLoad:function(d){if(d.isOk()){this.createListUI(d);var g=d.getData().total;g&&this.updateCmtCountUI(g);this.updateCmtPageUI(d.getData())}this.isLoading=false;this.decorateLoading();this.onload&&this.onload(d)},
createListUI:function(d){this.jqCmtCt.empty();var g=d.getData();g=g.total-Math.min(g.limit,g.total);var l=[];d.each(function(r){l[l.length]=this.createCmtUI(r)},this);if(l.length){this.jqCmtCt.html(l.join(""));if(g){this.jqMore.cssDisplay(true);this.jqLefCnt.text(g)}else this.jqMore.cssDisplay(false);this.jqCmtCt.cssDisplay(true)}else{this.jqCmtCt.cssDisplay(false);this.jqMore.cssDisplay(false)}p.mod.shortlink.render(this.jqCmtCt,function(r,u){u.title=r&&r.url||"无效链接"})},createCmtUI:function(d){var g=
this.getFromUser(),l=a();d.verifiedHtml=d.user.verified_html;d.usrUrl=d.user.profileUrl;d.picSz=this.hdPicSz;d.time=d.create_at;if(g===l||d.uid===l)d.canDel=true;return c.parse(this.commentHtml,d)},updateCmtPageUI:function(d){if(this.jqPre.length){this.jqPre.cssDisplay(this.page!==1);this.jqFirst.cssDisplay(this.page>=3);this.jqNext.cssDisplay(d.total!=0)}},updateCmtCountUI:function(d,g){if(this.trigEl)if(g===void 0){k(this.trigEl).text("评论("+d+")");this.cmtCount=d}else{this.cmtCount+=d;k(this.trigEl).text("评论("+
this.cmtCount+")")}},onactiontrig:function(d){switch(d.data.e){case "rp":this.onReplyTrig(d);break;case "dl":this.onDelTrig(d);break;case "nx":this.goPage(this.page+1);break;case "pr":this.goPage(this.page-1);break;case "fi":this.goPage(1)}},onDelTrig:function(d){var g=this;b.anchorConfirm(d.src,"确定要删除该评论吗？",function(l){if(l==="ok"&&!g.deletingCmt){g.deletingCmt=true;i.delComment(d.get("c"),function(r){var u=d.getEl("c");if(r.isOk()){k(u).remove();g.updateCmtCountUI(-1,true);g.cmtCount==0&&g.cmtBox.jqInputor.focus()}else b.tipError(r.getMsg());
g.deletingCmt=false})}})},onReplyTrig:function(d){var g=this.jq();this.offsetsTo(window)[1]<0&&g[0].scrollIntoView&&g[0].scrollIntoView();g=d.get("c");d=d.get("n");this.cmtBox.reply(g,d)},goPage:function(d){this.topCmtBox.getView().scrollIntoView&&this.topCmtBox.getView().scrollIntoView();this.page=d;this.load()}}));m.MBlogCmtArea=p.reg("MBlogCmtArea",s.create(m.CommentArea,{commentHtml:"MBlogCmt",cmtType:2,hdPicSz:50,createListUI:function(d){this.jqCmtCt.empty();d.getData();var g=[],l=this.faceSize;
d.each(function(r){if(l)r.profileImg=r.profileImg.replace("/30/","/"+l+"/");g[g.length]=this.createCmtUI(r)},this);if(this.cmtCount=g.length){this.jqCmtCt.html(g.join(""));this.jqCmtCt.cssDisplay(true)}else{this.jqCmtCt.cssDisplay(false);this.jqMore.cssDisplay(false)}p.mod.shortlink.render(this.jqCmtCt,function(r,u){u.title=r&&r.url||"无效链接"})},initCmtBox:function(){this.cmtBox=p.use("CmtBox",{wbId:this.wbId,pCt:this,view:"MBCmtBox",headPicType:this.hdPicSz==30?1:2});this.cmtBox.getView();this.topCmtBox=
p.use("CmtBox",{wbId:this.wbId,pCt:this,autoH:false,view:this.topCmtBox,headPicType:this.hdPicSz==30?1:2});this.topCmtBox.getView()},updateCmtCountUI:k.noop,onReplyTrig:function(d){this.cmtBox.jq().insertAfter(d.jq("c").find("#trigs"));var g=d.get("c");d=d.get("n");this.cmtBox.display(true).reply(g,d)},postWeibo:k.noop,afterSend:function(d){d=k(this.createCmtUI(d.getData().comment));this.jqCmtCt.prepend(d).cssDisplay(true);this.cmtBox.display(false);this.topCmtBox.jqInputor.focus();p.mod.shortlink.render(d,
function(g,l){l.title=g&&g.url||"无效链接"})},onload:function(){this.jq("#pager").cssDisplay(true);this.topCmtBox.jqInputor.focus()}}));p.reg("videoBox",function(){var d=p.use("Box",{cs:" win-insert",contentHtml:"MediaBoxContentHtml",boxOutterHtml:"ArrowBoxBottom",appendTo:q.body,actionMgr:true,closeable:true,contextable:true,onViewReady:function(){this.jqInputor=this.jq("#xwb_inputor");this.jqTip=this.jq("#xwb_err_tip");this.selectionHolder=p.use("SelectionHolder",{elem:this.jqInputor[0]})},onactiontrig:function(g){switch(g.data.e){case "ok":if(g=
this.checkText()){this.onselect&&this.onselect(g);this.close()}else this.jqInputor.focus();break;case "cc":this.close();break;case "nm":this.onselect&&this.onselect(k.trim(this.jqInputor.val()));this.close()}},checkText:function(){var g=this.jqInputor,l=this.selectionHolder,r=k.trim(g.val());if(r==""||r=="http://"){setTimeout(function(){g.focus();l.setText("http://");g.select()});return false}else if(!this.checkUrl(r)){this.jqTip.cssDisplay(true);return false}return r},checkUrl:function(g){return g.indexOf("http://")===
0},showAt:function(g,l){this.onselect=l;var r=k(g).offset();r.left-=140;r.top+=20;this.offset(r).display(true);var u=this;setTimeout(function(){u.selectionHolder.setText("http://");u.jqInputor.focus();u.jqInputor[0].select()},0);this.jqTip.cssDisplay(false)}});p.reg("videoBox",d,true);return d});p.reg("musicBox",function(){var d=p.use("Box",{cs:" win-insert",contentHtml:"MusicBoxContentHtml",boxOutterHtml:"ArrowBoxBottom",appendTo:q.body,closeable:true,actionMgr:true,contextable:true,onViewReady:function(){this.jqInputor=
this.jq("#xwb_inputor");this.jqTip=this.jq("#xwb_err_tip");this.selectionHolder=p.use("SelectionHolder",{elem:this.jqInputor[0]})},checkText:function(){var g=this.jqInputor,l=k.trim(g.val()),r=this.selectionHolder;if(l==""||l=="http://"){setTimeout(function(){g.focus();r.setText("http://");g[0].select()});return false}else if(!this.checkUrl(l)){this.jqTip.cssDisplay(true);return false}return l},checkUrl:function(g){return g.indexOf("http://")===0},onactiontrig:function(g){switch(g.data.e){case "ok":if(g=
this.checkText()){this.onselect&&this.onselect(g);this.close()}else this.jqInputor.focus();break;case "cc":this.onselect&&this.onselect();this.close();break;case "nm":this.onselect&&this.onselect(k.trim(this.jqInputor.val()));this.close()}},showAt:function(g,l){this.onselect=l;var r=k(g).offset();r.left-=140;r.top+=20;this.offset(r).display(true);var u=this;setTimeout(function(){u.selectionHolder.setText("http://");u.jqInputor.focus();u.jqInputor[0].select()},0);this.jqTip.cssDisplay(false)}});p.reg("musicBox",
d,true);return d});m.atWho=p.reg("atWho",s.create(t.Layer,{view:"atwho",now:0,length:0,key:"",atWhoShow:0,oldXhr:null,flagAt:null,useable:1,run:function(d){if(d===void 0)return this.useable;this.useable=d},onViewReady:function(){var d=this;this.Inputor.bind("keyup",function(g){d.showWho(g)}).bind("keydown",function(g){return d.onkeydown(g)}).bind("focus",function(g){d.showWho(g)}).bind("click",function(g){d.showWho(g)}).bind("blur",function(){if(d.atWhoShow)this.TimeoutID=setTimeout(function(){d.display(false);
d.atWhoShow=false},150)});this.jq("#mainUL").click(function(g){g.target.tagName=="LI"&&d.choose()});this.jq("#mainUL").mousemove(function(g){if(g.target.tagName=="LI"){k(this).find("li:eq("+d.now+")").removeClass("cur");k(g.target).addClass("cur");d.now=k(this).find("li").index(g.target)}})},showWho:function(){if(this.run()){var d=this.getKey(this.Inputor[0]);__debug&&console.log(d);if(this.txtobj=d)d.text!=this.key&&this.reload(d.text);else{this.key="";this.length=0;this.display(false)}}},onkeydown:function(d){if(this.atWhoShow)switch(d.keyCode){case 38:if(this.now==
0)return false;this.jq("#mainUL li:eq("+this.now+")").removeClass("cur").prev().addClass("cur");this.now--;return false;case 40:if(this.now+1==this.length)return false;this.jq("#mainUL li:eq("+this.now+")").removeClass("cur").next().addClass("cur");this.now++;return false;case 13:if(this.length!=0){this.choose();this.display(false)}return false;default:return true}},choose:function(d){var g=this.Inputor,l=g.data("xwb_selholder");d=d||this.now;var r=this.cache(this.key);if(r&&r.length){d=this.format(r[d]);
r=this.txtobj;this.run(0);if(l)l.replaceString(d,r.form,r.to);else{this.Inputor.val(s.stringReplace(g.val(),d,r.form,r.to));s.setCursor(g[0],r.form+d.length)}this.afterChoose();this.run(1)}},afterChoose:k.noop,format:function(d){return d.nickname+" "},getKey:function(d,g){var l=s.getCursorPos(d);g=d.value;var r=g.substring(l-1,l),u="";if(this.noAt===true)if(g.length!==0){this.flagAt=0;return{text:g,form:0,to:g.length}}else return false;if(r==" "||r=="@")return false;for(r=l;r>0;r--){if(g.substring(r,
r-1)==" ")break;if(g.substring(r,r-1)=="@"){u=g.substring(r,l);if(g.length>l)for(var w=l+1;w<=g.length;w++)if(g.substring(w,w-1)==" "||w==g.length){var v=g.substring(r,g.substring(w,w-1)==" "?w-1:w);k(this.data).each(function(){if(v==this.nickname)l=w})}this.flagAt=r;if(u.length>20)break;return{text:u,form:r,to:l}}}return false},rePosition:function(){var d=s.getCursorOffset(this.Inputor,this.flagAt-1);if(d){var g=this.Inputor.offset(),l=this.Inputor.scrollTop(),r=parseInt(k(this.Inputor).css("lineHeight"));
if(isNaN(r))r=20;l=r-l;this.jq().css({top:g.top+d.top+l,left:g.left+d.left})}return this},onResize:k.noop,beforeShow:function(){this.rePosition();t.Layer.prototype.beforeShow.apply(this,arguments)},afterShow:function(){__debug&&console.log("atWho: listen resize event.");this.onResize=s.bind(this.rePosition,this);k(window).resize(this.onResize);t.Layer.prototype.beforeShow.apply(this,arguments);this.atWhoShow=1},afterHide:function(){__debug&&console.log("atWho: unlisten resize event.");k(window).unbind("resize",
this.onResize);this.atWhoShow=0;t.Layer.prototype.afterHide.apply(this,arguments)},highlight:function(d,g){return d.replace(g,"<b>"+g+"</b>")},showUser:function(d){this.length=d.length;this.data=d;if(!d||!d.length)return this.display(0);var g=[],l=this.highlight,r=this;k.each(d,function(u,w){var v=w.remark,x="<li>"+l(w.nickname,r.key);if(v)x=x+"("+l(v,r.key)+")";x+="</li>";g.push(x)});this.now=0;this.jq("#mainUL").html(g.join("")).find(":first-child").addClass("cur");this.display()&&this.rePosition();
this.display(1)},loaded:function(d){if(d.isOk()){d=d.getData();this.cache(d.key,d.data);this.showUser(d.data)}},reload:function(d){this.key=d;var g=this.cache(this.key);__debug&&console.log("seach:",d,"return:",g,"cache:",m.atWho.cache);if(g!==void 0)this.showUser(g);else{if(this.oldXhr&&(this.oldXhr.readyState!==4||this.oldXhr.status!==200))this.oldXhr.abort();this.oldXhr=i.q(i.apiUrl("action","getAtUsers"),{keyword:this.key},s.getBind(this,"loaded"))}},cache:function(d,g){if(g===void 0)return m.atWho.cache[d];
m.atWho.cache[d]=g}}));m.atWho.cache={};m.PostBase={actionMgr:true,defText:"",initEx:function(){var d=this.jqInputor=this.jq("#xwb_inputor"),g=this.jqSendBtn=this.jq("#xwb_send_btn"),l=this.jq(this.focusEl||"#focusEl");this.jqWarn=this.jq("#xwb_word_cal");this.jqImgFile=this.jq("#xwb_img_file");this.jqBtnImg=this.jq("#xwb_btn_img");this.jqUploadTip=this.jq("#xwb_upload_tip");this.jqPhotoName=this.jq("#xwb_photo_name");this.jqForm=this.jq("#xwb_post_form");this.$uploadBtn=this.jq("#uploadBtn");this.selectionHolder=
p.use("SelectionHolder",{elem:this.jqInputor[0]});var r=this;this.jqImgFile.change(function(u){r.onImgFileChange(u)});this.btnHoverCS&&g.hover(function(){g.addClass(r.btnHoverCS)},function(){g.removeClass(r.btnHoverCS)});this.atWho=p.use("atWho",{appendTo:q.body,Inputor:d,autoRender:true});d.bind("keyup",function(u){r.onInputorKeyup(u)}).bind("focus",function(){l.addClass("post-focus")}).bind("blur",function(){l.removeClass("post-focus")})},getUploader:function(){if(!this.uploader)this.uploader=p.use("Uploader",
{form:this.jqForm[0],action:i.mkUrl("api/weibo/action","upload_pic"),onload:s.getBind(this,"onUploadLoad")});return this.uploader},reset:function(){this.jqUploadTip.cssDisplay(false);this.jqPhotoName.cssDisplay(false);this.$uploadBtn.cssDisplay(1);this.selectionHolder.setText(this.defText);this.jqForm[0].reset();this.uploadPic=false;this.checkText();this.sending=false;return this},onactiontrig:function(d){switch(d.data.e){case "sd":this.post();break;case "ic":p.use("emotion").setSelectionHolder(this.selectionHolder,
this.checkText,this).showAt(d.src);break;case "vd":p.use("videoBox").showAt(d.src,s.getBind(this,"onBoxTextReturn"));break;case "ms":p.use("musicBox").showAt(d.src,s.getBind(this,"onBoxTextReturn"));break;case "tp":this.insertTopic();break;case "dlp":this.uploadPic=false;this.$uploadBtn.cssDisplay(1);this.jqPhotoName.cssDisplay(false);this.jqInputor.focus()}},onBoxTextReturn:function(d){d&&this.selectionHolder.insertText(d);this.checkText()},checkText:function(){var d=k.trim(this.jqInputor.val()),
g=s.calWbText(d);g>=0?this.jqWarn.html("您还可以输入<span>"+g+"</span>字"):this.jqWarn.html("已超出<span>"+Math.abs(g)+"</span>字");this.jqWarn.checkClass("out140",g<0);return g>=0&&d},checkImg:function(d){d=d.split(".");return d.length&&k.inArray(d.pop().toLowerCase(),["jpg","png","gif","jpeg"])!==-1},onInputorKeyup:function(d){if(this.checkText())if(d.ctrlKey&&(d.which==13||d.which==10))this.post()},TOPIC_TIP:"请在这里输入自定义话题",insertTopic:function(d){if(!d)d=this.TOPIC_TIP;var g=this.jqInputor[0],l=RegExp("#"+
this.TOPIC_TIP+"#").test(g.value),r=d,u=0,w=0;g.focus();if(document.selection){var v=document.selection.createRange();r=v.text||d;if(r==d&&l){u=RegExp.leftContext.length+1;w=d.length}else if(r==d){v.text="#"+d+"#";u=g.value.indexOf("#"+d+"#")+1;w=d.length}else v.text="#"+r+"#";if(r==d){v=g.createTextRange();v.collapse();v.moveStart("character",u);v.moveEnd("character",w)}v.select()}else if(g.selectionStart||g.selectionStart=="0"){u=g.selectionStart;w=g.selectionEnd;if(u!=w)r=g.value.substring(u,w);
if(l&&r==d){u=RegExp.leftContext.length+1;w=u+r.length}else if(r==d){g.value=g.value.substring(0,u)+"#"+r+"#"+g.value.substring(w,g.value.length);u++;w=u+r.length}else{g.value=g.value.substring(0,u)+"#"+r+"#"+g.value.substring(w,g.value.length);w=u=u+r.length+2}g.selectionStart=u;g.selectionEnd=w}else g.value+="#"+r+"#";this.checkText();this.selectionHolder.saveSpot()},post:function(){var d=this.checkText();if(d)if(this.getUploader().isLoading())b.tipWarn("图片正在上传，请稍候..");else if(this.sending)b.tipWarn("正在发布,请稍候..");
else{var g=k.extend({},this.getParam());if(this.beforeSend){var l=this.beforeSend(d,this.uploadPic,g);if(l===false)return;d=l||d}this.sending=true;i.post(d,s.getBind(this,"onSendLoad"),this.uploadPic,{data:g})}else this.jqInputor.focus()},getParam:function(){var d=this.param;if(!d)d=this.param={};if(!d._route)d._route=p.getModule();return d},onImgFileChange:function(){var d=this.jqImgFile.val(),g=this;this.uploadPic=null;if(!d||!this.checkImg(d)){this.jqForm[0].reset();b.alert("","只支持 jpg、png、gif格式的图片。",
function(){g.jqInputor.focus()})}else{this.jq("#xwb_upload_tip").cssDisplay(true);this.$uploadBtn.cssDisplay(0);this.getUploader().upload()}},onUploadLoad:function(d){if(d.isOk()){this.uploadPic=d.getData().msg;this.jqPhotoName.html(s.getFileName(this.jqImgFile.val(),10)+c.get("UploadImgBtn"));this.jqPhotoName.cssDisplay(true);!k.trim(this.jqInputor.val())&&this.selectionHolder.setText("分享图片");this.checkText()}else{b.alert("",d.getCode()=="1040016"?"抱歉，目前图片发布功能不可用，请联系网站管理员！":d.getMsg());this.$uploadBtn.cssDisplay(1)}this.jqUploadTip.cssDisplay(false);
this.jqForm[0].reset();this.jqInputor.focus()},onSendLoad:function(d,g){var l=this.jqInputor;if(d.isOk()){var r=this.jqMask;if(!r){this.jqMask=r=this.jq("#xwb_succ_mask");this.jqMaskPt=r.parent()}r.cssDisplay(true).show().appendTo(this.jqMaskPt);l.focus();var u=this;r.fadeOut(1800,function(){r.remove();r[0].style.filter=null;u.reset();g&&g.call(u,d)})}else{b.alert("",d.getMsg(),function(){s.focusEnd(l[0])});this.sending=false}}};p.reg("postBox",function(){var d=k.extend({},m.PostBase);k.extend(d,
{title:"发微博",closeable:true,autoCenter:true,appendTo:q.body,mask:true,cs:"win-post",contentHtml:"PostBoxContent",onViewReady:function(){this.initEx()},onbuttonclick:function(g){if(g=="ok"){this.post();return false}},onSendLoad:function(g){m.PostBase.onSendLoad.call(this,g,function(l){if(l.isOk()){this.close();this.jqInputor[0].blur()}})}});d=p.use("Box",d);p.reg("postBox",d,true);return d});m.WeiboList=p.reg("WeiboList",s.create(o,{ctNode:"#xwb_weibo_list_ct",innerViewReady:function(d){o.prototype.innerViewReady.call(this,
d);this.jqCt=this.jq(this.ctNode);this.syncList&&p.on("api.update",this.onWbCreate,this)},onWbCreate:function(d){d=d.getData();var g=d.data,l;for(l in g){this.append(l,g[l],d.html);break}},append:function(d,g,l,r){this.item(d,g);r=r||{};if(l){l=k.trim(l);var u=k(l);r.append?u.appendTo(this.jqCt):u.prependTo(this.jqCt);if(r.noSlide){if(!r.cancelParseShortlink){l={};l[d]=g;p.mod.shortlink.from(l,function(w){p.mod.shortlink.renderWeiboShortlink(u,w[d],w[d].shortlinks)})}}else u.hide().fadeIn(1E3,function(){if(!r.cancelParseShortlink){var w=
{};w[d]=g;p.mod.shortlink.from(w,function(v){p.mod.shortlink.renderWeiboShortlink(u,v[d],v[d].shortlinks)})}});return u}},batchAppend:function(d,g,l){var r=[];l={noSlide:true,append:l,cancelParseShortlink:true};for(var u in d)r.push(u,this.append(u,d[u],g[u],l));p.mod.shortlink.from(d,function(w){for(var v=0,x=r.length;v<x;v+=2){var y=r[v],A=r[v+1];A&&p.mod.shortlink.renderWeiboShortlink(A,w[y],w[y].shortlinks)}})},item:function(d,g){if(g===void 0)return e(d);j(d,g)}}));m.SearchEntry=p.reg("SearchEntry",
s.create(o,{focusText:"搜微博/找人",focusCs:"search-box-focus",maxLen:30,innerViewReady:function(d){o.prototype.innerViewReady.call(this,d);d=this.jqInputor=this.jq("#xwb_inputor");var g=this;this.jq("#xwb_trig").click(function(){return g.submit()});d.keydown(function(l){l.keyCode===13&&g.submit()});this.focusText&&d.focusText(this.focusText,this.focusCs,this.getView())},submit:function(){var d=k.trim(this.jqInputor.val());if(d==this.focusText)d="";if(d){d=encodeURIComponent(s.byteCut(d,this.maxLen));
d=i.mkUrl("search","","k="+d);window.location.href=d}else this.jqInputor.focus()}}));m.shortlink=new p.ax.Shortlink({renderWeiboShortlink:function(d,g,l){g=d.find("a");var r=this,u,w,v,x=d.find("div.forward"),y=d.find("p.feed-main"),A;g.each(function(){if(u=r.is(this.href)){var z=k(this);if(w=l[u]){v=w[1];if(w=w[0]){z.attr("title",w.url);switch(w.type){case "music":z.addClass("icon-music-url icon-bg");break;case "video":z.addClass("icon-video-url icon-bg");if(v){A=x.find(">div.preview-img");A.length||
(A=k(c.parse("PreviewBox")).appendTo(x))}else{A=y.next("div.preview-img");A.length||(A=k(c.parse("PreviewBox")).insertAfter(y))}if(v||!v&&!x.length){z.attr("rel","e:pv,i:"+w.id);k(c.parse("VideoThumbHtml",{img:w.screen,id:w.id})).appendTo(d.find((v?"div.forward ":"")+"div.preview-img"))}}}else z.attr("title","无效链接")}else{__debug&&console.warn("未解析链接：@"+u+" From "+z.attr("href")+",请在Xwb.ax.Shortlink.from内添加解析区域");z.attr("title",z.attr("href")||"")}}})}});p.reg("myMsg",function(){var d=p.use("Box",
function(g){return{contentHtml:"PrivateMsgContent",appendTo:q.body,cs:"win-mes",actionMgr:true,title:"发私信",autoCenter:true,closeable:true,mask:true,onViewReady:function(){var l=this;this.jqExtra("word","warn","sender","content","warnPos","uid");this.jqContent.keyup(s.bind(this.checkText,this));this.jqSender.blur(function(){var r=k.trim(this.value);l.checkFans(r,1,null,true)});this.selectionHolder=p.use("SelectionHolder",{elem:this.jqContent[0]});this.atWho=p.use("atWho",{appendTo:q.body,Inputor:this.jqSender,
autoRender:true,format:function(r){return r.nickname},afterChoose:function(){l.jqContent.focus()},noAt:true})},checkText:function(){var l=k.trim(this.jqContent.val()),r=s.calWbText(l,140);this.jqWord.html(r>=0?"您还可以输入"+r+"个字":"已超出"+Math.abs(r)+"字");return r>=0&&l},afterShow:function(){g.afterShow.call(this);this.jqSender.val()===""?this.jqSender.focus():this.jqContent.focus()},onactiontrig:function(l){switch(l.data.e){case "sd":this.send();break;case "ic":p.use("emotion").setSelectionHolder(this.selectionHolder,
this.checkText,this).showAt(l.src)}},send:function(){if(!this.sending){var l=this.validate(),r=s.getBind(this,"onSendLoad"),u=this.jqSendBtn;l&&this.checkFans(l.u,l.t,function(){s.disable(u,true);i.msg(l.u,l.t,l.c,r)})}},onSendLoad:function(l){if(l.isOk())this.display(false);else{var r;switch(l.getCode()){case 20014:b.alert("",l.getMsg());break;case 1010005:alert("内容长度不能超过140个字。");this.jqContent.focus();break;default:r=l.getMsg()}r&&this.display()&&this.jqWarnPos.cssDisplay(true).text(r)}this.sending=
false;s.disable(this.jqSendBtn,false)},checkFans:function(l,r,u,w){var v=this;l?i.followed(l,function(x){if(x.isOk())if(x.getData()){v.jqWarnPos.cssDisplay(false);u&&u.call(this,x)}else{v.jqWarnPos.cssDisplay(true).text(i.ERRORMAP["20016"]);!w&&v.jqSender.focus()}else{v.jqWarnPos.cssDisplay(true).text(x.getMsg());!w&&v.jqSender.focus()}},r):v.jqWarnPos.cssDisplay(true).text("请输入要发送的用户昵称。")},reset:function(){this.jqSender.attr("disabled",false).val("");this.jqContent.val("");this.jqUid.val("");this.jqWarnPos.cssDisplay(false);
this.checkText();return this},validate:function(){var l=k.trim(this.jqSender.val()),r=this.checkText(),u=this.jqUid.val();if(l)if(r){if(u)return{u:u,c:r};return{u:l,c:r,t:1}}else{k.trim(this.jqContent.val()).length?b.tipWarn("内容长度不能超过140个字。"):b.tipWarn("请输入私信内容。");this.jqContent.focus()}else this.jqSender.focus()},reply:function(l,r){this.getView();this.reset();this.display(true);this.jqSender.val(r).attr("disabled",true);this.jqUid.val(l);this.jqContent.focus();this.checkText()}}});p.reg("myMsg",
d,true);return d});p.reg("notice",function(d){var g=p.use("Layer",function(l){return k.extend({view:"NoticeLayer2",hidden:true,closeable:true,actionMgr:true,remindType:1,clearOnClose:true,types:["wbs","refer","cmts","fans","msgs","notify"],wbsUrl:i.mkUrl("index"),referUrl:i.mkUrl("index","atme"),cmtsUrl:i.mkUrl("index","comments"),msgsUrl:i.mkUrl("index","messages"),fansUrl:i.mkUrl("index","fans"),notifyUrl:i.mkUrl("index","notices"),initUI:function(){if(this.remindType)this.view="NoticeLayer";l.initUI.call(this);
this.getView();p.on("api.unread",s.bind(this.unreadLoad,this))},push:function(r,u){var w=this.jq("#"+r),v=w.find("#c"),x=parseInt(v.text());if(u!=x){v.text(u);w.cssDisplay(!!u)}u&&!this.display()&&this.display(true)},onclose:function(){this.clearOnClose&&this.clearUnread()},clearUnread:function(){var r=this;k.each(this.types,function(){var u=r.jq("#"+this);u.cssDisplay(false);u.find("#c").text("0")});i.clearUnread("",k.noop)},unreadLoad:function(r){if(r.isOk()){r=r.getData().unread;for(var u=true,
w=1,v=this.types.length;w<v;w++)if(r[w]){this.push(this.types[w],r[w]);u=false}u&&this.display(false)}}},d)});p.reg("notice",g,true);return g});p.mod.Skin=function(d){return p.use("base",k.extend({actionMgr:true,skinSelectedCS:"current",onViewReady:function(){this.tab=p.use("Switcher",this.tab)},onactiontrig:function(g){switch(g.data.e){case "cs":this.change(g.get("sk"),g.get("id"));this.decorateSelected(g.src);break;case "sv":if(this.using)this.save(this.using);else{this.display(false);this.reload()}break;
case "cc":this.usedSkin&&this.change(this.usedSkin);this.close();this.reload()}},beforeHide:function(){if(k.browser.msie){var g=p.ax.Cache.get("div");k("#wrapper").css("clear","both");p.ax.Cache.Cache.put(g)}},change:function(g,l){var r=this;k("link[rel=stylesheet]").each(function(){if(this.href.indexOf("/skin.css")!==-1){if(!r.usedSkin)r.usedSkin=this.href.match(/\/css\/default\/([\S\s]*?)\/skin.css$/i)[1];this.href=this.href.replace(/\/css\/default\/[\S\s]*?\/skin.css$/i,"/css/default/"+g+"/skin.css")}});
this.using=l},save:function(g){var l=this;i.saveSkin(g,function(r){if(r.isOk()){l.display(false);l.reload()}else b.alert("",r.getMsg())})},reload:function(){window.location=String(window.location.href).replace(/skinset[^A-Za-z0-9\/]{1}1/g,"")},decorateSelected:function(g){if(!this.jqPreSel)this.jqPreSel=this.jq("#tabPanels ."+this.skinSelectedCS);this.jqPreSel.removeClass(this.skinSelectedCS);this.jqPreSel=k(g);this.jqPreSel.addClass(this.skinSelectedCS)}},d))};p.reg("feedback",function(d){var g=
p.use("Box",k.extend({view:k("#feedbackBox")[0],mask:true,closeable:true,onViewReady:function(){this.view.parentNode!==q.body&&this.appendAt(q.body);var l=this.jq("#fbForm");this.validator=p.use("Validator",{form:l,trigger:this.jq("#trig"),validators:{radio:function(r,u,w,v){r=k(this.context.form).find('input[name="mail"]').val();u=k(this.context.form).find('input[name="qq"]').val();if(r=="邮箱地址"&&u=="QQ"){w.m="至少填写一种联系方式";this.report(false,w)}else this.report(true,w);v()}},onsuccess:function(r,u){i.feedback(r,
function(w){w.isOk()||b.tipWarn(w.getMsg());g.close();u()});return false}})},afterShow:function(){p.ui.Box.prototype.afterShow.call(this);this.reset()},reset:function(){this.jq("[name=content]").val("").focus();this.jq("[name=mail]").val("邮箱地址");this.jq("[name=qq]").val("QQ");this.jq("#feedbackTip").cssDisplay(false)}},d));p.reg("feedback",g,true);return g});m.authLogin={open:function(d,g){var l=this.logWin;if(l&&!l.closed)l.focus();else{l=i.mkUrl("account","sinaLogin","popup=1&cb="+(d||""));if(g)l+=
"&loginCallBack="+encodeURIComponent(g);this.logWin=window.open(l,"logWin","resizable=1,location=0,status=0,scrollbars=0,width=570,height=380");if(!window.loginCallback)window.loginCallback=s.bind(this.onPopupCallback,this)}},direct:function(d){var g=location.href;if(p.getModule()==="account.login")g=s.dequery(g).loginCallBack||g;this.open(d,g);return false},bind:function(d,g){var l=this;k(d).bind(g||"click",function(){l.direct()})},onPopupCallback:function(d){this.logWin.close();if(d)location.href=
d;else{d=p.getModule();if(d.indexOf("pub")||d.indexOf("index"))location.href=i.mkUrl("pub");else location.reload()}}};m.loginBox=p.reg("loginBox",function(){var d=p.use("Box",{contentHtml:"Login",cs:"win-bind-login win-fixed",appendTo:q.body,mask:true,closeable:true,onViewReady:function(){m.authLogin.bind(this.jq("#oauth"))},siteName:h("siteName"),siteLoginUrl:i.mkUrl("account","siteLogin"),regUrl:p.getCfg("siteReg"),sinaRegUrl:p.getCfg("sinaReg")});p.reg("loginBox",d,true);return d});m.FadeShow=
p.reg("FadeBox",s.create(o,{curr:0,length:0,duration:300,delay:5E3,running:false,runTimer:null,onViewReady:function(){this.$list=k(this.view).children();this.length=this.$list.length;var d=this;k(this.view).mouseover(function(){d.stop()}).mouseout(function(g){g=g.relatedTarget;if(!g||!k.contains(d.view,g))d.start()});this.start()},start:function(){if(!(this.length<=1))if(!this.runTimer){var d=this;this.runTimer=setTimeout(function(){d.fade()},this.delay);this.running=true}},stop:function(){if(this.runTimer){clearTimeout(this.runTimer);
this.runTimer=null}this.running=false},fade:function(){var d=this.curr,g=++this.curr,l=this;if(g>=this.length)this.curr=g=0;var r=k(this.$list[d]),u=k(this.$list[g]);r.animate({opacity:0},{duration:l.duration,complete:function(){r.addClass("next");u.removeClass("next").css({opacity:0}).animate({opacity:1},{duration:l.duration,complete:function(){l.runTimer=null;l.running&&l.start()}})}})}}));p.mod.HoverList=s.create(o,{innerViewReady:function(){o.prototype.innerViewReady.call(this);this.jq(this.itemSelector).hover(this.onMouseOver,
this.onMouseOut)},onMouseOver:k.noop,onMouseOut:k.noop});p.reg("addFollow",function(d){d=p.use("Box",k.extend({actionMgr:true,cs:"add-topic",boxOutterHtml:'<div class="arrow all-bg"></div>',closeable:true,contentHtml:"addFollowContent",onactiontrig:function(g){var l=this;switch(g.get("e")){case "cls":this.close();break;case "submit":g.lock(1);i.postReq(i.apiUrl("action","addSubject"),{text:this.jq("#Content").val()},function(r){if(r.isOk()){p.fire("subrefresh",{subject:l.jq("#Content").val(),type:"add"});
l.close()}else{l.jq(".warn").prev("p").addClass("hidden");l.jq(".warn").removeClass("hidden").html(r.getError())}g.lock(0)})}},beforeShow:function(){var g=this.jq("#Content").val("");setTimeout(function(){g.focus()},1)},onViewReady:function(){var g=this;this.jq("#Content").focus(function(){g.jq(".warn").cssDisplay(false);g.jq(".warn").prev("p").cssDisplay(true)})}},d));d.display(true);return d});p.reg("MoreList",function(d){d=p.use("Layer",k.extend({closeable:true,contextable:true,actionMgr:true,
onactiontrig:function(g){var l=g.data,r=g.get("u");switch(l.e){case "abl":b.confirm("提示","确定将"+l.nick+"加入到黑名单吗？<span>你和"+(l.gender=="f"?"她":"他")+"将自动解除关注关系，并且她不能再关注你，给你发评论、私信、@通知。</span>",function(u){u==="ok"&&i.blacklistAdd(r,"",function(w){w.isOk()&&window.location.reload()})})}}},d));p.reg("MoreList",d,true);return d});p.report=function(){function d(){var v=k.cookie("x3w4b");if(!v){v=(v=void 0)||16;for(var x=["u"],y,A=0;A<v;A++){y=Math.ceil(Math.random()*62)-1;x.push("0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".charAt(y))}v=
x.join("");k.cookie("x3w4b",v,{expires:9E4})}return v}function g(v){v.random=Math.random();v.c_id=d();v.akey=p.getCfg("akey");v.p_id=p.getCfg("page");var x=p.getCfg("uid");if(x)v.uid=x;v=k.extend(v,u);var y=[];k.each(v,function(A,z){y.push(A+"="+encodeURIComponent(z))});r.src=l+"?"+y.join("&")}var l="http://beacon.x.weibo.com/a.gif",r,u={pjt:"xwb",ver:"2.0",xt:"stay"},w=function(){function v(){if(!y){a();r=new Image;y=true}}function x(){var B=(new Date).getTime(),C={time:B-(z?z:A),p:p.getCfg("page")};
if(!z&&document.referrer)C.t_id=document.referrer;g(C);z=B}var y=false,A=(new Date).getTime(),z=0;return{start:function(){v();window.setInterval(x,18E5)},report:function(){!y&&v();x()}}}();return{start:function(){w.start()},report:function(){w.report()}}}();p.mod.AdMgm={init:function(d){d=this.cfgs=d||{};for(var g=!!this.globalHandlers,l=this.handlers,r=0,u=d.length;r<u;r++){var w=d[r];g&&this.fireGlobal(w);l&&l[w.flag]&&l[w.flag](w,this)}this.inited=true},fireGlobal:function(d){var g=this.globalHandlers;
if(g)for(var l=0,r=g.length;l<r;l++)g[l](d,this)},reg:function(d,g){if(g===void 0)if(this.globalHandlers)this.globalHandlers.push(d);else this.globalHandlers=[d];else{if(!this.handlers)this.handlers={};this.handlers[d]=g;this.inited&&this.cfgs[d]&&g(this.cfgs[d],this)}},getAd:function(d){if(!d)return this.cfgs;if(this.cfgs)for(var g=0;g<this.cfgs.length;g++)if(this.cfgs[g].flag==d)return this.cfgs[g]}}})(Xwb,jQuery);(function(p,k){var t=p.request,s=p.ui.MsgBox,q=p.getCfg,o=p.getWb;p.use("action").addFilter(function(c,i){if(!i||!i.na){var b=p.getUid(),h=p.getSiteUid(),a=q("loginCfg")||1;if(!b){if(c.get("e")=="lg")a=c.data.t||a;if(h)if(c.get("e")=="lg")p.mod.authLogin.direct("bind");else window.location=t.mkUrl("account","bind");else switch(parseInt(a,10)){case 3:p.use("loginBox").display(true);break;case 2:window.location=t.mkUrl("account","siteLogin");break;default:p.mod.authLogin.direct()}return false}}},true).reg("sd",
function(c){var i=p.use("postBox");c=c.get("m");i.display(true).reset().selectionHolder.setText(c||"");c&&i.checkText()}).reg("fw",function(c){c=c.get("w");Xwb.use("forwardBox").display(true).setContent(c,o(c),p.getUid()).selectionHolder.focusStart()}).reg("fl",function(c){var i=c.get("u");k(c.src);c.lock(1);t.follow(i,0,function(b){if(b.isOk()||b.getCode()=="1020805"){b=c.get("t");var h=k(c.src);switch(parseInt(b)){case 1:h.replaceWith('<span class="followed-btn">已关注</span>');break;case 2:h.replaceWith("<em>已关注</em>");
break;case 3:h.replaceWith('<div class="operated-box"><span class="followed-btn">已关注</span><em>|</em><a href="#" rel="e:ufl,t:3" class="cancel">取消</a></div>');break;default:location.reload()}}else b.getCode()=="1020806"?s.confirm("","你今天已经关注了足够多的人，先去看看他们在说些什么吧？",function(a){if(a=="ok")location.href=Req.mkUrl("ta","","id="+i)}):s.tipWarn(b.getMsg());c.lock(0)})}).reg("ufl",function(c){s.anchorConfirm(c.src,"确定要取消关注？",function(i){if(i=="ok"){c.lock(1);i=c.get("u");var b=parseInt(c.get("t"));t.unfollow(i,
"",function(h){if(h.isOk())switch(b){case 1:k(c.src).replaceWith('<a rel="e:fl,t:2" href="#">关注他</a>');break;case 3:k(c.src).parent().replaceWith('<a class="skin-bg addfollow-btn" rel="e:fl,t:3" href="#">加关注</a>');break;default:window.location.reload()}else s.tipWarn(h.getMsg());c.lock(0)})}})}).reg("rs",function(c){var i=c.get("w");c=o(i);var b=Xwb.use("Box",{cs:"win-report",contentHtml:"SpanBoxContent",title:"举报不良信息",appendTo:document.body,closeable:true,mask:true,destroyOnClose:true,actionMgr:true,
autoCenter:true,nick:c.u.sn,img:c.u.p,text:c.tx,onactiontrig:function(h){switch(h.data.e){case "ok":h=this.jq("#content").val();t.reportSpam(i,h,function(a){a.isOk()&&s.success("","您的举报已提交，我们将尽快处理，感谢您对我们工作的支持！");b.close()});break;case "cancel":this.close()}}});b.display(true);b.jq("#content").focus()}).reg("blm",function(c){s.anchorConfirm(c.src,"确定要屏蔽该微博？",function(i){if(i=="ok"){i=c.get("w");c.lock(1);t.shieldBlog(i,function(b){if(b.isOk()){s.anchorTipOk(c.src,"屏蔽成功！");k(c.src).replaceWith("<span>已屏蔽</span>")}c.lock(0)})}})}).reg("rl",
function(){location.reload()},{na:true}).reg("fr",function(c){var i=c.get("w");c.lock(1);t.fav(i,function(b){if(b.isOk()){s.anchorTipOk(c.src,"收藏成功！");k(c.src).replaceWith("<span>已收藏</span>")}else s.tipWarn(b.getMsg());c.lock(0)})}).reg("ufr",function(c){s.anchorConfirm(c.src,"确定要删除该收藏？",function(i){if(i=="ok"){c.lock(1);i=c.get("w");t.delFav(i,function(b){if(b.isOk())if(c.data.t==1){var h=k(c.getEl("w"));h.slideUp(500,function(){h.remove();c.lock(0)})}else{k(c.src).replaceWith('<a rel="e:fr" href="#">收藏</a>');
c.lock(0)}})}})}).reg("cm",function(c){var i=c.get("w"),b=k(c.getEl("w")),h=b.data("xwb_cmt");if(!h){var a=o(i);h=p.use("CmtArea",{wbId:i,wbUid:a&&a.u.id,appendTo:b.find(".feed-content"),trigEl:c.src});b.data("xwb_cmt",h)}if(h.display())h.display(false);else{h.display(true);h.load(function(){h.cmtBox.jqInputor.focus()})}}).reg("tl",function(c){var i=k(c.getEl("w")),b=i.data("wbEle");if(!b){c=c.get("w");b=p.use("WbElement",{$wb:i,wbData:o(c)});i.data("wbEle",b)}b.trun("left")},{na:true}).reg("tr",
function(c){var i=k(c.getEl("w")),b=i.data("wbEle");if(!b){c=c.get("w");b=p.use("WbElement",{$wb:i,wbData:o(c)});i.data("wbEle",b)}b.trun("right")},{na:true}).reg("zo",function(c){var i=k(c.getEl("w")),b=i.data("wbEle");if(!b){c=c.get("w");b=p.use("WbElement",{$wb:i,wbData:o(c)});i.data("wbEle",b)}b.zoomOut()},{na:true}).reg("zi",function(c){var i=k(c.getEl("w")),b=i.data("wbEle");if(!b){c=c.get("w");b=p.use("WbElement",{$wb:i,wbData:o(c)});i.data("wbEle",b)}b.zoomIn()},{na:true}).reg("pv",function(c){var i=
k(c.getEl("w")),b=i.data("wbEle");if(!b){b=c.get("w");b=p.use("WbElement",{$wb:i,wbData:o(b)});i.data("wbEle",b)}b.playVideo(c)},{na:true}).reg("cv",function(c){var i=k(c.getEl("w")),b=i.data("wbEle");if(!b){b=c.get("w");b=p.use("WbElement",{$wb:i,wbData:o(b)});i.data("wbEle",b)}b.closeVideo(c)},{na:true}).reg("dl",function(c){var i=c.get("w");s.anchorConfirm(c.src,"确定删除该微博吗？",function(b){if(b==="ok"){c.lock(1);t.del(i,function(h){var a=k(c.getEl("w"));h.isOk()?a.slideUp("normal",function(){a.remove()}):
s.tipWarn(h.getMsg());c.lock(0)})}})}).reg("clsevt",function(c){var i=c.get("id");i&&s.anchorConfirm(c.src,"确定要关闭此活动？",function(b){if(b==="ok"){c.lock(1);t.eventClose(i,function(h){h.isOk()?location.reload():s.tipWarn(c.getMsg())})}})}).reg("delevt",function(c){var i=c.get("id");i&&s.anchorConfirm(c.src,"确定要删除此活动？",function(b){if(b==="ok"){c.lock(1);t.eventDelete(i,function(h){h.isOk()?location.reload():s.tipWarn(c.getMsg())})}})}).reg("mop",function(c){c=k(c.src);var i=c.data("morelayer");if(!i){i=
p.use("MoreList",{view:k("#more_list")[0]});c.data("morelayer",i)}i.display(1)}).reg("sdm",function(c){var i=p.use("myMsg");i.display(true).reset();var b=c.get("c");b&&i.selectionHolder.setText(b);(c=c.get("n"))&&i.jqSender.val(c);c?i.jqContent.focus():i.jqSender.focus()}).reg("rm",function(c){p.use("myMsg").reply(c.get("u"),c.get("n"))}).reg("dm",function(c){s.anchorConfirm(c.src,"确定要删除该私信？",function(i){if(i=="ok"){c.lock(1);i=c.get("m");t.delMsg(i,function(b){b.isOk()&&location.reload();c.lock(0)})}})}).reg("dbl",
function(c){function i(){c.lock(1);var h=c.get("u");t.blacklistDel(h,"",function(a){a.isOk()?location.reload():s.tipWarn(a.getMsg());c.lock(0)})}var b=c.data.m;b?s.confirm("提示",b,function(h){h==="ok"&&i()}):i()}).reg("dfan",function(c){s.confirm("提示","移除之后将取消"+name+"对你的关注?",function(i){if(i=="ok"){i=c.get("u");var b=c.getEl("u");c.lock(1);t.removeFans(i,"",function(h){if(h.isOk())k(b).slideUp(500,function(){c.lock(0);k(b).remove()});else{s.tipWarn(c.getMsg());c.lock(0)}})}})}).reg("addSubject",function(c){var i=
k(c.src);c.lock(1);t.postReq(t.apiUrl("action","addSubject"),{text:c.get("subject")},function(b){if(b.isOk()){i.parent().replaceWith('<span>已关注(<a href="javascript:;" rel="e:delSubject">取消关注</a>)</span>');p.fire("subrefresh",{subject:c.get("subject"),type:"add"})}else s.alert("提示",b.getError());c.lock(0)})}).reg("delSubject",function(c){var i=k(c.src);c.lock(1);t.postReq(t.apiUrl("action","deleteSubject"),{text:c.get("subject")},function(b){if(b.isOk()){i.parent().replaceWith('<span class="topic-follow"><a href="javascript:;" rel="e:addSubject">关注该话题</a></span>');
p.fire("subrefresh",{subject:c.get("subject"),type:"del"})}else s.alert("提示",b.getError());c.lock(0)})})})(Xwb,$);(function(p,k){Xwb.ax.ValidationMgr.prototype.reg("ft",function(t,s,q,o){if(arguments.length==2){var c=t.value||arguments[1].w;k(t).data("vrel_ft_text",c).focusText(c)}else{c=k(t).data("vrel_ft_text");s==c&&this.setValue("");this.report(true,q);o()}}).reg("ne",function(t,s,q,o){var c=s==="",i=k(t).data("vrel_ft_text")||q.w;if(!c&&i)(c=s==i)&&this.setValue("");if(c&&!q.m)q.m="该项不能为空";if(t.tagName==="INPUT"&&(t.type==="radio"||t.type==="checkbox"))c=!t.checked;this.report(!c,q);o()}).reg("f",function(t,
s){var q=this,o=t.tagName.toLowerCase();if(q.context.comForm&&(o=="input"||o=="textarea")){var c=q.context.focusCss;k(t).blur(function(){k(this).removeClass(c);s.ch||q.validate()}).focus(function(){k(this).removeClass(q.context.errCss);k(this).addClass(c)})}else k(t).blur(function(){q.validate()})}).reg("sz",function(t,s,q,o){if(s){t=q.ww?Xwb.util.byteLen(s):s.length;var c;s=q.max;var i=q.min;if(s!==undefined&&parseInt(s)<t)c=true;if(i!==undefined&&parseInt(i)>t)c=true;this.report(!c,q)}else this.report(true,
q);o()}).reg("dt",function(t,s,q,o){if(s){if(!q.m)q.m="不是有效的日期格式";t=Date.parse(s);this.report(!isNaN(t),q)}else this.report(true,q);o()}).reg("mail",function(t,s,q,o){if(s){t=/\w+([-+.]\w+)*@\w+([-.]\w+)*\.\w+([-.]\w+)*/.test(s);if(!q.m&&q.m!==0)q.m="请输入正确的邮箱格式";this.report(t,q)}else this.report(true,q);o()}).reg("int",function(t,s,q,o){if(s!==""){t=s&&/^\d+$/.test(s);if(!q.m&&q.m!==0)q.m="该项为数字格式";this.report(t,q)}else this.report(true,q);o()}).reg("bt",function(t,s,q,o){if(s!==""){t=parseInt(q.min);
var c=parseInt(q.max);s=parseInt(s);var i=0;if(s<t)i=1;if(!i&&s>c)i=2;this.report(!i,q)}else this.report(true,q);o()}).reg("sinan",function(t,s,q,o){if(s){if(!q.m)q.m='支持中英文、数字、"_"或减号';this.report(/^[a-zA-Z0-9\u4e00-\u9fa5_-]+$/.test(s),q)}else this.report(true,q);o()})})(Xwb,$);(function(p,k){function t(o){var c=o.flag,i=o.page;k("#ad_"+c).find("#xwb_ad_cls").mousedown(function(){k("#ad_"+c).cssDisplay(false);k.cookie("ad_"+i+"_"+c+"_hide","1",{expires:1});return false})}function s(){if(!q){var o=k("#container"),c=k("#ad_global_left"),i=k("#ad_global_right"),b=function(){var h=o.offset().left;c.length&&c.css("left",h-c.width()-20);i.length&&i.css("left",h+o.width()+20)};k(window).resize(b);q=true;setTimeout(function(){c.css("visibility","hidden").removeClass("hidden");i.css("visibility",
"hidden").removeClass("hidden");b();c.css("visibility","");i.css("visibility","")},20)}}var q;p.mod.AdMgm.reg(function(o){t(o)});p.mod.AdMgm.handlers=k.extend(p.mod.AdMgm.handlers,{global_left:s,global_right:s})})(Xwb,$);(function(p,k){var t=p.getCfg,s=p.request,q=p.util,o=p.ui.MsgBox,c=p.ax.Pagelet;q.ns("Xwb.mod.pagelet",{});var i=p.mod.pagelet.WeiboList=q.create(c,{ui:{cls:p.mod.WeiboList},onViewReady:function(b){if(b=b.data){if(b=b.list){var h=p.cfg.wbList;if(!h)p.cfg.wbList=h={};for(var a in b)h[a]||(h[a]=b[a])}p.on("api.getCounts",q.getBind(this,"onUpdateCounter"))}},onUpdateCounter:function(b){if(b.isOk()){var h=this.getUI().jq("#xwb_weibo_list_ct>li"),a=p.cfg.wbList,e=b.getData(),j,m,d,g,l=this;h.each(function(){j=
k(this);m=q.parseKnV(j.attr("rel")).w;(g=e[m])&&l.renderWeiboCounter(j,g);d=a[m];var r=d.rt;if(r&&(g=e[r.id])){j=j.find(".forward");l.renderInnerWeiboCounter(j,g)}})}},renderWeiboCounter:function(b,h){h[0]&&b.find("#cm").text("评论("+h[0]+")");h[1]&&b.find("#fw").text("转发("+h[1]+")")},renderInnerWeiboCounter:function(b,h){h[0]&&b.find("#lk_cm").text("原文评论("+h[0]+")");h[1]&&b.find("#lk_fw").text("原文转发("+h[1]+")")}});p.use("pipeMgr").reg("common.userSkin",function(){return new c({ui:{actionMgr:true,uploaded:false,
skinSelectedCS:"current",colorSelectInit:false,colorSelectId:"csArea",isIE:k.browser.msie,ieStyleId:"customStyle",colorInput:"colorshow",colorHiddenId:"colorSelector",initIscustom:false,isClickCustom:false,customLinkId:"custom_css",address:"http://"+window.location.hostname+s.basePath,backCur:"cur",searchCssFile:["skin_define/skin.css","setting.getSkin","skin_set.css","base.css"],parseRel:Xwb.ax.ActionMgr.parseRel,onViewReady:function(){this.back_form=this.jq("#xwb_back_form");this.jqForm=this.back_form[0];
this.back_file=this.jq("#xwb_back_file");this.pwImg=this.jq("#previewImg");this.delImg=this.jq("#closeImg");var b=this;this.switcher="";this.initIscustom=this.custom=this.jq("#switcherItem #custom").hasClass("current");this.back_file.change(function(){b.change(this.value)});this.isSelectSkin(true);p.use("Switcher",{items:k("#switcherItem>span"),contents:k("#switcherCom>div"),selectedCS:"current",onselect:function(h){if(!b.initIscustom&&h.id=="custom"&&!b.isClickCustom)b.isClickCustom=true;b.custom=
h.id=="custom"?true:false;b.switchBackColor(b.custom?"set":"select")}});this.backInit();this.delImg.click(q.bind(this.closeUploadImg,this));this.initIscustom&&setTimeout(function(){b.initCustomStyle()},10)},initCustomStyle:function(){var b=this.setPhotoColor();b[0].push("html");b[1].push(this.getBackAttr());this.setPageStyle(b[0],b[1],"cover")},closeUploadImg:function(){if(this.pwImg.attr("rel")){this.pwImg.attr({rel:"",src:s.basePath+"img/upload_pic.png"});this.delImg.cssDisplay(false);this.getBackPhoto(false,
"")}},photoBackTile:function(b){var h=this.jq("#bg-repeat").attr("checked")?"repeat":"no-repeat";if(b)return["html",{backgroundRepeat:h}];this.setClassByName("html","backgroundRepeat",h)},photoBackStrong:function(b){var h=this.jq("#bg-fixed").attr("checked")?"fixed":"";if(b)return["html",{backgroundAttachment:h}];this.setClassByName("html","backgroundAttachment",h)},photoBackPlace:function(b){if(!this.jq("#align a.cur").attr("rel"))if(b)return["",""];else return;var h=this.parseRel(this.jq("#align a.cur").attr("rel")).w;
h=h=="1"?"left top":h=="2"?"center top":"right top";if(b)return["html",{backgroundPosition:h}];this.setClassByName("html","backgroundPosition",h)},getBackPhoto:function(b,h){if(b)return["html",{backgroundImage:"url("+h+")"}];this.setClassByName("html","backgroundImage","url("+h+")")},change:function(b){if(b&&!this.checkImg(b)){o.alert("","只支持 jpg、png的图片。");this.back_form[0].reset()}else this.getUploader().upload()},checkImg:function(b){b=b.split(".");return b.length&&k.inArray(b.pop().toLowerCase(),
["jpg","png"])!==-1},getUploader:function(){if(!this.uploader)this.uploader=p.use("Uploader",{form:this.jqForm,action:this.back_form.attr("action"),onload:q.getBind(this,"onUploadLoad")});return this.uploader},onUploadLoad:function(b){var h=s.parseProtocol(b);this.back_form[0].reset();if(typeof h!="object")o.alert("提示","上传失败!");else if(h.isOk()&&h.getRaw().raw.rst!==false){this.pwImg.attr({src:h.raw.raw.rst.url,rel:"u:1"});this.delImg.cssDisplay(true);b=[];var a=[];h=this.getBackPhoto(true,h.raw.raw.rst.url);
if(!this.uploaded){!this.jq("#align a.cur").attr("rel")&&this.jq("#align a").eq(0).addClass("cur");var e=this.photoBackTile(true);e=k.extend(e[1],this.photoBackPlace(true)[1])}k.extend(h[1],e);b.push("html");a.push(h[1]);this.setCssByObject(b,a);this.uploaded=true}else{b="";switch(h.raw.raw.errno){case 3040010:b="上传图片失败";break;case 3040012:b="上传背景图片的大小不能超过2M，请重新选择";break;case 610003:case 3040013:b="上传图片类型不符合要求";break;default:b="上传图片失败"}o.alert("提示",b)}},changeCss:function(b,h){function a(m,d){m=m?
e.address+m:e.address+"css/default/"+b+"/skin.css";var g=e.createCss(m,"");if(e.isIE)var l=document.styleSheets.length,r=setInterval(function(){try{if(document.styleSheets.length>l){clearInterval(r);k(d).remove();q.getClassByName("html").backgroundImage="url()"}}catch(w){}},10);else var u=setInterval(function(){try{clearInterval(u);k(d).remove();q.getClassByName("html").backgroundImage="url()"}catch(w){}},10);k("head").append(g)}var e=this,j=false;k("link[rel=stylesheet]").each(function(){if(this.href.indexOf("/skin.css")!==
-1&&this.id!=e.customLinkId){j=true;if(!e.usedSkin)e.usedSkin=this.href.match(/\/css\/(.*)\/skin.css/i)[1];this.href.indexOf("/css/default/"+b+"/skin.css")>0||a("/css/default/"+b+"/skin.css",this)}});if(!j){e=this;if(this.isIE&&k.browser.version==6){e.cacheCss=e.getTempStyle();setTimeout(a,100)}else a()}this.switcher=h},createCss:function(b,h){var a=document.createElement("link");a.setAttribute("rel","stylesheet");a.setAttribute("type","text/css");a.setAttribute("href",b);a.setAttribute("id",h);return a},
decorateSelected:function(b){if(!this.jqPreSel)this.jqPreSel=this.jq("#switcherCom ."+this.skinSelectedCS);this.jqPreSel.removeClass(this.skinSelectedCS);this.jqPreSel.find(".bg-icon").removeClass("bg-icon");this.jqPreSel=k(b);this.jqPreSel.addClass(this.skinSelectedCS);this.jqPreSel.find("span").addClass("bg-icon")},isSelectSkin:function(b){if(!this.jqPreSel)this.jqPreSel=this.jq("#switcherCom ."+this.skinSelectedCS);if(b){this.orgBackColor=k("html").css("backgroundColor");this.orgBackBg=k("body").css("backgroundImage")}},
switchBackColor:function(b){if(b=="select"){if(!this.jqPreSel)this.jqPreSel=this.jq("#switcherCom ."+this.skinSelectedCS);if(this.jqPreSel.length){this.cacheCss=this.getTempStyle();b=this.parseRel(this.jqPreSel.attr("rel"));this.changeCss(b.sk,b.id)}}else this.loadLink(this.address+"css/default/skin_define/skin.css.php",this.customLinkId)},loadLink:function(b){var h=this,a=function(){k("link[rel=stylesheet]").each(function(){this.href.indexOf("/skin.css")!==-1&&this.id!=h.customLinkId&&k(this).remove()});
if(h.cacheCss){h.addStyle("",h.cacheCss,"cathe");h.cacheCss=""}};if(!this.initIscustom&&k("head #defaultStyle").length==0){b="css/default/skin_define/skin.css.php";k.get(this.address+b,{},function(e){a();var j=document.getElementsByTagName("head")[0],m=document.createElement("style");m.setAttribute("type","text/css");m.setAttribute("id","defaultStyle");j.appendChild(m);if(m.styleSheet)m.styleSheet.cssText=e;else m.innerHTML=e})}else a()},getTempStyle:function(){var b=document.getElementById(this.ieStyleId);
if(b)return b.styleSheet?b.styleSheet.cssText:b.innerHTML;return""},setCustomClass:function(){var b=[],h=[],a="",e=this.pwImg.attr("rel");if(e)a=this.parseRel(e).u?this.pwImg.attr("src"):"";e=this.photoBackTile(true);b.push("html");var j=this.photoBackStrong(true);e=k.extend(e[1],j[1]);e=k.extend(e,this.photoBackPlace(true)[1]);(e=k.extend(e,{backgroundImage:"url("+a+")"}))&&h.push(e);b.push(".wrap-in");h.push({backgroundImage:""});b.push("#wrap");h.push({backgroundImage:""});a=this.jq("#color-area a");
j=0;for(var m=a.length;j<m;j++){e=this.getChangeClass(j,"#"+a.eq(j).attr("key"));b=k.merge(b,e[0]);h=k.merge(h,e[1])}return[b,h]},getCustomData:function(){var b={},h=this.jq("#color-area a");b.colors=[];for(var a=0,e=h.length;a<e;a++)b.colors.push(h.eq(a).attr("key"));b.colors=b.colors.join(",");h=this.pwImg.attr("rel");b.bg=h?this.parseRel(h).u?this.pwImg.attr("src"):"":"";b.tiled=this.jq("#bg-repeat").attr("checked")?1:0;b.fixed=this.jq("#bg-fixed").attr("checked")?1:0;h=this.jq("#align a.cur");
b.align=h.length?this.parseRel(h.attr("rel")).w:2;h=this.jq("#scheme-select div.cur");b.colorid=h.length?this.parseRel(h.attr("rel")).t:"";return b},isChangeColor:false,showColorSelect:function(b){var h=this,a=false;this.isChangeColor=false;if(!this.colorSelectInit){this.colorSelectInit=true;k("#"+this.colorHiddenId).ColorPicker({appendTo:"#"+h.colorSelectId,inputId:h.colorInput,color:h.curColor,cpBodyWidth:"212px",onShow:function(e){k("#"+k("#"+h.colorHiddenId).data("colorpickerId")).data("colorpicker").set(h.curColor);
k("#"+h.colorSelectId+"#cltitle").html(b);k(e).show();k("#"+h.colorSelectId).css({position:"relative","z-index":10005,left:k("#skin_setcolorArea").offset().left-200+"px",top:"35px"}).fadeIn(500);return false},onHide:function(){k("#"+h.colorSelectId).hide();return false},onChange:function(e,j){h.setSelectBox(j,a);h.isChangeColor=true}})}k("#"+this.colorSelectId+" #cltitle").html(b);k("#"+this.colorHiddenId).click();a=true},setSelectBox:function(b){if(this.selectColorObj){k(this.selectColorObj).find("span").css("backgroundColor",
"#"+b).parent().attr("key",b);k("#"+this.colorSelectId).find("#cRealColor>span").css("backgroundColor","#"+b)}if(this.isChangeColor){this.jq("#scheme-select div."+this.backCur).removeClass(this.backCur);if(this.selectColorObj){var h=this.getChangeClass(this.selectColorType,"#"+b),a=this.getPhotoColor(this.selectColorType,"#"+b);b=k.merge(h[0],a[0]);h=k.merge(h[1],a[1]);b.push("html");h.push(this.getBackAttr());this.setPageStyle(b,h,"add")}}},setBackColor:function(b,h){h=k(h);if(!h.hasClass(this.backCur)){this.jq("#"+
b+" ."+this.backCur).removeClass(this.backCur);h.addClass(this.backCur)}},reload:function(){window.location=String(window.location.href).replace(/skinset[^A-Za-z0-9\/]{1}1/g,"")},backPage:1,allBackPage:2,curSelect:1,disableClsl:"arrow-l-s1-disabled",disableClsr:"arrow-r-s1-disabled",slidePx:300,minus:0,ulPx:0,ulId:"scheme-select",sliding:false,selectBox:["#000","#808080","#f66","#90c","#e7f2fb","#fff","#f00","#f60","#fc0","#090"],backInit:function(){var b=this.jq("#"+this.ulId);this.liNum=b.find("li").length;
this.setSlideBtn(b.css("margin-left").replace("px",""))},getBackPhotoInfo:function(){var b="",h=this.pwImg.attr("rel");if(h)b=this.parseRel(h).u?this.pwImg.attr("src"):"";return b},setPageStyle:function(b,h,a){this.mergeMatch(b,h);this.addStyle(b,h,a||"cover")},setCssByObject:function(b,h,a){this.addStyle(b,h,a||"change")},setClassByName:function(b,h,a,e){var j=[],m={};m[h]=a;if(h=="backgroundPosition"||h=="backgroundRepeat"||h=="backgroundAttachment")if(h=this.getBackPhotoInfo())m.backgroundImage=
"url("+h+")";else return;j.push(m);this.addStyle([b],j,e||"change")},splitArray:function(b,h){for(var a=function(m,d){var g=d.length;b.splice(m,1,d[0]);for(var l=1;l<g;l++){b.splice(m+l,0,d[l]);h.splice(m+l,0,h[m])}},e=0;e<b.length;e++){var j=b[e].split(", ");if(j.length>1){a(e,j);e+=j.length-1}}},setPhotoColor:function(){for(var b=this.jq("#color-area a"),h=[],a=[],e=[],j=[],m=0,d=b.length;m<d;m++){var g="#"+b.eq(m).attr("key"),l=this.getChangeClass(m,g);g=this.getPhotoColor(m,g);h=k.merge(h,l[0]);
a=k.merge(a,l[1]);e=k.merge(e,g[0]);j=k.merge(j,g[1])}h=k.merge(h,e);a=k.merge(a,j);if(b=this.getBackPhotoInfo()){h.push("html");a.push({backgroundImage:"url("+b+")"})}return[h,a]},getPhotoColor:function(b,h){var a=[],e=[];switch(b){case 0:a.push(".pb-main .pb-list .pb-con .c2");a.push(".pb-aside .pb-block p");e.push({background:h});break;case 1:a.push(".pb-main .pb-list .pb-con");a.push(".pb-aside .pb-more");e.push({background:h});break;case 2:a.push(".skin-set .skin-setcolor .preview-box");break;
case 3:a.push(".pb-aside .pb-user-info .ui1");a.push(".pb-aside .pb-block div");e.push({background:h});break;case 4:a.push(".pb-main .pb-list .pb-con .c1");a.push(".pb-aside .pb-user-info .ui2");e.push({background:h})}e.push({background:h});return[a,e]},mergeMatch:function(b,h){for(var a=function(d){for(var g=d+1;g<b.length;g++)if(b[d]==b[g])return g;return""},e=function(d,g){b.splice(g,1);k.extend(h[d],h[g]);h.splice(g,1)},j=0;j<b.length;j++){var m=a(j);if(m){e(j,m);j--}if(j+1==b.length)break}return[b,
h]},isDisable:function(b){return k(b).hasClass(this.disableClsl)||k(b).hasClass(this.disableClsr)},backSlide:function(b){var h=this.jq("#scheme-select"),a=Number(h.css("margin-left").replace("px",""));this.ulPx=a;this.minus=b=="prev"?this.slidePx:-this.slidePx;this.setSlideBtn(this.minus+a);this.setBackSlide(h,b)},setBackSlide:function(b,h){if(h=="prev"){this.minus-=30;this.ulPx+=30}else{this.minus+=30;this.ulPx-=30}b.css("margin-left",this.ulPx+"px");if(this.minus!=0){var a=this;setTimeout(function(){a.setBackSlide.call(a,
b,h)},1)}else this.sliding=false},setSlideBtn:function(b){var h=this.jq("#prev"),a=this.jq("#next"),e=this.jq("#slidePage"),j=1,m=-(this.liNum-1)*this.slidePx;if(b==0){h.addClass(this.disableClsl);m<0?a.removeClass(this.disableClsr):a.addClass(this.disableClsr)}else{j=b/this.slidePx*-1+1;h.removeClass(this.disableClsl);b==m&&a.addClass(this.disableClsr);b>m&&a.removeClass(this.disableClsr)}e.html(j+"/"+this.liNum)},sixBoxColor:function(b){b=b.split("-");for(var h=this.jq("#color-area a"),a=[],e=[],
j=[],m=[],d=0,g=h.length;d<g;d++){h.eq(d).attr("key",b[d].replace("#",""));h.eq(d).find("span").css("backgroundColor",b[d]);var l=this.getChangeClass(d,b[d]),r=this.getPhotoColor(d,b[d]);a=k.merge(a,l[0]);e=k.merge(e,l[1]);j=k.merge(j,r[0]);m=k.merge(m,r[1])}a=k.merge(a,j);e=k.merge(e,m);a.push("html");e.push(this.getBackAttr());this.setPageStyle(a,e)},getChangeClass:function(b,h){var a=[],e=[];switch(b){case 0:var j="a, .feed-list .feed-filter a, .user-preview .user-total-box a, .user-preview .user-total-box a:hover, .gotop:hover";
this.splitByChar(a,e,j,{color:h});if(p.getCfg("remind")=="0"){j=".menu .menu-custom, .menu .menu-over";this.splitByChar(a,e,j,{background:h})}break;case 1:j=".sub-link, .feed-list .feed-info p a, .feed-list .feed-info span a, .feed-list .forward p span a, .gotop:link, .gotop:visited, .ft-con a, .icon-reply, .icon-del";this.splitByChar(a,e,j,{color:h});j="#home .home-current, #atme .atme-current, #comments .comment-current, #favs .favs-current, #systemnotice .systemnotice-current, #messages .messages-current, .nav-block .cur, .nav-block .cur:hover, .nav .defined-link a:hover, .nav .user-link a:hover, .tab-s4 a:hover, .tab-s4 .current, .tab-s4 .current:visited, .menu li, .menu .menu-bg, .menu .menu-bg .l-bg, .menu .menu-bg .r-bg";
this.splitByChar(a,e,j,{backgroundColor:h});break;case 2:j="html";this.splitByChar(a,e,j,{backgroundColor:h});j=".sub-menu a:hover, .sub-menu a.current";this.splitByChar(a,e,j,{color:h});a.push(".event-classify a:hover");e.push({color:h});j=".event-classify a.curr, .event-classify a.curr:hover";this.splitByChar(a,e,j,{color:h});a.push(".nav-block .cur");a.push(".nav-block .cur:hover");e.push({color:h});e.push({color:h});break;case 3:j=".user-sidebar .hd h3, .user-list-s1 .hd h3, .user-tag .tag-tit h3, .top10 .hd h3, .user-tag .hd h3, .user-preview .user-intro strong, .feed-list .feed-tit h3, .title-box h3, .column-title h3, .account-login h3, .recom-box .hd h3, .att-topic .hd h3, .events-title h3, .recent-event .hd h3, .tit-hd h3, .tit-s1 h3, .tab-s2 span a, .tab-s2 span a:visited, .tab-s3 span a, .tab-s3 span a:visited";
this.splitByChar(a,e,j,{color:h});break;case 4:a.push("body");e.push({color:h})}return[a,e]},splitByChar:function(b,h,a,e){b.push(a);h.push(e)},getBackAttr:function(){var b={},h=this.pwImg.attr("rel");b["background-image"]=h?"url("+(this.parseRel(h).u?this.pwImg.attr("src"):"")+")":'url("")';b["background-repeat"]=this.jq("#bg-repeat").attr("checked")?"repeat":"no-repeat";b["background-attachment"]=this.jq("#bg-fixed").attr("checked")?"fixed":"scroll";h="";if(h=this.jq("#align a.cur").attr("rel")){h=
this.parseRel(h).w;b["background-position"]=h=="1"?"left top":h=="2"?"center top":"right top"}return b},directSetRightBg:function(b){k("#container")[0].className=b[1];b=this.getPhotoColor(3,b[0]);this.setPageStyle(b[0],b[1])},setRightBackColor:function(){var b=this.getChangeClass(this.selectColorType,"#"+hex),h=this.getPhotoColor(this.selectColorType,"#"+hex),a=k.merge(b[0],h[0]);b=k.merge(b[1],h[1]);this.setPageStyle(a,b)},onactiontrig:function(b){switch(b.data.e){case "save":b={};if(this.custom)b=
this.getCustomData();else{if(this.switcher==""){o.alert("","请选择皮肤");break}b={skin_id:this.switcher}}var h=this;s.saveSkin(b,function(a){if(a.isOk()){h.display(false);h.reload()}else o.alert("",a.getMsg())});break;case "cancel":this.reload();break;case "cs":this.custom=false;this.changeCss(b.get("sk"),b.get("id"));this.decorateSelected(b.src);break;case "bgLevel":this.photoBackTile(false);b.preventDefault(false);break;case "bgStrong":this.photoBackStrong(false);b.preventDefault(false);break;case "bgPlace":if(k(b.src).hasClass("cur"))break;
this.jq("#align .cur").removeClass("cur");b.src.className="cur";this.photoBackPlace(false);break;case "cls":this.selectColorObj=b.src;this.selectColorType=Number(b.get("t"));this.setBackColor("color-area",b.src);this.curColor=k(b.src).attr("key");this.showColorSelect(k(b.src).attr("title"));break;case "clbs":this.setBackColor("scheme-select",b.src);this.sixBoxColor(b.get("w"));break;case "slide":if(this.sliding||this.isDisable(b.src))break;this.sliding=true;this.backSlide(b.get("t"),b.src)}},addStyle:function(b,
h,a){var e=this.ieStyleId,j=document.getElementById(e);this.initIscustom||k("#"+this.customLinkId).remove();if(j==null){var m=document.getElementsByTagName("head")[0];j=document.createElement("style");j.setAttribute("type","text/css");j.setAttribute("id",e);m.appendChild(j);if(j.styleSheet)if(a&&a=="create")j.styleSheet.cssText=h;else{b=this.cssObjToString(b,h);j.styleSheet.cssText=b}else if(a&&a=="create")j.innerHTML=h;else{b=this.cssObjToString(b,h);j.innerHTML=b}}else if(j.styleSheet)if(a==="add"){b=
this.cssObjToString(b,h);j.styleSheet.cssText+=b}else if(a==="cover"){b=this.cssObjToString(b,h);j.styleSheet.cssText=b}else if(a==="cathe")j.styleSheet.cssText=h;else{a=j.styleSheet;j=a.rules;e=b.length;for(m=0;m<e;m++){var d=this.isMatchCss(j,b[m]);d>-1?this.setRulesAttr(j[d].style,h[m]):a.addRule(b[m],this.objectToString(h[m],false))}}else if(a==="add"){b=this.cssObjToString(b,h);j.innerHTML+=b}else if(a==="cover"){b=this.cssObjToString(b,h);j.innerHTML=b}else if(a==="cathe")j.innerHTML=h;else{a=
j.sheet.cssRules;e=a.length;for(m=0;m<e;m++){d=this.isMatchCss(a,b[m]);if(d>-1)this.setRulesAttr(a[d].style,h[m]);else(h=this.objectToString(h[m],false))&&j.sheet.insertRule(b[m],this.objectToString(h[m],false))}}},setRulesAttr:function(b,h){for(var a in h)b[a]=h[a]},isMatchName:function(b){var h=n.length;b=b.toLowerCase();for(var a=0;a<h;a++)if(b==n[a])return true;return false},isMatchCss:function(b,h){for(var a=0,e=b.length;a<e;a++)if(h==b[a].selectorText.toLowerCase())return a;return-1},cssObjToString:function(b,
h){for(var a=[],e=0,j=b.length;e<j;e++){var m=this.objectToString(h[e]);a.push(b[e]+"{"+m+"}")}return a.join("")},objectToString:function(b,h){var a="",e;for(e in b){var j=!h?this.getCssKey(e):e;a+=j+":"+b[e]+";"}return a.slice(0,-1)},getCssKey:function(b){switch(b){case "backgroundRepeat":return"background-repeat";case "backgroundAttachment":return"background-attachment";case "backgroundImage":return"background-image";case "backgroundPosition":return"background-position";case "backgroundColor":return"background-color";
default:return b}}}})});p.use("pipeMgr").reg("common.siteNav",{onViewReady:function(){var b=this.getUI(),h=[],a;p.on("api.unread",function(e){if(e.isOk()){if(!b.jqNewWb){b.jqExtra("referMe","myCmt","myMsg","myNotice");a={1:b.jqReferMe,2:b.jqMyCmt,4:b.jqMyMsg,5:b.jqMyNotice}}e=e.getData().unread;for(var j=0;j<e.length;j++)if(h[j]!==e[j]){var m=a[j];if(m){m.cssDisplay(e[j]);e[j]&&m.find("#t").text(e[j])}}h=e}})}}).reg("common.userPreview",{onViewReady:function(){var b=this;p.on("api.update",function(h){if(h.isOk()){h=
b.getUI().jq("#xwb_user_total_wb");h.text(parseInt(h.text())+1)}}).on("api.destroy",function(h){if(h.isOk()){h=b.getUI().jq("#xwb_user_total_wb");h.text(parseInt(h.text())-1)}})}}).reg("input",{ui:p.mod.PostBase,onViewReady:function(){this.getUI().initEx()}}).reg("wblist",i).reg("weibo.weiboList",function(){return new i({ui:{cls:p.mod.WeiboList,syncList:true}})}).reg("weibo.userTimelineList",function(){var b=t("page")=="index.profile";return new i({ui:{cls:p.mod.WeiboList,syncList:b}})}).reg("common.searchMod",
function(){return new c({onViewReady:function(){var b=document.getElementById("k");b&&q.focusEnd(b);k("#searchForm").bind("submit",function(){if(!k.trim(k("#k").val())){k("#searchTip").cssDisplay(true);k("#k").focus();return false}});k("#searchBtn").click(function(){if(p.util.byteCut(k.trim(k("#k").val()),30))k("#searchForm").submit();else{k("#searchTip").cssDisplay(true);k("#k").focus()}return false});var h=this.getUI();p.on("subrefresh",function(a){if(h.jq(".search-field").attr("rel").split(":")[1]==
a.subject){var e=h.jq(".search-field span:last a").attr("rel");if(e=="e:delSubject"||e=="e:addSubject")a.type=="add"?h.jq(".search-field span:last").replaceWith('<span>已关注(<a href="javascript:;" rel="e:delSubject">取消关注</a>)</span>'):h.jq(".search-field span:last").replaceWith('<span class="icon-follow"><a href="javascript:;" rel="e:addSubject">关注该话题</a></span>')}})}})}).reg("user.fameList",function(){return new c({onViewReady:function(){this.getUI().jq().highlight(k("#k").val())}})}).reg("user.userSearchList",
function(){return new c({ui:{actionMgr:true,onactiontrig:function(b){switch(b.data.e){case "allTag":b.lock(1);s.postReq(s.apiUrl("action","getTags"),{uid:b.get("u")},function(h){if(h.isOk()){h=h.getData();var a=k(b.src);k(h).each(function(){var e,j;for(j in this)e=this[j];e!=k("#k").val()&&a.after('<a href="'+s.mkUrl("search","user&",{ut:"tags",k:e})+'">'+e+"</a>")});a.remove()}b.lock(0)});default:b.stopPropagation(false)}}},onViewReady:function(b){var h=k("#k").val(),a=this.getUI();switch(b.data.type){case "tags":a.jq("li p.tag").highlight(h);
break;case "sintro":a.jq("li div.u-info").highlight(h).highlight(h);break;case "nick":a.jq("li a.u-name").highlight(h).highlight(h)}}})}).reg("user.userSearchPreview",function(){return new c({onViewReady:function(){this.getUI().jq().highlight(k("#k").val())}})}).reg("weibo.weiboOnly",function(){return new i({onViewReady:function(){i.prototype.onViewReady.apply(this,arguments);this.getUI().jq("#xwb_weibo_list_ct").highlight(k("#k").val())}})}).reg("user.followersList",function(){return new c({ui:{cls:p.mod.HoverList,
itemSelector:"ul li",onMouseOver:function(){k(this).find("#removeFans,#sendMsg").removeClass("hidden")},onMouseOut:function(){k(this).find("#removeFans,#sendMsg").addClass("hidden")},actionMgr:true,onactiontrig:function(b){switch(b.data.e){case "ufl":var h=b.get("u"),a=b.get("n");o.confirm("提示","确定要取消关注"+a+"?",function(e){if(e==="ok"){b.lock(1);p.request.unfollow(h,"",function(j){if(j.isOk()){var m=b.jq("u");m.slideUp(500,function(){b.lock(0);m.remove()})}else{b.lock(0);o.tipWarn(j.getMsg())}})}});
break;default:b.stopPropagation(false)}}}})}).reg("weibo.detail",function(){return new i({onViewReady:function(){i.prototype.onViewReady.apply(this,arguments);var b=this.getUI().jq("#xwb_cmt_list"),h=b.attr("wbid"),a=p.cfg.wbList[h].u.id,e=this.getUI().jq("#topCmtBox");p.use("MBlogCmtArea",{view:b[0],wbId:h,wbUid:a,topCmtBox:e[0],faceSize:50}).display(true).load()}})}).reg("common.message",function(){return new c({onViewReady:function(){this.jq("#messageList li").hover(function(){k(this).find("#del").cssDisplay(true)},
function(){k(this).find("#del").cssDisplay(false)});p.on("api.sendDirectMessage",function(b){b.isOk()&&location.reload()})}})}).reg("weibo.comments",function(){return new c({ui:{cls:p.mod.MyCmt}})}).reg("user.fansList",function(){return new c({ui:{cls:p.mod.HoverList,itemSelector:"ul li",onMouseOver:function(){k(this).find("#removeFans,#sendMsg").removeClass("hidden")},onMouseOut:function(){k(this).find("#removeFans,#sendMsg").addClass("hidden")}}})}).reg("user.outputCelebUserBlock",function(){return new c({ui:{selectedCS:"current",
actionMgr:true,onactiontrig:function(b){switch(b.data.e){case "ck":var h=b.jq("u").find("#pic");h.hasClass(this.selectedCS)?h.removeClass(this.selectedCS):h.addClass(this.selectedCS);break;case "sa":var a=b.src.checked,e=this.selectedCS;this.jq("#pic").each(function(){k(this).checkClass(e,a)});b.preventDefault(false);break;case "submit":var j=[];e=this.selectedCS;var m;this.jq("#pic").each(function(){if(k(this).hasClass(e)){m=p.ax.ActionMgr.wrapRel(this);j.push(m.get("u"))}});j.length?s.follow(j.join(","),
0,function(d){d.isOk()?k(b.src).replaceWith('<span class="followed-btn">已关注</span>'):o.tipWarn(d.getMsg());b.lock(0)}):o.tipWarn("请选择您要关注的人。")}}}})}).reg("user.hotUser",function(){return new c({onViewReady:function(){var b=this,h,a;this.jq("#followall-btn").click(function(){if(a)return false;var e=[],j;b.jq("li").each(function(){h=p.ax.ActionMgr.wrapRel(this);(j=h.get("u"))&&e.push(j)});if(e.length){a=true;s.follow(e.join(","),0,function(m){(a=m.isOk())&&b.jq("a[name=follow]").replaceWith('<span class="followed-btn">已关注</span>')})}return false})}})}).reg("category_user",
function(){return new c({onViewReady:function(){p.use("Switcher",{items:this.jq("div.tab-s4>a"),contents:this.jq("div.column-body"),selectedCS:"current"})}})}).reg("component/component_1.run",function(){return new c({onViewReady:function(){var b=this.getUI();p.on("pipe.end",function(){p.use("Switcher",{items:b.jq("div.tab-s2>span"),contents:b.jq("div.hot-mblog-body"),selectedCS:"current"})})}})}).reg("component/component_common.hotWB_getComment",function(){return new i({renderWeiboCounter:function(b,
h){i.prototype.renderWeiboCounter.apply(this,arguments);if(h[0]){var a=h[0];if(a>=1E5){var e=a/1E4>>0;if(e>0){a=a%1E4/1E4>>0;a=a>0?"."+a:"";a=""+e+a+"万"}}b.find("#hotNum").text(a)}}})}).reg("component/component_common.hotWB_getRepost",function(){return new i({renderWeiboCounter:function(b,h){i.prototype.renderWeiboCounter.apply(this,arguments);if(h[1]){var a=h[1];if(a>=1E5){var e=a/1E4>>0;if(e>0){a=a%1E5/1E4>>0;a=a>0?"."+a:"";a=""+e+a+"万"}}b.find("#hotNum").text(a)}}})}).reg("component/component_8.run",
function(){return new i({onViewReady:function(b){i.prototype.onViewReady.apply(this,arguments);var h=b.data.currRoute,a=b.data.page_id,e=p.use("Layer",{closeable:true,contextable:true,view:this.jq("#win_city")[0],onViewReady:function(){s.getProvinces(q.bind(this.onDataLoaded,this));var j=this;this.jq("#citys").click(function(m){m.target.tagName=="A"&&j.close()})},onDataLoaded:function(j){if(j.isOk()){this.provinces=j.getData().provinces;var m=this;this.jq("#sel-area").change(function(){m.changeProvince(this.value)})}},
changeProvince:function(j){if(this.provinces){var m=this;k.each(this.provinces,function(d,g){if(g.id==j){var l=[];k.each(g.citys,function(r,u){var w,v;for(r in u){w=r;v=u[r]}w=s.mkUrl(h,"",q.queryString({page_id:a,province:j,city:w+"#city"}));l.push('<a href="'+w+'">'+v+"</a>")});m.jq("#citys").html(l.join(""));return false}})}}});this.jq("#cityBtn").click(function(){e.display(true);return false})}})}).reg("common.subjectFollowed",function(){return new c({onViewReady:function(){this.getUI();var b=
function(h){k(h).hover(function(){k(this).attr("class","li-hover");k(this).append('<div class="li-bg" id="BG"></div>');k(this).find("span").removeClass("hidden")},function(){k(this).removeClass("li-hover");k(this).find("span").addClass("hidden");k(this).find("#BG").remove()})};p.on("subrefresh",function(){s.postReq(s.apiUrl("action","getAllSubject"),{},function(h){if(h.isOk()){k("#subjectCount ul li").remove();for(var a=h.getData(),e=0,j=a.length;e<j;e++){var m=a[e].subject,d=s.mkUrl("search","weibo",
{k:m});k(' <li rel="subject:'+m+'"><a href="'+d+'" target="_blank">'+m+'</a> <span class="close hidden" rel="e:deleteSubject" title="删除">x</span> </li>').appendTo(k("#subjectCount ul"))}k("#subjectCount ul li").each(function(){b(this)});k("#subjectCount").prev("div.hd").find("h3 span").html("("+h.getData().length+")")}else o.alert("提示",h.getError())})});p.on("pipe.end",function(){k("#subjectCount ul li").each(function(){b(this)});p.use("action").reg("deleteSubject",function(a){k(a.src);a.lock(1);
s.postReq(s.apiUrl("action","deleteSubject"),{text:a.get("subject")},function(e){e.isOk()?p.fire("subrefresh",{subject:a.get("subject"),type:"del"}):o.alert("提示",e.getError());a.lock(0)})});var h=null;k("#addSubject").click(function(){if(h)h.display(true);else h=p.use("addFollow",{appendTo:k("#subjectCount").parent()})})})}})}).reg("event.eventinfo",function(){return new c({ui:{actionMgr:true,onactiontrig:function(b){var h=function(a,e){var j=p.use("postBox"),m=e||a.get("m");j.display(true).reset().selectionHolder.setText(m||
"");m&&j.checkText()};switch(b.get("e")){case "join":b.get("other")=="1"?s.eventJoin({eid:b.get("eid")},function(a){if(a.isOk()){o.tipOk("参加成功！",function(){h(b)});k(b.src).replaceWith('<a class="has-join-btn" href="#">已参加</a>')}else o.tipWarn(a.getError())}):p.use("Box",{contentHtml:"evevtApplicants",actionMgr:true,cs:"win-apply win-fixed",closeable:true,title:"报名申请",appendTo:document.body,mask:true,autoCenter:true,onViewReady:function(){var a=this;this.jq("#contact,#note").keydown(function(){a.jq(".tips").removeClass("hidden");
a.jq(".warn").addClass("hidden")})},onactiontrig:function(a){switch(a.data.e){case "sd":if(this.jq("#contact").val()==""){this.jq(".tips").addClass("hidden");this.jq(".warn").removeClass("hidden").html("请输入联系方式！");break}if(k.trim(this.jq("#note").val())==""){this.jq(".tips").addClass("hidden");this.jq(".warn").removeClass("hidden").html("请填写备注");break}if(q.calWbText(this.jq("#note").val(),100)<0){this.jq(".tips").addClass("hidden");this.jq(".warn").removeClass("hidden").html("备注长度超过100！");break}var e=
this;s.eventJoin({eid:b.get("eid"),other:"2",contact:this.jq("#contact").val(),note:this.jq("#note").val()},function(j){if(j.isOk()){o.tipOk("参加成功！",function(){h(b);e.close()});k(b.src).replaceWith('<a class="join-btn-disabled" href="#">我要参加</a>')}else o.tipWarn(j.getError())})}}}).display(true);break;case "sd":h(b,b.get("m1"));break;default:b.stopPropagation(false)}}}})}).reg("event.eventinput",function(){return new c({ui:{actionMgr:true,exceedCS:"out140",onactiontrig:function(b){switch(b.data.e){case "sd":this.send(b.get("eid"),
b.get("a"),b);break;case "ic":p.use("emotion").setSelectionHolder(this.selectionHolder,this.checkText,this).showAt(b.src)}},onViewReady:function(){this.jqExtra("inputor","warn");var b=this;this.jqInputor.bind("keyup",function(){b.checkText()});this.selectionHolder=p.use("SelectionHolder",{elem:this.jqInputor[0]});this.checkText()},send:function(b,h,a){a.lock(1);if(this.checkText())s.postReq(s.apiUrl("action","update"),{"extra_params[event_id]":b,doAction:h,text:this.jqInputor.val()},function(e){e.isOk()?
o.tipOk("发布成功",function(){window.location.reload()}):o.tipWarn(e.getMsg());a.lock(0)});else{a.lock(0);this.jqInputor.focus()}},checkText:function(){var b=k.trim(this.jqInputor.val()),h=q.calWbText(b);h>=0?this.jqWarn.html("还可以输入"+h+"个字").removeClass(this.exceedCS):this.jqWarn.html("已超出"+Math.abs(h)+"个字").addClass(this.exceedCS);return h>=0&&b}}})})})(Xwb,$);(function(p,k){var t=p.getCfg,s=p.request,q=p.util;p.on("pipe.start",function(o){q.ie6&&k("#logo").length&&k("#logo").fixPng();o||(o={});p.cfg=o;p.use("action").bind(document.body);o.basePath&&s.init(o.basePath);if(p.getUid()){var c=o.remind,i=c?document.body:k("#xwbInnerNav")[0];i&&p.use("notice",{appendTo:i,remindType:c})}p.mod.shortlink.local=o.shortLink}).on("pipe.end",function(){if(p.cfg.wbList){var o=p.cfg.wbList,c=[],i,b;for(b in o){c.push(b);i=o[b];i.rt&&c.push(i.rt.id)}s.counts(c.join(","),
k.noop);c=null;var h=p.ax.ActionMgr;p.mod.shortlink.from(o,function(){k(".feed-list ul>li").each(function(){var g=k(this),l=h.getRel(this,"w",this);if(l){l=o[l];var r=l.shortlinks;r&&r.length&&p.mod.shortlink.renderWeiboShortlink(g,l,r)}})})}k("#xwb_search_form").each(function(){p.use("SearchEntry",{view:this}).display(true)});p.report.start();c=function(){p.report.report()};if(window.addEventListener)window.addEventListener("unload",c,false);else window.attachEvent&&window.attachEvent("onunload",
c);t("ads")&&p.mod.AdMgm.init(t("ads"));if(t("page")!=="ta"){var a=k("#new_wb_tips");a.length&&p.on("api.unread",function(g){if(g.isOk()){g=g.getData().unread[0];a.cssDisplay(!!g)}})}if(p.getUid()){var e=false,j=t("maxid"),m=function(){e=false;setTimeout(d,3E4)},d=function(){if(!e){e=true;s.unread(j,m)}};d()}k(".main-menu>li").slideMenu(">ul","menu-over");k("#gotop").each(function(){var g=k(document),l=k(this);k("#container");var r=true,u;l.css("bottom","95px");k(window).scroll(function(){if(g.scrollTop()==
0){if(!r){l.cssDisplay(false);r=true}u=false}else if(!u)if(r){l.cssDisplay(true);r=false}});l.click(function(){u=true;k("html,body").animate({scrollTop:0},150);return false})})});k(function(){k("#focus_index").each(function(){p.use("base",{actionMgr:true,view:this,onactiontrig:function(o){var c=o.data;switch(c.e){case "cls":k.cookie(o.get("cn"),1);this.display(0);break;case "do":o=c.op;if(o==1){o=p.use("postBox");p.use("postBox").display(true);o&&o.selectionHolder.insertText("#"+c.tp+"# ")}else o==
2&&c.ln&&window.open(decodeURIComponent(c.ln.replace(/\+/g,"%20")))}}}).display(true)});k("#xwb_today_topic").each(function(){k(this).find("p.feedback").substrText(80,1);k(this).find("div.column-item:first").removeClass("next");p.use("FadeBox",{view:this}).display(1)})});window.xwbPipe=p.ax.PipeMgr})(Xwb,$);
