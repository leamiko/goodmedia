(function(a,c,d,e){var b=function(){var f={bathcallbackhand:function(j,i,h){var g=d(h).parent();if(g.next().hasClass("J_checked")){g.next().show().html(i)}else{g.after('<p class="J_checked red" style="padding-left:50px;">'+i+"</p>")}},focushand:function(h){var g=h.parent();if(g.next().hasClass("J_checked")){g.next().hide()}},checkedLogin:function(){var g=new c.widget.verify({form:"#J_LoginForm",cls:".Gverify",blur:true,success:function(i){var h="http://bbs.idongmi.com/bbs/logging.php?action=login&loginsubmit=yes&inajax=1",k=i.username,j=i.password,i={password:j,loginfield:"username",questionid:0,referer:"",answer:"",formhash:"52c87683"};if(i.cookietime){i.cookietime=i.cookietime}h+="&"+d.param(i);d.ajax({url:"/api/api_getURL2js.jsp?op=login&username="+encodeURIComponent(k)+"&pwd="+i.password+"&url="+encodeURIComponent(h),datatype:"xml",type:"POST",success:function(q){var r=d(q).find("root")[0],t=d(r).text();try{if(t!=""&&!(/\<script/.test(t))){d("#J_Status").text(t);d("#J_Status").closest(".login_text").show()}else{var n=t.match(/src="(.+?)"/g);for(var o=0;o<n.length;o++){var l=n[o].slice(5,n[o].length-1);d.getScript(l)}var s=d.analyse(window.location.search.slice(1)),m=s.referer;if(!m){m=(window.ref!="null"||window.ref=="http://x.idongmi.com/reg.jsp")?window.ref:"http://x.idongmi.com/"}d("#J_Status").html("欢迎您,"+k+',3秒后自动<a href="'+decodeURIComponent(m)+'">返回</a>');d("#J_Status").closest(".login_text").show();d.cookie("CNAME",k,{domain:".idongmi.com",path:"/",expires:5});setTimeout(function(){if(m=="null"){m="http://x.idongmi.com/"}window.location.href=decodeURIComponent(m)},4000)}}catch(p){alert(p)}},error:function(){d("#J_Status").html("网络超时，请重试")}})},batchcallback:f.bathcallbackhand,focusfn:f.focushand});g.init()},batchcallbackReghand:function(k,j,i,g){var h=d(i).parent();if(h.children().last().hasClass("J_checked")){h.children().last().show().html(j);if(!g){h.children().last().addClass("red")}else{h.children().last().removeClass("red")}}else{g=(g=="normal")?"":"red";h.append('<em class="J_checked '+g+'" style="font-style:normal;">'+j+"</em>")}},checkname:function(i,j){var h="http://bbs.idongmi.com/bbs/ajax.php?infloat=register&handlekey=register&action=checkusername&username="+i+"&inajax=1&ajaxtarget=returnmessage4",g="/api/api_getURL2js.jsp?op=get&url=";d.ajax({url:g+encodeURIComponent(h),datatype:"xml",type:"POST",success:function(m){var l=d(m).find("root")[0],k=d(l).text();if(/'1', '用户名已经被他人使用'/.test(k)){f.batchcallbackReghand("","用户名已经被他人使用",e.getElementById("J_UserName"))}else{if(j){j()}}},error:function(){f.batchcallbackReghand("","响应超时，请重新填写",e.getElementById("J_UserName"))}});return true},checkeml:function(i,j){var h="http://bbs.idongmi.com/bbs/ajax.php?infloat=register&handlekey=register&action=checkemail&email="+i+"&inajax=1&ajaxtarget=returnmessage4",g="/api/api_getURL2js.jsp?op=get&url=";d.ajax({url:g+encodeURIComponent(h),datatype:"xml",type:"POST",success:function(m){var l=d(m).find("root")[0],k=d(l).text();if(/'1', '该 Email 地址已经被注册'/.test(k)){f.batchcallbackReghand("","该 Email 地址已经被注册",e.getElementById("J_Email"))}else{if(j){j()}}},error:function(){f.batchcallbackReghand("","响应超时，请重新填写",e.getElementById("J_Email"))}});return true},checkedReg:function(){d(".J_Regverify").each(function(){var h=this,i=d(h).attr("data-tips");if(i){f.batchcallbackReghand("",i,h,"normal")}});var g=new c.widget.verify({form:"#J_RegForm",cls:".J_Regverify",blur:true,checktrue:function(h){f.batchcallbackReghand("",'<img src="http://s1.ifiter.com/static/images/reg/fatcow.png" alt="可以注册"/>',h,"normal")},success:function(h){f.checkname(d("#J_UserName").val(),function(){f.checkeml(d("#J_Email").val(),function(){d("#J_RegForm").die();d("#J_RegForm").submit()})})},batchcallback:f.batchcallbackReghand,focusfn:function(h){var i=h.attr("data-tips");if(i){f.batchcallbackReghand("",i,h,"normal")}}},{checkusername:f.checkname,checkemail:f.checkeml});g.init()}};return{exports:{login_init:function(){c.widget.use("verify",function(g){f.checkedLogin();if(d.cookie("CNAME")){d("#J_Name").val(d.cookie("CNAME"))}})},register_init:function(){c.widget.use("verify",function(g){f.checkedReg()})}}}}();if(c&&c.apps){c.apps.login=b}})(window,GM,jQuery,document);