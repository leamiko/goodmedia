(function(a,c,d,e){var b=function(){var f={bathcallbackhand:function(j,i,h){var g=d(h).parent();if(g.next().hasClass("J_checked")){g.next().show().html(i)}else{g.after('<p class="J_checked red" style="padding-left:50px;">'+i+"</p>")}},focushand:function(h){var g=h.parent();if(g.next().hasClass("J_checked")){g.next().hide()}},checkedLogin:function(){var g=new c.widget.verify({form:"#J_LoginForm",cls:".Gverify",blur:true,success:function(j){var i="http://bbs.idongmi.com/bbs/logging.php?action=login&loginsubmit=yes&inajax=1",l=j.username,k=j.password,h={password:k,loginfield:"username",questionid:0,referer:"",answer:"",formhash:"52c87683"};if(j.cookietime){h.cookietime=j.cookietime}i+="&"+d.param(h);d.ajax({url:"/api/api_getURL2js.jsp?op=login&url="+encodeURIComponent(i),datatype:"xml",type:"post",data:{username:encodeURIComponent(l),pwd:j.password},success:function(s){var u=d(s).find("root")[0],w=d(u).text();try{if(w!==""&&!(/\<script/.test(w))){d("#J_Status").text(w);d("#J_Status").closest(".login_text").show()}else{var o=w.match(/src="(.+?)"/g),t=false,p=0;for(var q=0;q<o.length;q++){var m=o[q].slice(5,o[q].length-1);if(console){console.log(m)}d.getScript(m,function(){p++;if(console){console.log(p)}})}var v=setInterval(function(){if(p===o.length){clearInterval(v);n()}},100);function n(){var x=d.analyse(window.location.search.slice(1)),y=x.referer;if(!y){y=(window.ref!="null"||window.ref=="http://x.idongmi.com/reg.jsp")?window.ref:"http://x.idongmi.com/"}d("#J_Status").html("欢迎您,"+l+',3秒后自动<a href="'+decodeURIComponent(y)+'">返回</a>');d("#J_Status").closest(".login_text").show();d.cookie("CNAME",l,{domain:".idongmi.com",path:"/",expires:5});setTimeout(function(){if(y=="null"){y="http://x.idongmi.com/"}if(decodeURIComponent(y)=="http://www.idongmi.com/"){y="http://x.idongmi.com/"}window.location.href=decodeURIComponent(y)},4000)}}}catch(r){alert(r)}},error:function(){d("#J_Status").html("网络超时，请重试")}})},batchcallback:f.bathcallbackhand,focusfn:f.focushand});g.init()},batchcallbackReghand:function(k,j,i,g){var h=d(i).parent();if(h.children().last().hasClass("J_checked")){h.children().last().show().html(j);if(!g){h.children().last().addClass("red")}else{h.children().last().removeClass("red")}}else{g=(g=="normal")?"":"red";h.append('<em class="J_checked '+g+'" style="font-style:normal;">'+j+"</em>")}},checkname:function(i,j){var h="http://bbs.idongmi.com/bbs/ajax.php?infloat=register&handlekey=register&action=checkusername&username="+i+"&inajax=1&ajaxtarget=returnmessage4",g="/api/api_getURL2js.jsp?op=get&url=";d.ajax({url:g+encodeURIComponent(h),datatype:"xml",type:"POST",success:function(m){var l=d(m).find("root")[0],k=d(l).text();if(/'1', '用户名已经被他人使用'/.test(k)){f.batchcallbackReghand("","用户名已经被他人使用",e.getElementById("J_UserName"))}else{if(j){j()}}},error:function(){f.batchcallbackReghand("","响应超时，请重新填写",e.getElementById("J_UserName"))}});return true},checkeml:function(i,j){var h="http://bbs.idongmi.com/bbs/ajax.php?infloat=register&handlekey=register&action=checkemail&email="+i+"&inajax=1&ajaxtarget=returnmessage4",g="/api/api_getURL2js.jsp?op=get&url=";d.ajax({url:g+encodeURIComponent(h),datatype:"xml",type:"POST",success:function(m){var l=d(m).find("root")[0],k=d(l).text();if(/'1', '该 Email 地址已经被注册'/.test(k)){f.batchcallbackReghand("","该 Email 地址已经被注册",e.getElementById("J_Email"))}else{if(j){j()}}},error:function(){f.batchcallbackReghand("","响应超时，请重新填写",e.getElementById("J_Email"))}});return true},checkedReg:function(){d(".J_Regverify").each(function(){var h=this,i=d(h).attr("data-tips");if(i){f.batchcallbackReghand("",i,h,"normal")}});var g=new c.widget.verify({form:"#J_RegForm",cls:".J_Regverify",blur:true,checktrue:function(h){f.batchcallbackReghand("",'<img src="http://s1.ifiter.com/static/images/reg/fatcow.png" alt="可以注册"/>',h,"normal")},success:function(h){f.checkname(d("#J_UserName").val(),function(){f.checkeml(d("#J_Email").val(),function(){d("#J_RegForm").die();d("#J_RegForm").submit()})})},batchcallback:f.batchcallbackReghand,focusfn:function(h){var i=h.attr("data-tips");if(i){f.batchcallbackReghand("",i,h,"normal")}}},{checkusername:f.checkname,checkemail:f.checkeml});g.init()}};return{exports:{login_init:function(){c.widget.use("verify",function(g){f.checkedLogin();if(d.cookie("CNAME")){d("#J_Name").val(d.cookie("CNAME"))}})},register_init:function(){c.widget.use("verify",function(g){f.checkedReg()})}}}}();if(c&&c.apps){c.apps.login=b}})(window,GM,jQuery,document);