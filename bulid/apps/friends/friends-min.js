(function(a,g,f){var e=function(k,j,m,l,i){this.uid=k;this.main=j;this.ids=m;this.width=l||315;this.height=i||150;this.listId="#J_Firends_"+c()};var b,d,h;function c(){return new Date().valueOf()}e.prototype={_timeout:function(){var i=this;i.ready=true;g(i.listId).append('<li data-id="-1">好友列表获取失败，请刷新重试</li>');delete GM.apps.friends["_batchlist"+d]},_getlist:function(){d=c();var i="http://x.idongmi.com/api/followAjax.jsp",j=this;if(!b){b=true;GM.apps.friends["_batchlist"+d]=function(k){j._batchlist(k)};g.getScript(i+"?uid="+this.uid+"&callback=GM.apps.friends._batchlist"+d);h=setTimeout(function(){j._timeout()},5000)}},_batchlist:function(k){var j=this;b=false;clearTimeout(h);g.each(k.s,function(l,m){g(j.listId).append('<li data-id="'+m.id+'">'+m.name+"</li>")});if(k.s.length===0){g(j.listId).append('<li data-id="-1">你暂时还没有好友</li>')}j.ready=true;var i=j.height;if(g(j.listId).height()>=i){g(j.listId).height(i)}delete GM.apps.friends["_batchlist"+d]},hide:function(){g(this.listId).hide()},show:function(){g(this.listId).show()},_bulidlist:function(m){var l=this,j=l.main,i=l.height,k=l.width,n=l.listId.slice(1);g(j).after('<ul id="'+n+'" style="z-index:50;background:#fff;color:#a4a4a4;line-height:20px;display:none;overflow-y:auto;width:'+k+"px;position:absolute;left:0px;top:"+(g(j).height()+5)+'px;border:#c5c5c5 solid 1px;"></ul>')},init:function(){var i=this;i._bulidlist();g(i.main).attr("autocomplete","off");g(i.listId).find("li").live("mouseover",function(){g(this).css({background:"#e6f8fe",color:"#3f9dfb"})}).live("mouseout",function(){g(this).css({background:"#fff",color:"#a4a4a4"})}).live("click",function(){var n=g(this).attr("data-id");if(n!=-1){var j=g(this).text(),m=g(i.main).val().replace("请从好友列表中选择昵称","");if(m.split(",").length>=5){alert("最多同时给五个人群发私信");i.hide();return}var l=new RegExp(j);if(!l.test(m)){if(m===""){m=j}else{m+=","+j}}g(i.main).val(m);var k=g(i.ids).val();idsarr=k.split(",");if(idsarr[0]===""){idsarr.shift()}idsarr.push(n);g(i.ids).val(idsarr.join(","));i.hide()}});g(i.main).live("focus",function(){i.hide()});g(i.main).live("keydown",function(l){if(l.ctrlKey&&l.keyCode==86){l.keyCode=0;l.returnValue=false;return false}if(l.keyCode==8||l.keyCode==46){var o=g(this).val(),j=o.split(","),n=j.slice(0,j.length-1).join(",");if(n==","){n=""}g(this).val(n);var k=g(i.ids).val(),m=k.split(",");m.pop();g(i.ids).val(m.join(","))}return false});i._getlist();g(i.ids).val("")}};if(f&&f.apps){f.apps.friends={exports:{friends:e}}}})(window,jQuery,GM);