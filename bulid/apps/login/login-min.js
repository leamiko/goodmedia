(function(a,c,d,e){var b=function(){var f={bathcallbackhand:function(j,i,h){var g=d(h).parent();if(g.next().hasClass("J_checked")){g.next().show().html(i)}else{g.after('<p class="J_checked red" style="padding-left:50px;">'+i+"</p>")}},focushand:function(h){var g=h.parent();if(g.next().hasClass("J_checked")){g.next().hide()}},checkedLogin:function(){var g=new c.widget.verify({form:"#J_LoginForm",cls:".Gverify",blur:true,success:function(i){var h="http://bbs.idongmi.com/bbs/logging.php?action=login&loginsubmit=yes&inajax=1",k=i.username,j=i.password,i={username:k,password:j,loginfield:"username",questionid:0,referer:"",answer:"",formhash:"52c87683"};if(i.cookietime){i.cookietime=i.cookietime}h+="&"+d.param(i);d.ajax({url:"/api/api_getURL2js.jsp?op=login&username="+encodeURIComponent(i.username)+"&pwd="+i.password+"&url="+encodeURIComponent(h),datatype:"xml",success:function(o){var n=d(o).find("root")[0],m=d(n).text();if(m!=""&&!(/\<script/.test(m))){d("#J_Status").text(m)}else{var l=m.match(/src="(.+?)"/g);for(var p=0;p<l.length;p++){var q=l[p].slice(5,l[p].length-1);d.getScript(q)}d("#J_Status").html("欢迎您,"+i.username+',2秒后自动<a href="http://x.idongmi.com/">返回首页</a>');setTimeout(function(){window.location.href="http://x.idongmi.com/"},2000)}},error:function(){d("#J_Status").html("网络超时，请重试")}})},batchcallback:f.bathcallbackhand,focusfn:f.focushand});g.init()},batchcallbackReghand:function(j,i,h){var g=d(h).parent();if(g.children().last().hasClass("J_checked")){g.children().last().show().html(i)}else{g.append('<em class="J_checked red" style="font-style:normal;">'+i+"</em>")}},checkname:function(i,j){var h="http://bbs.idongmi.com/bbs/ajax.php?infloat=register&handlekey=register&action=checkusername&username="+i+"&inajax=1&ajaxtarget=returnmessage4",g="/api/api_getURL2js.jsp?op=get&url=";d.ajax({url:g+encodeURIComponent(h),datatype:"xml",type:"get",success:function(m){var l=d(m).find("root")[0],k=d(l).text();if(/'1', '用户名已经被他人使用'/.test(k)){f.batchcallbackReghand("","用户名已经被他人使用",e.getElementById("J_UserName"))}else{if(j){j()}}},error:function(){f.batchcallbackReghand("","响应超时，请重新填写",e.getElementById("J_UserName"))}});return true},checkeml:function(i,j){var h="http://bbs.idongmi.com/bbs/ajax.php?infloat=register&handlekey=register&action=checkemail&email="+i+"&inajax=1&ajaxtarget=returnmessage4",g="/api/api_getURL2js.jsp?op=get&url=";d.ajax({url:g+encodeURIComponent(h),datatype:"xml",type:"get",success:function(m){var l=d(m).find("root")[0],k=d(l).text();if(/'1', '该 Email 地址已经被注册'/.test(k)){f.batchcallbackReghand("","该 Email 地址已经被注册",e.getElementById("J_Email"))}else{if(j){j()}}},error:function(){f.batchcallbackReghand("","响应超时，请重新填写",e.getElementById("J_Email"))}});return true},checkedReg:function(){var g=new c.widget.verify({form:"#J_RegForm",cls:".J_Regverify",blur:true,success:function(h){f.checkname(d("#J_UserName").val(),function(){f.checkeml(d("#J_Email").val(),function(){d("#J_RegForm").die();d("#J_RegForm").submit()})})},batchcallback:f.batchcallbackReghand,focusfn:function(h){if(h.parent().children().last().hasClass("J_checked")){h.parent().children().last().hide()}}},{checkusername:f.checkname,checkemail:f.checkeml});g.init()}};return{exports:{login_init:function(){c.widget.use("verify",function(g){f.checkedLogin()})},register_init:function(){c.widget.use("verify",function(g){f.checkedReg()})}}}}();if(c&&c.apps){c.apps.login=b}})(window,GM,jQuery,document);