(function(){$(function(){var a=function(c){var b={startBtn:"#J_Start",endBtn:"#J_End",data:"js/userdata-min.js",max:1};$.extend(b,c);this.cg=b;this.scaler=0;this.time=(function(){var d=new Date();return(d.getDate()==4&&d.getHours()>18)})()};a.CB=function(e){a.prototype.data=e;var d=e.data;for(var c=0;c<d.length;c++){var b=new Image();(function(f){b.onerror=function(){console.log(d[f]["name"])}})(c);b.src="static/pic/"+d[c]["name"]+".JPG";b.style.display="none";$("body").append(b)}};a.prototype={constructor:a,event:function(){var c=this,b=c.cg;$(b.startBtn).live("click",function(d){c.start(d,c)});$(b.endBtn).live("click",function(d){c.end(d,c)})},switchover:function(b){var f=this;if(b.length!==0){switch(typeof b){case"string":alert(b);break;case"object":var d=[],c=[];for(var e=0;e<b.length;e++){d.push(b[e]["name"]);c.push("static/pic/"+b[e]["name"]+".JPG")}$(f).trigger("switch",[d,c]);break;default:break}}},queue:function(b){var c=this,d=a.prototype.data.data;if(!this.timer){this.timer=setInterval(function(){var e=c.getusers();if(e.length!==0){c.switchover(e)}else{clearInterval(c.timer);c.timer=null;c.switchover("没有人可以转了……")}},b)}},start:function(c,b){$(b.cg.startBtn).hide();$(b.cg.endBtn).show();b.queue(80);b.scaler+=1;return false},end:function(c,b){b.pump();return false},getdata:function(b){var c=this;$.getScript(b)},random:function(b,c){return Math.round(Math.random()*(c-b))},getusers:function(j){var f=this,e=f.cg,h=f.data.data,g=[];if(h.length-e.max>=0){for(var d=0;d<e.max;d++){if(f.scaler===10&&f.cg.max==1&&j&&f.time){for(var c=0;c<h.length;c++){if(h[c]["name"]=="\u4ED8\u5F3A"){ret=c;break}}}else{function b(){ret=f.random(0,h.length-1);if(h[ret]["name"]=="\u4ED8\u5F3A"){return b()}else{return ret}}ret=b()}g.push(h[ret]);if(j){h.splice(ret,1)}}}return g},ending:function(d){var c=this;for(var b=1;b<=8;b++){(function(e){setTimeout(function(){c.switchover(c.getusers());if(e==8){d()}},150*e)})(b)}},pump:function(){var c=this,b=c.cg;if(c.data){var e=c.data.data,d=c.getusers(true);if(d.length!==0){if(c.timer){clearInterval(c.timer);c.timer=null;c.ending(function(){c.switchover(d);$(c.cg.startBtn).show();$(c.cg.endBtn).hide();$(c).trigger("end",[d])})}}else{clearInterval(c.timer);c.timer=null;c.switchover("人已经不够抽了")}}else{setTimeout(function(){c.pump()},120)}},init:function(){this.getdata(this.cg.data);this.event();$(this.cg.endBtn).hide()}};window.lottery=a})})();