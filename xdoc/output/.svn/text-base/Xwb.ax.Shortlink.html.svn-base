<div xmlns:ext="http://www.extjs.com" class="body-wrap"><h1>类 <a href="source/std-doc.html#cls-Xwb.ax.Shortlink">Xwb.ax.Shortlink</a></h1><table cellspacing="0"><tr><td class="label">空间：</td><td class="hd-info">Xwb.ax</td></tr><tr><td class="label">定义在:</td><td class="hd-info">std-doc.js</td></tr><tr><td class="label">类:</td><td class="hd-info"><a href="source/std-doc.html#cls-Xwb.ax.Shortlink">Shortlink</a></td></tr><tr><td class="label">子类:</td><td class="hd-info"><a href="output/Xwb.mod.shortlink.html" ext:cls="Xwb.mod.shortlink">shortlink</a></td></tr><tr><td class="label">父类:</td><td class="hd-info">Object</td></tr></table><div class="description">短链接解析相关函数，包含短链接的识别，缓存，解析，结合DOM渲染等操作。<br/>
目前短链有三个类型：<br/>
1. 新浪http://t.cn短链<br/>
2. 新浪http://sinaurl.cn短链，兼容处理<br/>
3. Xweibo站点自定义短链<br/>
 用法：
<pre><code><i>// 指明要解析的短链前缀</i>
    <b>var</b> shortlink = <b>new</b> Xwb.ax.Shortlink({ local:<em>'http:<i>//xweibourl.cn'</em> });</i>
    
    <b>var</b> testUrl = <em>'http:<i>//xweibourl.cn/aBcDeF'</em>;</i>
    
    <i>// true</i>
    shortlink.is(testUrl);
    
    testUrl = <em>'a text including http:<i>//xweibourl.cn/aBcDeF,http://xweibourl.cn/DefGHE'</em>;</i>
    
    <i>// 返回[<em>'aBcDeF'</em>,<em>'DefGHE'</em>]</i>
    shortlink.search(testUrl);
    
    <i>// 处理HTML元素中包含短链的a元素</i>
    shortlink.render(<em>'#divId'</em>, <b>function</b>(urlInfo, aHrefElement){
            aHrefElement.title = urlInfo.url;
    });</code></pre>
  urlInfo结构以视频为例如下：
<pre><code>{
        <i>// 实际地址</i>
        url :	<em>"http:<i>//x.xweibo.com/pr...Y6XTWIwA/?rpid=58114392"</em>,</i>
        <i>// url类型，有url,music,video等</i>
        type : <em>"video"</em>,
        <i>// 标题</i>
        title : <em>"还珠伤感"</em>,
        <i>// 缩略图</i>
        screen : <em>"http:<i>//i01.img.tudou.co...mgs/i/072/911/086/p.jpg"</em>,</i>
        <i>// 视频地址</i>
        flash : <em>"http:<i>//www.tudou.com/v/wzLY6XTWIwA/v.swf"</em>,</i>
        mp4:<em>""</em>,
        <i>// 图标</i>
        icon : <em>"http:<i>//img.t.sinajs.cn/...ommon/feedvideoplay.gif"</em></i>
    }</code></pre>

 其它用法参见方法说明。</div><div class="hr"></div><a id="Xwb.ax.Shortlink-configs"></a><h2>配置项</h2><table cellspacing="0" class="member-table"><tbody><tr><th colspan="2" class="sig-header">config</th><th class="msource-header">定义在</th></tr><tr class="config-row  "><td class="micon"><a href="#expand" class="exi">&nbsp;</a></td><td class="sig"><a id="Xwb.ax.Shortlink-local"></a><b><a href="source/std-doc.html#cfg-Xwb.ax.Shortlink-local">local</a></b> : String<div class="mdesc">指定本地短链接前缀</div></td><td class="msource">Shortlink</td></tr></tbody></table><a id="Xwb.ax.Shortlink-props"></a><h2>公共属性（只读）</h2><div class="no-members">This class has no public properties.</div><a id="Xwb.ax.Shortlink-events"></a><h2>事件列表</h2><div class="no-members">This class has no public events.</div><a id="Xwb.ax.Shortlink-methods"></a><h2>公共方法</h2><table cellspacing="0" class="member-table"><tbody><tr><th colspan="2" class="sig-header">method</th><th class="msource-header">定义在</th></tr><tr class="method-row expandable "><td class="micon"><a href="#expand" class="exi">&nbsp;</a></td><td class="sig"><a id="Xwb.ax.Shortlink-getUrls"></a><b><a href="source/std-doc.html#method-Xwb.ax.Shortlink-getUrls">getUrls</a></b>()
    :
                                        Object<div class="mdesc"><div class="short">获得缓存中的URL信息，数据格式为{urlShortId:urlInfo}</div><div class="long">获得缓存中的URL信息，数据格式为{urlShortId:urlInfo}<div class="mdetail-params"><strong>Parameters:</strong><ul><li>None.</li></ul><strong>Returns:</strong><ul><li><code>Object</code><div class="sub-desc"></div></li></ul></div></div></div></td><td class="msource">Shortlink</td></tr><tr class="method-row expandable "><td class="micon"><a href="#expand" class="exi">&nbsp;</a></td><td class="sig"><a id="Xwb.ax.Shortlink-search"></a><b><a href="source/std-doc.html#method-Xwb.ax.Shortlink-search">search</a></b>(&nbsp;<code>String&nbsp;text</code>&nbsp;)
    :
                                        Array<div class="mdesc"><div class="short">从给定文本内查找所有短链接，返回包含短链接ID字符串的数组。&#13;
var text = 'Xweibo,2011 go go go!http://testurl.cn/xweibo_trunk/hBACWI';&#13;
        var...</div><div class="long">从给定文本内查找所有短链接，返回包含短链接ID字符串的数组。
<pre><code><b>var</b> text = <em>'Xweibo,2011 go go go!http:<i>//testurl.cn/xweibo_trunk/hBACWI'</em>;</i>
        <b>var</b> urls = search(text);
        结果：[<em>'hBACWI'</em>]</code></pre><div class="mdetail-params"><strong>Parameters:</strong><ul><li><code>text</code> : String<div class="sub-desc"></div></li></ul><strong>Returns:</strong><ul><li><code>Array</code><div class="sub-desc"></div></li></ul></div></div></div></td><td class="msource">Shortlink</td></tr><tr class="method-row expandable "><td class="micon"><a href="#expand" class="exi">&nbsp;</a></td><td class="sig"><a id="Xwb.ax.Shortlink-is"></a><b><a href="source/std-doc.html#method-Xwb.ax.Shortlink-is">is</a></b>(&nbsp;<code>String&nbsp;url</code>&nbsp;)
    :
                                        Boolean|String<div class="mdesc"><div class="short">判断给定的URL是否为短链接格式，如果为短链接，返回该链接接字符串ID。&#13;
var text = 'http://testurl.cn/xweibo_trunk/hBACWI';&#13;
            var linkId;&#13;
 ...</div><div class="long">判断给定的URL是否为短链接格式，如果为短链接，返回该链接接字符串ID。
<pre><code><b>var</b> text = <em>'http:<i>//testurl.cn/xweibo_trunk/hBACWI'</em>;</i>
            <b>var</b> linkId;
            <b>if</b>((linkId=is(text))){
                <i>// hBACWI</i>
                alert(linkId);
            }</code></pre><div class="mdetail-params"><strong>Parameters:</strong><ul><li><code>url</code> : String<div class="sub-desc"></div></li></ul><strong>Returns:</strong><ul><li><code>Boolean|String</code><div class="sub-desc"></div></li></ul></div></div></div></td><td class="msource">Shortlink</td></tr><tr class="method-row expandable "><td class="micon"><a href="#expand" class="exi">&nbsp;</a></td><td class="sig"><a id="Xwb.ax.Shortlink-from"></a><b><a href="source/std-doc.html#method-Xwb.ax.Shortlink-from">from</a></b>(&nbsp;<code>Object&nbsp;weiboListDataMap</code>,&nbsp;<code>Function&nbsp;callback</code>&nbsp;)
    :
                                        void<div class="mdesc"><div class="short">解析来自微博列表数据的短链接，解析完毕后只回调一次callback。&#13;
方法执行来将已解析的短链数据缓存在参数list的shortlinks属性中，它是一个数组，&#13;
该数组内的短链可能重复，因为一微博内可存在多个重复的短链接。&#13;
数组...</div><div class="long">解析来自微博列表数据的短链接，解析完毕后只回调一次callback。<br/>
方法执行来将已解析的短链数据缓存在参数list的shortlinks属性中，它是一个数组，
该数组内的短链可能重复，因为一微博内可存在多个重复的短链接。<br/>
数组元素数据格式为
<pre><code>{
          shortlinks : [
            <i>// 短链信息</i>
            shortlinkInfo,
            <i>// 该短链是否来自转发区</i>
            true
          ],
          <i>//...</i>
        }</code></pre>
callback 回调的参数为(wbData, shortlinks)<br/>
shortlinks格式为[ [shorlinkInfo, isForward], ... ],
shortlinkInfo为上面shortlinks中的元素<br/>
isForward 指明该短链是否来自转发内容。<br/><div class="mdetail-params"><strong>Parameters:</strong><ul><li><code>weiboListDataMap</code> : Object<div class="sub-desc"></div></li><li><code>callback</code> : Function<div class="sub-desc"></div></li></ul><strong>Returns:</strong><ul><li>void</li></ul></div></div></div></td><td class="msource">Shortlink</td></tr><tr class="method-row expandable "><td class="micon"><a href="#expand" class="exi">&nbsp;</a></td><td class="sig"><a id="Xwb.ax.Shortlink-info"></a><b><a href="source/std-doc.html#method-Xwb.ax.Shortlink-info">info</a></b>(&nbsp;<code>Array&nbsp;urls</code>,&nbsp;<code>Function&nbsp;callback</code>&nbsp;)
    :
                                        void<div class="mdesc"><div class="short">查询给定短链接ID数组中所有短链接的信息。&#13;
如果短链接信息已缓存，优先使用缓存数据。</div><div class="long">查询给定短链接ID数组中所有短链接的信息。<br/>
如果短链接信息已缓存，优先使用缓存数据。<div class="mdetail-params"><strong>Parameters:</strong><ul><li><code>urls</code> : Array<div class="sub-desc">短链接数组，如['hBACWI','hBAWEF',...]</div></li><li><code>callback</code> : Function<div class="sub-desc">查询结束后回调，参数为库已缓存的所有短链接map数据。</div></li></ul><strong>Returns:</strong><ul><li>void</li></ul></div></div></div></td><td class="msource">Shortlink</td></tr><tr class="method-row expandable "><td class="micon"><a href="#expand" class="exi">&nbsp;</a></td><td class="sig"><a id="Xwb.ax.Shortlink-render"></a><b><a href="source/std-doc.html#method-Xwb.ax.Shortlink-render">render</a></b>(&nbsp;<code>jQuery|HTMLElement&nbsp;scopeElement</code>,&nbsp;<code>Function&nbsp;renderer</code>&nbsp;)
    :
                                        void<div class="mdesc"><div class="short">查找给定DOM元素内所有的短链接a元素，利用renderer参数回调处理这些元素。&#13;
方法会查找元素中中包含短链接的a标签元素，获得所有短链接，查询短链接缓存，如未缓存，&#13;
发起API请求解析未缓存的短链接。&#13;
方法可自行处理给定元素...</div><div class="long">查找给定DOM元素内所有的短链接a元素，利用renderer参数回调处理这些元素。<br/>
方法会查找元素中中包含短链接的a标签元素，获得所有短链接，查询短链接缓存，如未缓存，
发起API请求解析未缓存的短链接。<br/>
方法可自行处理给定元素结点内所有包含短链的A元素。<br/>
某个元素里所有的短链接加上提示真实地址：
<pre><code>render(<em>'#divId'</em>, <b>function</b>(urlInfo, aHrefElement){
            aHrefElement.title = urlInfo.url;
       });</code></pre><div class="mdetail-params"><strong>Parameters:</strong><ul><li><code>scopeElement</code> : jQuery|HTMLElement<div class="sub-desc"></div></li><li><code>renderer</code> : Function<div class="sub-desc">，调用参数为 renderer( shortlinkInfo, aHrefElement )</div></li></ul><strong>Returns:</strong><ul><li>void</li></ul></div></div></div></td><td class="msource">Shortlink</td></tr></tbody></table></div>